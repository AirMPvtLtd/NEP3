<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Polynomial Exploration Lab - NEP Workbench</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        :root { --bg: #1e1e1e; --panel: #252526; --accent: #007acc; --success: #00b894; }
        body { background: var(--bg); color: #fff; }
        .container { max-width: 1600px; margin: 0 auto; padding: 20px; }
        .header { 
            background: #333; 
            border-radius: 8px; 
            padding: 20px; 
            margin-bottom: 20px; 
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            border-left: 4px solid var(--accent);
        }
        h1 { font-size: 24px; color: var(--accent); }
        .btn { padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; background: var(--accent); color: white; }
        .main { display: grid; grid-template-columns: 1fr 400px; gap: 20px; }
        .panel { 
            background: var(--panel); 
            border-radius: 8px; 
            padding: 20px; 
            border: 1px solid #464647;
        }
        
        /* Exploration Zone */
        .exploration-zone { 
            background: var(--bg); 
            border-radius: 6px; 
            height: 600px; 
            border: 2px solid #464647;
            position: relative;
            overflow: hidden;
        }
        canvas { width: 100%; height: 100%; }
        
        /* Exploration Tools */
        .exploration-tools {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin: 15px 0;
        }
        
        .tool-btn {
            padding: 12px;
            background: #2d2d30;
            border: 2px solid #464647;
            border-radius: 4px;
            color: white;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .tool-btn:hover {
            border-color: var(--accent);
            background: rgba(0, 122, 204, 0.1);
        }
        
        .tool-btn.active {
            border-color: var(--accent);
            background: rgba(0, 122, 204, 0.2);
        }
        
        /* Coefficient Controls */
        .coeff-slider {
            background: #2d2d30;
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
        }
        
        .slider-container {
            display: grid;
            grid-template-columns: 30px 1fr 60px;
            gap: 10px;
            margin: 12px 0;
            align-items: center;
        }
        
        .coeff-label {
            font-family: monospace;
            font-size: 16px;
            text-align: center;
        }
        
        input[type="range"] {
            width: 100%;
            height: 6px;
            background: #464647;
            border-radius: 3px;
            outline: none;
        }
        
        .coeff-value {
            width: 60px;
            padding: 5px;
            background: #2d2d30;
            border: 1px solid #464647;
            border-radius: 4px;
            color: white;
            text-align: center;
        }
        
        /* Function Display */
        .function-display {
            background: #2d2d30;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
            border-left: 4px solid var(--accent);
        }
        
        .function-equation {
            font-family: monospace;
            font-size: 18px;
            color: var(--accent);
            text-align: center;
            margin: 10px 0;
        }
        
        /* Pattern Discovery */
        .pattern-discovery {
            background: rgba(0, 184, 148, 0.1);
            border: 2px solid var(--success);
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .pattern-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 12px;
            margin: 8px 0;
            border-radius: 6px;
            border-left: 3px solid transparent;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .pattern-item.revealed {
            border-left-color: var(--success);
            background: rgba(0, 184, 148, 0.1);
        }
        
        .pattern-item:hover {
            transform: translateX(5px);
        }
        
        /* Exploration Stats */
        .exploration-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 20px;
        }
        
        .stat-card {
            background: #2d2d30;
            padding: 15px;
            border-radius: 6px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 24px;
            color: var(--accent);
            font-weight: 600;
        }
        
        .stat-label {
            font-size: 12px;
            color: #888;
        }
        
        /* Exploration Log */
        .exploration-log {
            max-height: 150px;
            overflow-y: auto;
            margin: 15px 0;
            padding: 10px;
            background: #2d2d30;
            border-radius: 6px;
        }
        
        .log-entry {
            padding: 5px;
            margin: 3px 0;
            border-bottom: 1px solid #333;
            font-size: 12px;
        }
        
        .log-time {
            color: #888;
            float: right;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div>
                <h1><i class="fas fa-wave-square"></i> Polynomial Exploration Lab</h1>
                <p style="color: #888;">Math Lab • Discover Patterns • Grade 9-10</p>
            </div>
            <div style="display: flex; gap: 15px; align-items: center;">
                <div style="background: #2d2d30; padding: 8px 15px; border-radius: 20px;">
                    <i class="fas fa-lightbulb" style="color: var(--success);"></i>
                    <span id="discoveries">0</span> Discoveries
                </div>
    
                <button class="btn" onclick="exportExploration()" style="background: var(--success);">
                    <i class="fas fa-download"></i> Export
                </button>
            </div>
        </div>
        
        <div class="main">
            <div class="panel">
                <h2 style="margin-bottom: 15px;">
                    <i class="fas fa-chart-line"></i> Polynomial Canvas
                </h2>
                
                <div class="exploration-zone">
                    <canvas id="canvas"></canvas>
                </div>
                
                <div class="exploration-tools">
                    <div class="tool-btn active" onclick="selectTool('explore')">
                        <i class="fas fa-hand-pointer"></i>
                        Explore
                    </div>
                    <div class="tool-btn" onclick="selectTool('zoom')">
                        <i class="fas fa-search"></i>
                        Zoom
                    </div>
                    <div class="tool-btn" onclick="selectTool('compare')">
                        <i class="fas fa-exchange-alt"></i>
                        Compare
                    </div>
                    <div class="tool-btn" onclick="resetExploration()">
                        <i class="fas fa-redo"></i>
                        Reset
                    </div>
                </div>
                
                <div class="function-display">
                    <div style="color: #888; font-size: 14px;">Current Function</div>
                    <div class="function-equation" id="currentFunction">f(x) = 0</div>
                    <div style="color: #aaa; font-size: 12px; text-align: center;" id="functionBehavior">
                        Drag sliders to explore different polynomials
                    </div>
                </div>
            </div>
            
            <div class="panel">
                <h2 style="margin-bottom: 15px;">
                    <i class="fas fa-sliders-h"></i> Coefficient Explorer
                </h2>
                
                <div class="coeff-slider">
                    <div class="slider-container">
                        <div class="coeff-label">a:</div>
                        <input type="range" id="coeffA" min="-5" max="5" step="0.1" value="1" 
                               oninput="updateCoefficient('a', this.value)">
                        <input type="number" class="coeff-value" id="coeffAValue" value="1" step="0.1"
                               onchange="updateCoefficient('a', this.value)">
                    </div>
                    
                    <div class="slider-container">
                        <div class="coeff-label">b:</div>
                        <input type="range" id="coeffB" min="-5" max="5" step="0.1" value="0" 
                               oninput="updateCoefficient('b', this.value)">
                        <input type="number" class="coeff-value" id="coeffBValue" value="0" step="0.1"
                               onchange="updateCoefficient('b', this.value)">
                    </div>
                    
                    <div class="slider-container">
                        <div class="coeff-label">c:</div>
                        <input type="range" id="coeffC" min="-5" max="5" step="0.1" value="-3" 
                               oninput="updateCoefficient('c', this.value)">
                        <input type="number" class="coeff-value" id="coeffCValue" value="-3" step="0.1"
                               onchange="updateCoefficient('c', this.value)">
                    </div>
                    
                    <div class="slider-container">
                        <div class="coeff-label">d:</div>
                        <input type="range" id="coeffD" min="-10" max="10" step="0.1" value="2" 
                               oninput="updateCoefficient('d', this.value)">
                        <input type="number" class="coeff-value" id="coeffDValue" value="2" step="0.1"
                               onchange="updateCoefficient('d', this.value)">
                    </div>
                </div>
                
                <button class="btn" style="width: 100%; margin-top: 10px;" onclick="addToComparison()">
                    <i class="fas fa-plus-circle"></i> Add to Comparison
                </button>
                
                <h3 style="margin: 20px 0 10px;">
                    <i class="fas fa-history"></i> Exploration Log
                </h3>
                <div class="exploration-log" id="explorationLog">
                    <!-- Log entries will be added here -->
                </div>
                
                <h3 style="margin: 20px 0 10px;">
                    <i class="fas fa-search"></i> Pattern Discovery
                </h3>
                <div class="pattern-discovery">
                    <div class="pattern-item" id="pattern1">
                        <i class="fas fa-question-circle"></i>
                        What happens when 'a' is positive vs negative?
                    </div>
                    
                    <div class="pattern-item" id="pattern2">
                        <i class="fas fa-question-circle"></i>
                        How does 'd' affect the graph's position?
                    </div>
                    
                    <div class="pattern-item" id="pattern3">
                        <i class="fas fa-question-circle"></i>
                        Try setting 'b' and 'c' to zero. What shape appears?
                    </div>
                    
                    <div class="pattern-item" id="pattern4">
                        <i class="fas fa-question-circle"></i>
                        Can you create a function with 3 roots?
                    </div>
                </div>
                
                <div class="exploration-stats">
                    <div class="stat-card">
                        <div class="stat-value" id="statExplorations">0</div>
                        <div class="stat-label">Explorations</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="statFunctions">0</div>
                        <div class="stat-label">Functions</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="statPatterns">0</div>
                        <div class="stat-label">Patterns</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="statTime">0</div>
                        <div class="stat-label">Minutes</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        // ABS Exploration Variables
        let explorationData = {
            explorations: 0,
            patternsFound: 0,
            discoveries: 0,
            functionsExplored: 0,
            comparisonFunctions: [],
            explorationStart: Date.now(),
            activityLog: [],
            discoveredPatterns: []
        };
        
        let currentTool = 'explore';
        let scale = 30;
        let offsetX = 0, offsetY = 0;
        let isPanning = false;
        let startX = 0, startY = 0;
        
        // Current polynomial coefficients
        let currentCoeffs = {
            a: 1,
            b: 0,
            c: -3,
            d: 2
        };
        
        // Comparison functions
        let comparisonFunctions = [];
        let canvas, ctx;
        
        // Initialize exploration
        document.addEventListener('DOMContentLoaded', function() {
            initExploration();
            updateFunctionDisplay();
            draw();
            
            logActivity("Started polynomial exploration session");
            startExplorationTimer();
        });
        
        function initExploration() {
            canvas = document.getElementById('canvas');
            ctx = canvas.getContext('2d');
            
            canvas.width = canvas.parentElement.clientWidth;
            canvas.height = canvas.parentElement.clientHeight;
            
            // Add mouse interactions for exploration
            canvas.addEventListener('mousedown', startPan);
            canvas.addEventListener('mousemove', pan);
            canvas.addEventListener('mouseup', endPan);
            canvas.addEventListener('wheel', zoomWithWheel);
            
            window.addEventListener('resize', function() {
                canvas.width = canvas.parentElement.clientWidth;
                canvas.height = canvas.parentElement.clientHeight;
                draw();
            });
            
            updateExplorationStats();
        }
        
        function selectTool(tool) {
            currentTool = tool;
            explorationData.explorations++;
            
            // Update UI
            document.querySelectorAll('.tool-btn').forEach(btn => btn.classList.remove('active'));
            event.currentTarget.classList.add('active');
            
            switch(tool) {
                case 'explore':
                    logActivity("Selected exploration tool");
                    break;
                case 'zoom':
                    logActivity("Selected zoom tool");
                    break;
                case 'compare':
                    logActivity("Selected comparison tool");
                    break;
            }
            
            updateExplorationStats();
        }
        
        function updateCoefficient(coeff, value) {
            // Update the coefficient value
            const numValue = parseFloat(value);
            currentCoeffs[coeff] = isNaN(numValue) ? 0 : numValue;
            
            // Update both slider and number input
            document.getElementById(`coeff${coeff.toUpperCase()}`).value = numValue;
            document.getElementById(`coeff${coeff.toUpperCase()}Value`).value = numValue.toFixed(1);
            
            // Log the exploration
            explorationData.explorations++;
            logActivity(`Changed ${coeff} to ${numValue.toFixed(1)}`);
            
            // Update display and redraw
            updateFunctionDisplay();
            draw();
            checkForPatterns();
            updateExplorationStats();
        }
        
        function updateFunctionDisplay() {
            const f = currentCoeffs;
            let equation = "f(x) = ";
            
            if (f.a !== 0) {
                equation += `${f.a > 0 ? '' : '-'}${Math.abs(f.a) !== 1 ? Math.abs(f.a).toFixed(1) : ''}x³`;
            }
            
            if (f.b !== 0) {
                equation += `${f.b > 0 ? ' + ' : ' - '}${Math.abs(f.b) !== 1 ? Math.abs(f.b).toFixed(1) : ''}x²`;
            }
            
            if (f.c !== 0) {
                equation += `${f.c > 0 ? ' + ' : ' - '}${Math.abs(f.c) !== 1 ? Math.abs(f.c).toFixed(1) : ''}x`;
            }
            
            if (f.d !== 0) {
                equation += `${f.d > 0 ? ' + ' : ' - '}${Math.abs(f.d).toFixed(1)}`;
            }
            
            if (equation === "f(x) = ") {
                equation = "f(x) = 0";
            }
            
            document.getElementById('currentFunction').textContent = equation;
            
            // Update function behavior description
            updateBehaviorDescription();
        }
        
        function updateBehaviorDescription() {
            const f = currentCoeffs;
            let behavior = "";
            
            if (f.a !== 0) {
                behavior = f.a > 0 ? 
                    "Cubic (up-down-up)" : 
                    "Cubic (down-up-down)";
            } else if (f.b !== 0) {
                behavior = f.b > 0 ? 
                    "Parabola (opens upward)" : 
                    "Parabola (opens downward)";
            } else if (f.c !== 0) {
                behavior = "Linear line";
            } else {
                behavior = "Constant function";
            }
            
            document.getElementById('functionBehavior').textContent = behavior;
        }
        
        function addToComparison() {
            const newFunction = {
                ...currentCoeffs,
                color: `hsl(${comparisonFunctions.length * 60}, 70%, 60%)`,
                name: `F${comparisonFunctions.length + 1}`
            };
            
            comparisonFunctions.push(newFunction);
            explorationData.comparisonFunctions.push({...currentCoeffs});
            explorationData.functionsExplored++;
            
            logActivity(`Added ${newFunction.name} to comparison`);
            draw();
            updateExplorationStats();
        }
        
        function checkForPatterns() {
            const f = currentCoeffs;
            
            // Check for specific patterns
            if (f.a === 0 && f.b === 0 && f.c !== 0) {
                revealDiscovery('pattern3', 'Linear function! When a=0 and b=0, you get a straight line.');
            }
            
            if (f.a > 0 && f.b < 0 && f.c > 0 && f.d < 0) {
                // Likely has 3 real roots
                revealDiscovery('pattern4', 'Cubic with 3 roots! Try zooming in to see where it crosses x-axis.');
            }
            
            if (f.a > 0) {
                revealDiscovery('pattern1', 'Positive cubic: graph goes down, then up as x increases.');
            } else if (f.a < 0) {
                revealDiscovery('pattern1', 'Negative cubic: graph goes up, then down as x increases.');
            }
            
            if (Math.abs(f.d) > 5) {
                revealDiscovery('pattern2', 'Large d-value shifts the graph vertically.');
            }
        }
        
        function revealDiscovery(patternId, message) {
            const patternElement = document.getElementById(patternId);
            if (!patternElement.classList.contains('revealed')) {
                patternElement.classList.add('revealed');
                patternElement.innerHTML = `
                    <i class="fas fa-check-circle" style="color: var(--success);"></i>
                    ${message}
                `;
                
                explorationData.discoveries++;
                explorationData.patternsFound++;
                explorationData.discoveredPatterns.push(message);
                
                logActivity(`Discovery: ${message}`);
                document.getElementById('discoveries').textContent = explorationData.discoveries;
                updateExplorationStats();
            }
        }
        
        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            const centerX = canvas.width / 2 + offsetX;
            const centerY = canvas.height / 2 + offsetY;
            
            // Draw grid
            ctx.strokeStyle = '#2a2a2a';
            ctx.lineWidth = 1;
            
            // Vertical grid lines
            for (let x = centerX % scale; x < canvas.width; x += scale) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, canvas.height);
                ctx.stroke();
            }
            
            // Horizontal grid lines
            for (let y = centerY % scale; y < canvas.height; y += scale) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(canvas.width, y);
                ctx.stroke();
            }
            
            // Draw axes
            ctx.strokeStyle = '#666';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(0, centerY);
            ctx.lineTo(canvas.width, centerY);
            ctx.moveTo(centerX, 0);
            ctx.lineTo(centerX, canvas.height);
            ctx.stroke();
            
            // Draw axis labels
            ctx.fillStyle = '#888';
            ctx.font = '12px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            
            // X-axis labels
            for (let i = -Math.floor(canvas.width / 2 / scale); i <= Math.floor(canvas.width / 2 / scale); i++) {
                if (i !== 0) {
                    const x = centerX + i * scale;
                    ctx.fillText(i, x, centerY + 15);
                }
            }
            
            // Y-axis labels
            for (let i = -Math.floor(canvas.height / 2 / scale); i <= Math.floor(canvas.height / 2 / scale); i++) {
                if (i !== 0) {
                    const y = centerY - i * scale;
                    ctx.fillText(i, centerX - 15, y);
                }
            }
            
            // Draw current function (thicker line)
            drawPolynomial(currentCoeffs, '#007acc', 3);
            
            // Draw comparison functions (thinner lines)
            comparisonFunctions.forEach((func, index) => {
                drawPolynomial(func, func.color, 2);
                
                // Add legend
                const legendY = 30 + index * 20;
                ctx.fillStyle = func.color;
                ctx.fillRect(20, legendY, 15, 2);
                ctx.fillStyle = '#fff';
                ctx.font = '12px Arial';
                ctx.textAlign = 'left';
                ctx.fillText(func.name, 40, legendY + 4);
            });
            
            // Draw origin label
            ctx.fillStyle = '#888';
            ctx.fillText("O", centerX - 10, centerY + 10);
        }
        
        function drawPolynomial(coeffs, color, lineWidth) {
            const centerX = canvas.width / 2 + offsetX;
            const centerY = canvas.height / 2 + offsetY;
            
            ctx.strokeStyle = color;
            ctx.lineWidth = lineWidth;
            ctx.beginPath();
            
            let started = false;
            for (let px = 0; px < canvas.width; px++) {
                const x = (px - centerX) / scale;
                const y = coeffs.a * Math.pow(x, 3) + coeffs.b * Math.pow(x, 2) + coeffs.c * x + coeffs.d;
                const py = centerY - y * scale;
                
                if (Math.abs(py) < canvas.height * 10) { // Allow larger range for drawing
                    if (!started) {
                        ctx.moveTo(px, py);
                        started = true;
                    } else {
                        ctx.lineTo(px, py);
                    }
                }
            }
            
            ctx.stroke();
        }
        
        // Pan and zoom functionality
        function startPan(e) {
            if (currentTool === 'explore') {
                isPanning = true;
                startX = e.clientX - offsetX;
                startY = e.clientY - offsetY;
                canvas.style.cursor = 'grabbing';
            }
        }
        
        function pan(e) {
            if (!isPanning) return;
            
            offsetX = e.clientX - startX;
            offsetY = e.clientY - startY;
            draw();
        }
        
        function endPan() {
            isPanning = false;
            canvas.style.cursor = 'default';
        }
        
        function zoomWithWheel(e) {
            e.preventDefault();
            
            if (currentTool === 'zoom') {
                const zoomFactor = e.deltaY > 0 ? 0.9 : 1.1;
                scale *= zoomFactor;
                draw();
                logActivity(`Zoomed ${e.deltaY > 0 ? 'out' : 'in'}`);
                explorationData.explorations++;
                updateExplorationStats();
            }
        }
        
        function resetExploration() {
            currentCoeffs = { a: 1, b: 0, c: -3, d: 2 };
            comparisonFunctions = [];
            scale = 30;
            offsetX = 0;
            offsetY = 0;
            
            // Reset coefficient inputs
            ['a', 'b', 'c', 'd'].forEach(coeff => {
                const defaultValue = currentCoeffs[coeff];
                document.getElementById(`coeff${coeff.toUpperCase()}`).value = defaultValue;
                document.getElementById(`coeff${coeff.toUpperCase()}Value`).value = defaultValue.toFixed(1);
            });
            
            updateFunctionDisplay();
            draw();
            logActivity("Reset exploration");
        }
        
        function logActivity(message) {
            const log = document.getElementById('explorationLog');
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            
            const now = new Date();
            const timeString = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
            
            entry.innerHTML = `${message} <span class="log-time">${timeString}</span>`;
            
            log.appendChild(entry);
            log.scrollTop = log.scrollHeight;
        }
        
        function startExplorationTimer() {
            setInterval(() => {
                const elapsed = Math.floor((Date.now() - explorationData.explorationStart) / 60000);
                document.getElementById('statTime').textContent = elapsed;
            }, 60000);
        }
        
        function updateExplorationStats() {
            document.getElementById('statExplorations').textContent = explorationData.explorations;
            document.getElementById('statFunctions').textContent = explorationData.functionsExplored;
            document.getElementById('statPatterns').textContent = explorationData.patternsFound;
        }
        
        function saveExploration() {
            const progress = {
                timestamp: new Date().toISOString(),
                explorationData: explorationData,
                currentCoeffs: currentCoeffs,
                comparisonFunctions: comparisonFunctions
            };
            
            localStorage.setItem('polynomialExplorationProgress', JSON.stringify(progress));
            logActivity("Exploration progress saved");
            
            // Visual feedback
            alert('Progress saved!');
        }
        
        function exportExploration() {
            const data = {
                explorationData: explorationData,
                currentCoeffs: currentCoeffs,
                comparisonFunctions: comparisonFunctions,
                timestamp: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `polynomial-exploration-${new Date().toISOString().slice(0, 10)}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            logActivity("Exported exploration data");
        }
    </script>
</body>
</html>