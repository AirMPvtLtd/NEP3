<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Motion Classifier Simulator - NEP Workbench</title>
    <!-- Fixed Font Awesome CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        :root {
            --primary-bg: #1e1e1e;
            --secondary-bg: #2d2d30;
            --panel-bg: #252526;
            --header-bg: #333337;
            --border-color: #464647;
            --accent-color: #007acc;
            --accent-secondary: #00b894;
            --accent-tertiary: #fd79a8;
            --error-color: #ff4444;
            --success-color: #00b894;
            --warning-color: #fdcb6e;
            --text-primary: #ffffff;
            --text-secondary: #cccccc;
            --text-muted: #888888;
            --grid-color: #2a2a2a;
            --motion-color: #007acc;
            --velocity-color: #00b894;
            --uniform-color: #007acc;
            --accelerated-color: #00b894;
            --decelerated-color: #fd79a8;
            --circular-color: #6c5ce7;
        }
        
        body {
            background: var(--primary-bg);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* Loading Overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--primary-bg);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.3s ease;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid var(--border-color);
            border-top-color: var(--accent-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        .loading-text {
            color: var(--text-secondary);
            font-size: 16px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Main Container */
        .simulation-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            min-height: 100vh;
        }
        
        /* HEADER - Simplified */
        .main-header {
            background: var(--header-bg);
            border-radius: 8px;
            padding: 15px 25px;
            border: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header-left {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .header-title {
            font-size: 24px;
            font-weight: 600;
            color: var(--accent-color);
        }
        
        .header-subtitle {
            font-size: 14px;
            color: var(--text-muted);
        }
        
        .header-right {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .header-actions {
            display: flex;
            gap: 10px;
        }
        
        .header-btn {
            padding: 8px 16px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background: #3c3c3c;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.3s ease;
            white-space: nowrap;
        }
        
        .header-btn:hover {
            background: var(--accent-color);
            border-color: var(--accent-color);
            color: var(--text-primary);
        }
        
        .header-btn.primary {
            background: var(--accent-color);
            border-color: var(--accent-color);
            color: var(--text-primary);
        }
        
        /* Main Content - Full width simulation */
        .main-content {
            display: flex;
            flex: 1;
            min-height: 0;
        }
        
        /* Simulation Panel - Now takes full width */
        .simulation-panel {
            flex: 1;
            background: var(--panel-bg);
            border-radius: 8px;
            border: 1px solid var(--border-color);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .simulation-header {
            padding: 15px 25px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .simulation-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-secondary);
        }
        
        .motion-type-indicator {
            font-size: 14px;
            color: var(--accent-color);
            background: rgba(0, 122, 204, 0.1);
            padding: 6px 12px;
            border-radius: 4px;
            border: 1px solid var(--accent-color);
        }
        
        /* Simulation Area */
        .simulation-area {
            flex: 1;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .motion-canvas-container {
            background: var(--primary-bg);
            border-radius: 6px;
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
            height: 400px;
        }
        
        #motion-canvas {
            width: 100%;
            height: 100%;
            display: block;
        }
        
        .canvas-grid {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(var(--grid-color) 1px, transparent 1px),
                linear-gradient(90deg, var(--grid-color) 1px, transparent 1px);
            background-size: 50px 50px;
            pointer-events: none;
            opacity: 0.2;
        }
        
        .object-indicator {
            position: absolute;
            top: 15px;
            left: 15px;
            background: rgba(0, 0, 0, 0.7);
            padding: 8px 12px;
            border-radius: 4px;
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            font-size: 12px;
        }
        
        /* Controls Panel */
        .controls-panel {
            background: var(--header-bg);
            border-radius: 6px;
            padding: 20px;
            border: 1px solid var(--border-color);
        }
        
        .controls-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .controls-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .control-label {
            font-size: 13px;
            color: var(--text-muted);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .control-value {
            font-weight: 600;
            color: var(--accent-color);
        }
        
        .control-slider {
            width: 100%;
            height: 6px;
            -webkit-appearance: none;
            appearance: none;
            background: linear-gradient(to right, var(--header-bg), var(--accent-color));
            border-radius: 3px;
            outline: none;
        }
        
        .control-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--accent-color);
            cursor: pointer;
            border: 2px solid var(--secondary-bg);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            transition: all 0.2s ease;
        }
        
        .control-slider::-webkit-slider-thumb:hover {
            transform: scale(1.1);
            background: #005a99;
        }
        
        .control-buttons {
            display: flex;
            gap: 10px;
            margin-top: 5px;
        }
        
        .control-btn {
            flex: 1;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background: #3c3c3c;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 13px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            transition: all 0.3s ease;
        }
        
        .control-btn:hover {
            background: var(--accent-color);
            border-color: var(--accent-color);
            color: var(--text-primary);
        }
        
        .control-btn.active {
            background: var(--accent-color);
            border-color: var(--accent-color);
            color: var(--text-primary);
        }
        
        .motion-types {
            grid-column: 1 / -1;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-top: 10px;
        }
        
        .motion-type-btn {
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background: var(--secondary-bg);
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 13px;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .motion-type-btn:hover {
            transform: translateY(-2px);
        }
        
        .motion-type-btn.active {
            background: var(--accent-color);
            border-color: var(--accent-color);
            color: var(--text-primary);
        }
        
        .motion-type-btn.uniform {
            border-color: var(--uniform-color);
        }
        
        .motion-type-btn.accelerated {
            border-color: var(--accelerated-color);
        }
        
        .motion-type-btn.decelerated {
            border-color: var(--decelerated-color);
        }
        
        .motion-type-btn.circular {
            border-color: var(--circular-color);
        }
        
        /* Graph Panel */
        .graph-panel {
            background: var(--header-bg);
            border-radius: 6px;
            padding: 20px;
            border: 1px solid var(--border-color);
        }
        
        .graph-container {
            background: var(--primary-bg);
            border-radius: 6px;
            border: 1px solid var(--border-color);
            height: 200px;
            position: relative;
            overflow: hidden;
        }
        
        #velocity-graph {
            width: 100%;
            height: 100%;
            display: block;
        }
        
        /* STATUS BAR - Simplified */
        .status-bar {
            background: var(--accent-color);
            padding: 8px 20px;
            font-size: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 8px;
        }
        
        .status-left, .status-right {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .status-item {
            display: flex;
            align-items: center;
            gap: 6px;
            white-space: nowrap;
        }
        
        .status-value {
            font-weight: 600;
        }
        
        /* Metrics Display */
        .metrics-display {
            background: var(--header-bg);
            border-radius: 6px;
            padding: 15px;
            border: 1px solid var(--border-color);
            margin-top: 10px;
        }
        
        .metrics-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 10px;
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }
        
        .metric-item {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        
        .metric-label {
            font-size: 11px;
            color: var(--text-muted);
        }
        
        .metric-value {
            font-size: 16px;
            font-weight: 600;
            color: var(--accent-color);
        }
        
        /* RESPONSIVE BREAKPOINTS */
        @media (max-width: 768px) {
            .simulation-container {
                padding: 10px;
            }
            
            .main-header {
                padding: 12px 15px;
                flex-direction: column;
                align-items: stretch;
                gap: 10px;
            }
            
            .controls-grid {
                grid-template-columns: 1fr;
            }
            
            .motion-types {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .metrics-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .status-bar {
                flex-direction: column;
                gap: 10px;
                align-items: stretch;
            }
            
            .status-left, .status-right {
                justify-content: space-between;
            }
        }
        
        @media (max-width: 480px) {
            .header-actions {
                flex-direction: column;
                width: 100%;
            }
            
            .header-btn {
                width: 100%;
                justify-content: center;
            }
            
            .motion-types {
                grid-template-columns: 1fr;
            }
            
            .metrics-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
        <div class="loading-text">Loading Motion Classifier Simulator...</div>
    </div>
    
    <!-- Main Simulation Container -->
    <div class="simulation-container">
        <!-- HEADER - Simplified -->
        <div class="main-header">
            <div class="header-left">
                <div class="header-title">Motion Classifier Simulator</div>
                <div class="header-subtitle">Physics Lab â€¢ Analyze & Classify Motion Types</div>
            </div>
            
            <div class="header-right">
                <div class="header-actions">
           
                   
                </div>
            </div>
        </div>
        
        <!-- MAIN CONTENT - Full width simulation only -->
        <div class="main-content">
            <div class="simulation-panel">
                <div class="simulation-header">
                    <div class="simulation-title">Motion Simulation Workspace</div>
                    <div class="motion-type-indicator" id="motionTypeIndicator">Uniform Motion</div>
                </div>
                
                <div class="simulation-area">
                    <!-- Motion Canvas -->
                    <div class="motion-canvas-container">
                        <canvas id="motion-canvas"></canvas>
                        <div class="canvas-grid"></div>
                        <div class="object-indicator" id="objectIndicator">
                            Position: (0, 0) | Velocity: 0 m/s
                        </div>
                    </div>
                    
                    <!-- Controls -->
                    <div class="controls-panel">
                        <div class="controls-title">
                            <i class="fas fa-sliders-h"></i> Motion Controls
                        </div>
                        <div class="controls-grid">
                            <div class="control-group">
                                <div class="control-label">
                                    <span>Speed Control</span>
                                    <span class="control-value" id="speedValue">1x</span>
                                </div>
                                <input type="range" class="control-slider" id="speedSlider" min="1" max="10" value="1" step="1" oninput="updateSpeed()">
                            </div>
                            
                            <div class="control-group">
                                <div class="control-label">
                                    <span>Motion Type</span>
                                    <span class="control-value" id="motionTypeValue">Uniform</span>
                                </div>
                                <div class="control-buttons">
                                    <button class="control-btn active" onclick="setMotionType('uniform')">
                                        <i class="fas fa-equals"></i> Uniform
                                    </button>
                                    <button class="control-btn" onclick="setMotionType('accelerated')">
                                        <i class="fas fa-angle-up"></i> Accelerated
                                    </button>
                                </div>
                            </div>
                            
                            <div class="control-group">
                                <div class="control-label">
                                    <span>Time Elapsed</span>
                                    <span class="control-value" id="timeValue">0s</span>
                                </div>
                                <div class="control-buttons">
                                    <button class="control-btn" onclick="startMotion()" id="startBtn">
                                        <i class="fas fa-play"></i> Start
                                    </button>
                                    <button class="control-btn" onclick="pauseMotion()" id="pauseBtn" disabled>
                                        <i class="fas fa-pause"></i> Pause
                                    </button>
                                    <button class="control-btn" onclick="resetMotion()">
                                        <i class="fas fa-redo"></i> Reset
                                    </button>
                                </div>
                            </div>
                            
                            <div class="control-group">
                                <div class="control-label">
                                    <span>Distance Traveled</span>
                                    <span class="control-value" id="distanceValue">0 m</span>
                                </div>
                                <button class="control-btn" onclick="classifyMotion()" style="grid-column: 1 / -1;">
                                    <i class="fas fa-tags"></i> Classify Motion Type
                                </button>
                            </div>
                            
                            <!-- Motion Type Selection -->
                            <div class="motion-types">
                                <button class="motion-type-btn uniform active" onclick="selectMotionType('uniform')">
                                    <i class="fas fa-equals"></i> Uniform
                                </button>
                                <button class="motion-type-btn accelerated" onclick="selectMotionType('accelerated')">
                                    <i class="fas fa-angle-up"></i> Accelerated
                                </button>
                                <button class="motion-type-btn decelerated" onclick="selectMotionType('decelerated')">
                                    <i class="fas fa-angle-down"></i> Decelerated
                                </button>
                                <button class="motion-type-btn circular" onclick="selectMotionType('circular')">
                                    <i class="fas fa-sync-alt"></i> Circular
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Velocity-Time Graph -->
                    <div class="graph-panel">
                        <div class="controls-title">
                            <i class="fas fa-chart-line"></i> Velocity-Time Graph
                        </div>
                        <div class="graph-container">
                            <canvas id="velocity-graph"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Metrics Display -->
        <div class="metrics-display">
            <div class="metrics-title">
                <i class="fas fa-chart-bar"></i> Simulation Metrics
            </div>
            <div class="metrics-grid">
                <div class="metric-item">
                    <div class="metric-label">Motion Types Tested</div>
                    <div class="metric-value" id="metricTypes">0</div>
                </div>
                <div class="metric-item">
                    <div class="metric-label">Speed Variations</div>
                    <div class="metric-value" id="metricSpeed">0</div>
                </div>
                <div class="metric-item">
                    <div class="metric-label">Distance Traveled</div>
                    <div class="metric-value" id="metricDistance">0 m</div>
                </div>
                <div class="metric-item">
                    <div class="metric-label">Graphs Plotted</div>
                    <div class="metric-value" id="metricGraphs">0</div>
                </div>
            </div>
        </div>
        
        <!-- STATUS BAR - Simplified -->
        <div class="status-bar">
            <div class="status-left">
                <div class="status-item">
                    <i class="fas fa-running"></i>
                    <span>Motion: <span class="status-value" id="statusMotion">Uniform</span></span>
                </div>
                <div class="status-item">
                    <i class="fas fa-bolt"></i>
                    <span>Velocity: <span class="status-value" id="statusVelocity">0 m/s</span></span>
                </div>
                <div class="status-item">
                    <i class="fas fa-arrows-alt-h"></i>
                    <span>Distance: <span class="status-value" id="statusDistance">0 m</span></span>
                </div>
            </div>
            
            <div class="status-right">
                <div class="status-item">
                    <i class="fas fa-clock"></i>
                    <span>Time: <span class="status-value" id="statusTime">0s</span></span>
                </div>
                <div class="status-item" id="statusReady">
                    <i class="fas fa-check-circle"></i>
                    <span>Ready</span>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // ===============================
        // AUTHENTICATION CHECK
        // ===============================
        const authToken = localStorage.getItem('authToken') || new URLSearchParams(window.location.search).get('token');
        
        if (!authToken) {
            window.location.href = '/login.html';
        }
        
        // ===============================
        // SIMULATION STATE
        // ===============================
        
        let canvas, ctx, graphCanvas, graphCtx;
        let motionState = {
            type: 'uniform',
            isRunning: false,
            speed: 1,
            time: 0,
            position: { x: 50, y: 200 },
            velocity: 2,
            acceleration: 0,
            distance: 0,
            angularVelocity: 0,
            radius: 100,
            centerX: 400,
            centerY: 200,
            animationId: null,
            velocityData: [],
            maxVelocity: 10
        };
        
        // Metrics tracking
        let metrics = {
            motionTypesTested: 0,
            speedVariations: 0,
            graphsPlotted: 0,
            uniqueSpeeds: new Set(),
            uniqueMotionTypes: new Set()
        };
        
        // ===============================
        // INITIALIZATION
        // ===============================
        
        function initialize() {
            try {
                // Setup canvas
                setupCanvas();
                setupGraph();
                setupEventListeners();
                
                // Update UI
                updateUI();
                updateMetrics();
                
                // Hide loading overlay
                setTimeout(() => {
                    document.getElementById('loadingOverlay').style.opacity = '0';
                    setTimeout(() => {
                        document.getElementById('loadingOverlay').style.display = 'none';
                    }, 300);
                }, 1000);
                
            } catch (error) {
                console.error('Initialization error:', error);
                document.getElementById('loadingOverlay').style.display = 'none';
                alert('Error loading simulation. Please refresh.');
            }
        }
        
        // ===============================
        // SIMULATION FUNCTIONS
        // ===============================
        
        function setupCanvas() {
            canvas = document.getElementById('motion-canvas');
            ctx = canvas.getContext('2d');
            
            // Set canvas size
            const container = canvas.parentElement;
            canvas.width = container.clientWidth;
            canvas.height = container.clientHeight;
            
            // Initial draw
            drawMotion();
        }
        
        function setupGraph() {
            graphCanvas = document.getElementById('velocity-graph');
            graphCtx = graphCanvas.getContext('2d');
            
            // Set graph size
            const container = graphCanvas.parentElement;
            graphCanvas.width = container.clientWidth;
            graphCanvas.height = container.clientHeight;
            
            // Initial graph
            drawGraph();
            
            // Track graph plotting
            if (metrics.graphsPlotted === 0) {
                metrics.graphsPlotted = 1;
                updateMetrics();
            }
        }
        
        function setupEventListeners() {
            window.addEventListener('resize', () => {
                const container = canvas.parentElement;
                canvas.width = container.clientWidth;
                canvas.height = container.clientHeight;
                drawMotion();
                
                const graphContainer = graphCanvas.parentElement;
                graphCanvas.width = graphContainer.clientWidth;
                graphCanvas.height = graphContainer.clientHeight;
                drawGraph();
            });
        }
        
        function drawMotion() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw grid
            drawGridLines();
            
            // Draw path
            drawPath();
            
            // Draw object
            drawObject();
            
            // Draw axes
            drawAxes();
        }
        
        function drawGridLines() {
            ctx.strokeStyle = 'var(--grid-color)';
            ctx.lineWidth = 1;
            
            // Vertical lines
            for (let x = 50; x < canvas.width; x += 50) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, canvas.height);
                ctx.stroke();
            }
            
            // Horizontal lines
            for (let y = 50; y < canvas.height; y += 50) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(canvas.width, y);
                ctx.stroke();
            }
        }
        
        function drawPath() {
            if (motionState.velocityData.length < 2) return;
            
            ctx.strokeStyle = 'rgba(0, 122, 204, 0.5)';
            ctx.lineWidth = 2;
            ctx.beginPath();
            
            motionState.velocityData.forEach((point, index) => {
                const x = 50 + (index * 20);
                const y = canvas.height - 50 - (point * 20);
                
                if (index === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            });
            
            ctx.stroke();
        }
        
        function drawObject() {
            const { x, y } = motionState.position;
            
            // Draw object
            ctx.fillStyle = getMotionColor();
            ctx.beginPath();
            ctx.arc(x, y, 15, 0, Math.PI * 2);
            ctx.fill();
            
            // Draw object outline
            ctx.strokeStyle = 'var(--border-color)';
            ctx.lineWidth = 2;
            ctx.stroke();
            
            // Draw velocity vector
            drawVector(x, y, motionState.velocity);
            
            // Update indicator
            document.getElementById('objectIndicator').innerHTML = 
                `Position: (${x.toFixed(0)}, ${y.toFixed(0)}) | Velocity: ${motionState.velocity.toFixed(1)} m/s`;
        }
        
        function drawVector(x, y, velocity) {
            const angle = motionState.type === 'circular' ? 
                Math.atan2(y - motionState.centerY, x - motionState.centerX) + Math.PI/2 : 0;
            const length = velocity * 10;
            
            ctx.strokeStyle = 'var(--velocity-color)';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(x, y);
            ctx.lineTo(x + length * Math.cos(angle), y + length * Math.sin(angle));
            ctx.stroke();
            
            // Draw arrow head
            ctx.fillStyle = 'var(--velocity-color)';
            ctx.beginPath();
            ctx.translate(x + length * Math.cos(angle), y + length * Math.sin(angle));
            ctx.rotate(angle);
            ctx.moveTo(0, 0);
            ctx.lineTo(-8, -4);
            ctx.lineTo(-8, 4);
            ctx.closePath();
            ctx.fill();
            ctx.setTransform(1, 0, 0, 1, 0, 0);
        }
        
        function drawAxes() {
            ctx.strokeStyle = 'var(--text-secondary)';
            ctx.lineWidth = 2;
            ctx.font = '12px Arial';
            ctx.fillStyle = 'var(--text-secondary)';
            
            // X-axis
            ctx.beginPath();
            ctx.moveTo(30, canvas.height - 30);
            ctx.lineTo(canvas.width - 30, canvas.height - 30);
            ctx.stroke();
            ctx.fillText('Position (m)', canvas.width / 2, canvas.height - 10);
            
            // Y-axis
            ctx.beginPath();
            ctx.moveTo(30, 30);
            ctx.lineTo(30, canvas.height - 30);
            ctx.stroke();
            ctx.save();
            ctx.translate(10, canvas.height / 2);
            ctx.rotate(-Math.PI / 2);
            ctx.fillText('Velocity (m/s)', 0, 0);
            ctx.restore();
        }
        
        function drawGraph() {
            graphCtx.clearRect(0, 0, graphCanvas.width, graphCanvas.height);
            
            if (motionState.velocityData.length === 0) return;
            
            // Draw grid
            drawGraphGrid();
            
            // Draw axes
            drawGraphAxes();
            
            // Draw velocity line
            drawVelocityLine();
        }
        
        function drawGraphGrid() {
            graphCtx.strokeStyle = 'var(--grid-color)';
            graphCtx.lineWidth = 1;
            
            // Vertical lines
            for (let x = 50; x < graphCanvas.width; x += 50) {
                graphCtx.beginPath();
                graphCtx.moveTo(x, 0);
                graphCtx.lineTo(x, graphCanvas.height);
                graphCtx.stroke();
            }
            
            // Horizontal lines
            for (let y = 50; y < graphCanvas.height; y += 50) {
                graphCtx.beginPath();
                graphCtx.moveTo(0, y);
                graphCtx.lineTo(graphCanvas.width, y);
                graphCtx.stroke();
            }
        }
        
        function drawGraphAxes() {
            graphCtx.strokeStyle = 'var(--text-secondary)';
            graphCtx.lineWidth = 2;
            graphCtx.font = '12px Arial';
            graphCtx.fillStyle = 'var(--text-secondary)';
            
            // X-axis
            graphCtx.beginPath();
            graphCtx.moveTo(30, graphCanvas.height - 30);
            graphCtx.lineTo(graphCanvas.width - 30, graphCanvas.height - 30);
            graphCtx.stroke();
            graphCtx.fillText('Time (s)', graphCanvas.width / 2, graphCanvas.height - 10);
            
            // Y-axis
            graphCtx.beginPath();
            graphCtx.moveTo(30, 30);
            graphCtx.lineTo(30, graphCanvas.height - 30);
            graphCtx.stroke();
            graphCtx.save();
            graphCtx.translate(10, graphCanvas.height / 2);
            graphCtx.rotate(-Math.PI / 2);
            graphCtx.fillText('Velocity (m/s)', 0, 0);
            graphCtx.restore();
            
            // Y-axis scale
            graphCtx.fillStyle = 'var(--text-muted)';
            for (let i = 0; i <= 5; i++) {
                const value = (motionState.maxVelocity * i / 5).toFixed(1);
                const y = graphCanvas.height - 30 - (graphCanvas.height - 60) * i / 5;
                graphCtx.fillText(value, 10, y + 3);
            }
        }
        
        function drawVelocityLine() {
            graphCtx.strokeStyle = 'var(--velocity-color)';
            graphCtx.lineWidth = 3;
            graphCtx.beginPath();
            
            motionState.velocityData.forEach((velocity, index) => {
                const x = 30 + (index * 40);
                const y = graphCanvas.height - 30 - (velocity / motionState.maxVelocity) * (graphCanvas.height - 60);
                
                if (index === 0) {
                    graphCtx.moveTo(x, y);
                } else {
                    graphCtx.lineTo(x, y);
                }
                
                // Draw point
                graphCtx.fillStyle = 'var(--velocity-color)';
                graphCtx.beginPath();
                graphCtx.arc(x, y, 4, 0, Math.PI * 2);
                graphCtx.fill();
            });
            
            graphCtx.stroke();
        }
        
        function getMotionColor() {
            switch(motionState.type) {
                case 'uniform': return 'var(--uniform-color)';
                case 'accelerated': return 'var(--accelerated-color)';
                case 'decelerated': return 'var(--decelerated-color)';
                case 'circular': return 'var(--circular-color)';
                default: return 'var(--accent-color)';
            }
        }
        
        function updateMotion() {
            if (!motionState.isRunning) return;
            
            const deltaTime = 0.1 * motionState.speed;
            motionState.time += deltaTime;
            
            switch(motionState.type) {
                case 'uniform':
                    motionState.position.x += motionState.velocity * deltaTime;
                    if (motionState.position.x > canvas.width - 50) {
                        motionState.position.x = 50;
                        motionState.velocityData = [];
                    }
                    break;
                    
                case 'accelerated':
                    motionState.acceleration = 0.5;
                    motionState.velocity += motionState.acceleration * deltaTime;
                    motionState.position.x += motionState.velocity * deltaTime;
                    if (motionState.position.x > canvas.width - 50) {
                        motionState.position.x = 50;
                        motionState.velocity = 2;
                        motionState.velocityData = [];
                    }
                    break;
                    
                case 'decelerated':
                    motionState.acceleration = -0.3;
                    motionState.velocity = Math.max(0.5, motionState.velocity + motionState.acceleration * deltaTime);
                    motionState.position.x += motionState.velocity * deltaTime;
                    if (motionState.position.x > canvas.width - 50) {
                        motionState.position.x = 50;
                        motionState.velocity = 5;
                        motionState.velocityData = [];
                    }
                    break;
                    
                case 'circular':
                    motionState.angularVelocity += 0.05 * deltaTime;
                    const angle = motionState.angularVelocity;
                    motionState.position.x = motionState.centerX + motionState.radius * Math.cos(angle);
                    motionState.position.y = motionState.centerY + motionState.radius * Math.sin(angle);
                    motionState.velocity = motionState.radius * 0.5;
                    break;
            }
            
            // Update distance
            motionState.distance += Math.abs(motionState.velocity * deltaTime);
            
            // Record velocity data
            motionState.velocityData.push(motionState.velocity);
            if (motionState.velocityData.length > 20) {
                motionState.velocityData.shift();
            }
            
            // Update UI
            updateUI();
            drawMotion();
            drawGraph();
            
            // Continue animation
            motionState.animationId = requestAnimationFrame(updateMotion);
        }
        
        function startMotion() {
            if (motionState.isRunning) return;
            
            motionState.isRunning = true;
            document.getElementById('startBtn').disabled = true;
            document.getElementById('pauseBtn').disabled = false;
            
            updateMotion();
        }
        
        function pauseMotion() {
            motionState.isRunning = false;
            document.getElementById('startBtn').disabled = false;
            document.getElementById('pauseBtn').disabled = true;
            
            if (motionState.animationId) {
                cancelAnimationFrame(motionState.animationId);
            }
        }
        
        function resetMotion() {
            pauseMotion();
            motionState.time = 0;
            motionState.distance = 0;
            motionState.position = { x: 50, y: 200 };
            motionState.velocity = 2;
            motionState.acceleration = 0;
            motionState.angularVelocity = 0;
            motionState.velocityData = [];
            
            updateUI();
            drawMotion();
            drawGraph();
        }
        
        function setMotionType(type) {
            motionState.type = type;
            resetMotion();
            
            // Update UI
            document.querySelectorAll('.control-btn').forEach(btn => btn.classList.remove('active'));
            event.currentTarget.classList.add('active');
            
            // Update motion type indicator
            document.getElementById('motionTypeIndicator').textContent = 
                type.charAt(0).toUpperCase() + type.slice(1) + ' Motion';
            document.getElementById('motionTypeValue').textContent = 
                type.charAt(0).toUpperCase() + type.slice(1);
            document.getElementById('statusMotion').textContent = 
                type.charAt(0).toUpperCase() + type.slice(1);
            
            // Track unique motion types
            if (!metrics.uniqueMotionTypes.has(type)) {
                metrics.uniqueMotionTypes.add(type);
                metrics.motionTypesTested = metrics.uniqueMotionTypes.size;
                updateMetrics();
            }
        }
        
        function selectMotionType(type) {
            setMotionType(type);
            
            // Update button states
            document.querySelectorAll('.motion-type-btn').forEach(btn => btn.classList.remove('active'));
            event.currentTarget.classList.add('active');
        }
        
        function updateSpeed() {
            const speed = parseInt(document.getElementById('speedSlider').value);
            motionState.speed = speed;
            document.getElementById('speedValue').textContent = `${speed}x`;
            
            // Track unique speeds
            if (!metrics.uniqueSpeeds.has(speed)) {
                metrics.uniqueSpeeds.add(speed);
                metrics.speedVariations = metrics.uniqueSpeeds.size;
                updateMetrics();
            }
        }
        
        function classifyMotion() {
            // Simple classification alert
            const classification = motionState.type === 'uniform' ? 'Uniform Motion (constant velocity)' :
                                  motionState.type === 'accelerated' ? 'Accelerated Motion (increasing velocity)' :
                                  motionState.type === 'decelerated' ? 'Decelerated Motion (decreasing velocity)' :
                                  'Circular Motion (constant speed, changing direction)';
            
            alert(`Motion Classification: ${classification}\n\nVelocity: ${motionState.velocity.toFixed(1)} m/s\nTime: ${motionState.time.toFixed(1)} s`);
        }
        
        function updateUI() {
            // Update time display
            document.getElementById('timeValue').textContent = `${motionState.time.toFixed(1)}s`;
            document.getElementById('statusTime').textContent = `${motionState.time.toFixed(1)}s`;
            
            // Update distance display
            document.getElementById('distanceValue').textContent = `${motionState.distance.toFixed(1)} m`;
            document.getElementById('statusDistance').textContent = `${motionState.distance.toFixed(1)} m`;
            
            // Update velocity display
            document.getElementById('statusVelocity').textContent = `${motionState.velocity.toFixed(1)} m/s`;
        }
        
        function updateMetrics() {
            document.getElementById('metricTypes').textContent = metrics.motionTypesTested;
            document.getElementById('metricSpeed').textContent = metrics.speedVariations;
            document.getElementById('metricDistance').textContent = `${motionState.distance.toFixed(1)} m`;
            document.getElementById('metricGraphs').textContent = metrics.graphsPlotted;
        }
        
        // ===============================
        // SESSION MANAGEMENT
        // ===============================
        
        function completeSession() {
            if (motionState.animationId) {
                cancelAnimationFrame(motionState.animationId);
            }
            
            // Show completion message with metrics
            const message = `Session Completed!\n\n` +
                          `Motion Types Tested: ${metrics.motionTypesTested}\n` +
                          `Speed Variations Tried: ${metrics.speedVariations}\n` +
                          `Total Distance: ${motionState.distance.toFixed(1)} m\n` +
                          `Final Time: ${motionState.time.toFixed(1)} s`;
            
            if (confirm(message + "\n\nReturn to dashboard?")) {
                window.location.href = '/dashboard';
            }
        }
        
        // ===============================
        // INITIALIZE ON LOAD
        // ===============================
        
        document.addEventListener('DOMContentLoaded', initialize);
    </script>
</body>
</html>