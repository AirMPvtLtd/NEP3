<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEP Workbench - Student Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: #1e1e1e;
            color: #ffffff;
            overflow: hidden;
            height: 100vh;
        }

        .dashboard {
            display: grid;
            grid-template-rows: 60px 1fr 35px;
            grid-template-columns: 250px 1fr;
            height: 100vh;
        }

        /* ============================================================ */
        /* HEADER */
        /* ============================================================ */
        .header {
            grid-column: 1 / -1;
            background: #333337;
            border-bottom: 1px solid #464647;
            display: flex;
            align-items: center;
            padding: 0 20px;
            gap: 20px;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            background: linear-gradient(135deg, #007acc, #00d4ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .search-box {
            display: flex;
            align-items: center;
            background: #2d2d30;
            border: 1px solid #464647;
            border-radius: 4px;
            padding: 5px 10px;
            flex: 0 1 300px;
        }

        .search-box input {
            background: transparent;
            border: none;
            color: white;
            width: 100%;
            outline: none;
        }

        .header-right {
            margin-left: auto;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .notification-bell {
            position: relative;
            cursor: pointer;
            padding: 8px;
            border-radius: 4px;
            transition: background 0.3s;
        }

        .notification-bell:hover {
            background: #3e3e42;
        }

        .notification-count {
            position: absolute;
            top: 2px;
            right: 2px;
            background: #ff4444;
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            padding: 6px 12px;
            border-radius: 4px;
            transition: background 0.3s;
        }

        .user-menu:hover {
            background: #3e3e42;
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, #007acc, #00d4ff);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        /* ============================================================ */
        /* SIDEBAR */
        /* ============================================================ */
        .sidebar {
            background: #252526;
            border-right: 1px solid #464647;
            padding: 20px;
            overflow-y: auto;
        }

        .nav-menu {
            list-style: none;
        }

        .nav-item {
            padding: 12px 15px;
            margin-bottom: 5px;
            cursor: pointer;
            border-radius: 6px;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: all 0.3s;
            color: #cccccc;
        }

        .nav-item:hover {
            background: #333337;
            color: #00d4ff;
        }

        .nav-item.active {
            background: linear-gradient(135deg, #007acc, #00d4ff);
            color: white;
        }

        .nav-item i {
            width: 20px;
        }

        /* ============================================================ */
        /* MAIN CONTENT */
        /* ============================================================ */
        .main-content {
            background: #1e1e1e;
            padding: 30px;
            overflow-y: auto;
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: #2d2d30;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #464647;
            transition: all 0.3s;
        }

        .stat-card:hover {
            border-color: #007acc;
            transform: translateY(-2px);
        }

        .stat-icon {
            font-size: 2rem;
            color: #007acc;
            margin-bottom: 10px;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
            background: linear-gradient(135deg, #007acc, #00d4ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .stat-label {
            color: #888;
            font-size: 0.85rem;
        }

        .panel {
            background: #2d2d30;
            border: 1px solid #464647;
            border-radius: 8px;
            padding: 25px;
            margin-bottom: 25px;
        }

        .panel h2 {
            font-size: 1.3rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .btn {
            padding: 10px 20px;
            background: linear-gradient(135deg, #007acc, #00d4ff);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 122, 204, 0.4);
        }

        .btn-secondary {
            background: #464647;
        }

        .btn-secondary:hover {
            background: #3e3e42;
        }

        .competency-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .competency-card {
            background: #333337;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #464647;
        }

        .competency-name {
            font-size: 0.9rem;
            margin-bottom: 10px;
            color: #cccccc;
        }

        .competency-bar {
            background: #1e1e1e;
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
        }

        .competency-fill {
            height: 100%;
            background: linear-gradient(90deg, #007acc, #00d4ff);
            transition: width 0.5s ease;
        }

        .competency-value {
            font-size: 0.85rem;
            color: #888;
            margin-top: 5px;
            text-align: right;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: #333337;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #464647;
        }

        th {
            font-weight: 600;
            color: #00d4ff;
        }

        tr:hover {
            background: #333337;
        }

        .badge {
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .badge-success {
            background: rgba(40, 167, 69, 0.2);
            color: #28a745;
        }

        .badge-warning {
            background: rgba(255, 193, 7, 0.2);
            color: #ffc107;
        }

        .badge-info {
            background: rgba(23, 162, 184, 0.2);
            color: #17a2b8;
        }

        .chart-container {
            height: 300px;
            margin-top: 20px;
        }

        /* ============================================================ */
        /* STATUS BAR */
        /* ============================================================ */
        .status-bar {
            grid-column: 1 / -1;
            background: #007acc;
            display: flex;
            align-items: center;
            padding: 0 20px;
            font-size: 0.8rem;
            gap: 20px;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* ============================================================ */
        /* RESPONSIVE */
        /* ============================================================ */
        @media (max-width: 1024px) {
            .dashboard {
                grid-template-columns: 60px 1fr;
            }
            
            .sidebar {
                width: 60px;
                padding: 10px 5px;
            }
            
            .nav-item span {
                display: none;
            }
        }

        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                display: none;
            }
        }

        /* ============================================================ */
        /* LOADING */
        /* ============================================================ */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-left-color: #007acc;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <!-- HEADER -->
        <header class="header">
            <div class="logo">
                <i class="fas fa-graduation-cap"></i>
                NEP Workbench
            </div>
            
            <div class="search-box">
                <i class="fas fa-search" style="color: #888; margin-right: 8px;"></i>
                <input type="text" placeholder="Search simulations..." id="searchInput">
            </div>
            
            <div class="header-right">
                <div class="notification-bell" id="notificationBell">
                    <i class="fas fa-bell"></i>
                    <span class="notification-count" id="notificationCount">0</span>
                </div>
                
                <div class="user-menu" id="userMenu">
                    <div class="user-avatar" id="userAvatar">S</div>
                    <div>
                        <div id="userName" style="font-weight: 600;">Student</div>
                        <div style="font-size: 0.75rem; color: #888;" id="userClass">Class --</div>
                    </div>
                    <i class="fas fa-chevron-down" style="font-size: 0.8rem;"></i>
                </div>
            </div>
        </header>

        <!-- SIDEBAR -->
        <aside class="sidebar">
            <ul class="nav-menu">
                <li class="nav-item active" onclick="showPage('overview')">
                    <i class="fas fa-home"></i>
                    <span>Dashboard</span>
                </li>
                <li class="nav-item" onclick="showPage('simulations')">
                    <i class="fas fa-flask"></i>
                    <span>Simulations</span>
                </li>
                <li class="nav-item" onclick="showPage('challenges')">
                    <i class="fas fa-brain"></i>
                    <span>Challenges</span>
                </li>
                <li class="nav-item" onclick="showPage('performance')">
                    <i class="fas fa-chart-line"></i>
                    <span>Performance</span>
                </li>
                <li class="nav-item" onclick="showPage('competencies')">
                    <i class="fas fa-star"></i>
                    <span>Competencies</span>
                </li>
                <li class="nav-item" onclick="showPage('reports')">
                    <i class="fas fa-file-alt"></i>
                    <span>Reports</span>
                </li>
                <li class="nav-item" onclick="showPage('help')">
                    <i class="fas fa-question-circle"></i>
                    <span>Help</span>
                </li>
            </ul>
        </aside>

        <!-- MAIN CONTENT -->
        <main class="main-content">
            <!-- OVERVIEW PAGE -->
            <div class="page active" id="overview">
                <h1>Welcome Back, <span id="welcomeName">Student</span>!</h1>
                <p style="color: #888; margin-bottom: 30px;">Here's your learning progress today</p>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-trophy"></i></div>
                        <div class="stat-value" id="completedCount">0</div>
                        <div class="stat-label">Challenges Completed</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-fire"></i></div>
                        <div class="stat-value" id="streakCount">0</div>
                        <div class="stat-label">Day Streak</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-chart-line"></i></div>
                        <div class="stat-value" id="piValue">--</div>
                        <div class="stat-label">Performance Index</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-star"></i></div>
                        <div class="stat-value" id="avgScore">--</div>
                        <div class="stat-label">Avg Score</div>
                    </div>
                </div>

                <div class="panel">
                    <h2><i class="fas fa-brain"></i> Recent Challenges</h2>
                    <table id="recentChallengesTable">
                        <thead>
                            <tr>
                                <th>Challenge</th>
                                <th>Type</th>
                                <th>Score</th>
                                <th>Status</th>
                                <th>Date</th>
                            </tr>
                        </thead>
                        <tbody id="recentChallengesBody">
                            <tr><td colspan="5" style="text-align: center;">Loading...</td></tr>
                        </tbody>
                    </table>
                </div>

                <div class="panel">
                    <h2><i class="fas fa-flask"></i> Quick Actions</h2>
                    <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                        <button class="btn" onclick="showPage('simulations')">
                            <i class="fas fa-play"></i> Start Simulation
                        </button>
                        <button class="btn" onclick="generateNewChallenge()">
                            <i class="fas fa-brain"></i> Generate Challenge
                        </button>
                        <button class="btn btn-secondary" onclick="showPage('performance')">
                            <i class="fas fa-chart-bar"></i> View Progress
                        </button>
                    </div>
                </div>
            </div>

            <!-- SIMULATIONS PAGE -->
            <div class="page" id="simulations">
                <h1><i class="fas fa-flask"></i> Interactive Simulations</h1>
                <p style="color: #888; margin-bottom: 30px;">44 simulations across Physics, Math, Chemistry, and Biology</p>
                
                <div id="simulationsGrid"></div>
            </div>

            <!-- CHALLENGES PAGE -->
            <div class="page" id="challenges">
                <h1><i class="fas fa-brain"></i> AI Challenges</h1>
                <p style="color: #888; margin-bottom: 30px;">Test your knowledge with AI-generated challenges</p>
                
                <div class="panel">
                    <h2>Challenge Limits</h2>
                    <p>Daily Remaining: <strong id="dailyLimit">--</strong></p>
                    <button class="btn" onclick="generateNewChallenge()">
                        <i class="fas fa-plus"></i> Generate New Challenge
                    </button>
                </div>

                <div class="panel">
                    <h2>Your Challenges</h2>
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Type</th>
                                <th>Difficulty</th>
                                <th>Score</th>
                                <th>Status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="allChallengesBody">
                            <tr><td colspan="6" style="text-align: center;">Loading...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- PERFORMANCE PAGE -->
            <div class="page" id="performance">
                <h1><i class="fas fa-chart-line"></i> Performance Analytics</h1>
                <p style="color: #888; margin-bottom: 30px;">Track your learning progress</p>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-graduation-cap"></i></div>
                        <div class="stat-value" id="perfPI">--</div>
                        <div class="stat-label">Performance Index</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-medal"></i></div>
                        <div class="stat-value" id="perfGrade">--</div>
                        <div class="stat-label">Current Grade</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-check-circle"></i></div>
                        <div class="stat-value" id="perfTotal">0</div>
                        <div class="stat-label">Total Completed</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-percentage"></i></div>
                        <div class="stat-value" id="perfAvg">0%</div>
                        <div class="stat-label">Average Score</div>
                    </div>
                </div>

                <div class="panel">
                    <h2>Performance Trend</h2>
                    <div class="chart-container">
                        <canvas id="performanceChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- COMPETENCIES PAGE -->
            <div class="page" id="competencies">
                <h1><i class="fas fa-star"></i> NEP 2020 Competencies</h1>
                <p style="color: #888; margin-bottom: 30px;">12 core competencies tracked</p>
                
                <div class="panel">
                    <h2>Competency Radar</h2>
                    <div class="chart-container">
                        <canvas id="competencyChart"></canvas>
                    </div>
                </div>

                <div class="panel">
                    <h2>Detailed Scores</h2>
                    <div class="competency-grid" id="competencyGrid"></div>
                </div>
            </div>

            <!-- REPORTS PAGE -->
            <div class="page" id="reports">
                <h1><i class="fas fa-file-alt"></i> NEP Reports</h1>
                <p style="color: #888; margin-bottom: 30px;">Comprehensive performance reports</p>
                
                <div class="panel">
                    <h2>Available Reports</h2>
                    <div id="reportsList"></div>
                </div>
            </div>

            <!-- HELP PAGE -->
            <div class="page" id="help">
                <h1><i class="fas fa-question-circle"></i> Help & Support</h1>
                <p style="color: #888; margin-bottom: 30px;">Get assistance with your learning</p>
                
                <div class="panel">
                    <h2>Create Help Ticket</h2>
                    <form id="helpTicketForm" onsubmit="createHelpTicket(event)">
                        <div style="margin-bottom: 15px;">
                            <input type="text" id="ticketSubject" placeholder="Subject" 
                                   style="width: 100%; padding: 10px; background: #333337; border: 1px solid #464647; color: white; border-radius: 4px;">
                        </div>
                        <div style="margin-bottom: 15px;">
                            <textarea id="ticketDescription" placeholder="Describe your issue..." rows="5"
                                      style="width: 100%; padding: 10px; background: #333337; border: 1px solid #464647; color: white; border-radius: 4px;"></textarea>
                        </div>
                        <button type="submit" class="btn">
                            <i class="fas fa-paper-plane"></i> Submit Ticket
                        </button>
                    </form>
                </div>

                <div class="panel">
                    <h2>My Tickets</h2>
                    <div id="ticketsList"></div>
                </div>
            </div>
        </main>

        <!-- STATUS BAR -->
        <footer class="status-bar">
            <div class="status-item">
                <i class="fas fa-clock"></i>
                <span id="sessionTime">Session: 0 min</span>
            </div>
            <div style="width: 1px; height: 16px; background: rgba(255,255,255,0.3);"></div>
            <div class="status-item">
                <i class="fas fa-calendar-day"></i>
                <span id="currentDate">--</span>
            </div>
            <div style="flex: 1;"></div>
            <div class="status-item">
                <i class="fas fa-signal"></i>
                <span>Connected</span>
            </div>
        </footer>
    </div>

    <!-- LOADING OVERLAY -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
    </div>

    <script>
        // ================================================================
        // CONFIGURATION
        // ================================================================
        const API_BASE_URL = 'http://localhost:3000/api';
        let authToken = localStorage.getItem('studentToken');
        let dashboardData = null;

        // ================================================================
        // NAVIGATION
        // ================================================================
        function showPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // Show selected page
            document.getElementById(pageId).classList.add('active');
            
            // Update nav active state
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            event.currentTarget.classList.add('active');
            
            // Load page data
            loadPageData(pageId);
        }

        // ================================================================
        // API HELPER
        // ================================================================
        async function apiCall(endpoint, options = {}) {
            try {
                const response = await fetch(`${API_BASE_URL}${endpoint}`, {
                    ...options,
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`,
                        ...options.headers
                    }
                });
                
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.message || 'API request failed');
                }
                
                return data;
            } catch (error) {
                console.error('API Error:', error);
                if (error.message.includes('401') || error.message.includes('token')) {
                    window.location.href = '/login.html';
                }
                throw error;
            }
        }

        // ================================================================
        // LOAD PAGE DATA
        // ================================================================
        async function loadPageData(pageId) {
            showLoading();
            try {
                switch(pageId) {
                    case 'overview':
                        await loadDashboard();
                        break;
                    case 'simulations':
                        await loadSimulations();
                        break;
                    case 'challenges':
                        await loadChallenges();
                        break;
                    case 'performance':
                        await loadPerformance();
                        break;
                    case 'competencies':
                        await loadCompetencies();
                        break;
                    case 'reports':
                        await loadReports();
                        break;
                    case 'help':
                        await loadHelpTickets();
                        break;
                }
            } catch (error) {
                console.error('Error loading page:', error);
            } finally {
                hideLoading();
            }
        }

        // ================================================================
        // DASHBOARD
        // ================================================================
        async function loadDashboard() {
            const data = await apiCall('/student/dashboard');
            dashboardData = data.data;
            
            // Update user info
            document.getElementById('userName').textContent = dashboardData.student.name;
            document.getElementById('welcomeName').textContent = dashboardData.student.name;
            document.getElementById('userClass').textContent = `Class ${dashboardData.student.class}${dashboardData.student.section}`;
            document.getElementById('userAvatar').textContent = dashboardData.student.name.charAt(0).toUpperCase();
            
            // Update stats
            document.getElementById('completedCount').textContent = dashboardData.stats.totalChallenges;
            document.getElementById('streakCount').textContent = dashboardData.stats.currentStreak;
            document.getElementById('piValue').textContent = dashboardData.student.performanceIndex.toFixed(1);
            document.getElementById('avgScore').textContent = dashboardData.stats.averageScore.toFixed(1);
            
            // Update recent challenges
            const tbody = document.getElementById('recentChallengesBody');
            tbody.innerHTML = dashboardData.recentChallenges.map(ch => `
                <tr>
                    <td>${ch.title || ch.challengeId}</td>
                    <td>${ch.simulationType}</td>
                    <td>${ch.score ? ch.score.toFixed(1) : 'N/A'}</td>
                    <td><span class="badge badge-${ch.status === 'evaluated' ? 'success' : 'warning'}">${ch.status}</span></td>
                    <td>${new Date(ch.generatedAt).toLocaleDateString()}</td>
                </tr>
            `).join('');
        }

        // ================================================================
        // SIMULATIONS
        // ================================================================
        async function loadSimulations() {
            const data = await apiCall('/student/simulations');
            // Implement simulations grid
        }

        // ================================================================
        // CHALLENGES
        // ================================================================
        async function loadChallenges() {
            const [limitsData, challengesData] = await Promise.all([
                apiCall('/student/challenges/limits'),
                apiCall('/student/challenges')
            ]);
            
            document.getElementById('dailyLimit').textContent = limitsData.data.daily.remaining;
            
            const tbody = document.getElementById('allChallengesBody');
            tbody.innerHTML = challengesData.data.challenges.map(ch => `
                <tr>
                    <td>${ch.challengeId}</td>
                    <td>${ch.simulationType}</td>
                    <td>${ch.difficulty}</td>
                    <td>${ch.results?.totalScore || 'N/A'}</td>
                    <td><span class="badge badge-info">${ch.status}</span></td>
                    <td><button class="btn btn-secondary" onclick="viewChallenge('${ch.challengeId}')">View</button></td>
                </tr>
            `).join('');
        }

        async function generateNewChallenge() {
            // Implement challenge generation
            alert('Challenge generation coming soon!');
        }

        // ================================================================
        // PERFORMANCE
        // ================================================================
        async function loadPerformance() {
            const data = await apiCall('/student/performance');
            const perf = data.data;
            
            document.getElementById('perfPI').textContent = perf.performance.performanceIndex.toFixed(1);
            document.getElementById('perfGrade').textContent = perf.performance.grade;
            document.getElementById('perfTotal').textContent = perf.performance.totalChallenges;
            document.getElementById('perfAvg').textContent = perf.performance.averageScore.toFixed(1) + '%';
            
            // Draw chart
            const ctx = document.getElementById('performanceChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: perf.trend.map(t => new Date(t.date).toLocaleDateString()),
                    datasets: [{
                        label: 'Score',
                        data: perf.trend.map(t => t.score),
                        borderColor: '#007acc',
                        backgroundColor: 'rgba(0, 122, 204, 0.1)',
                        borderWidth: 2,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }

        // ================================================================
        // COMPETENCIES
        // ================================================================
        async function loadCompetencies() {
            const data = await apiCall('/student/competencies');
            const competencies = data.data.competencies;
            
            // Draw radar chart
            const ctx = document.getElementById('competencyChart').getContext('2d');
            new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: Object.keys(competencies),
                    datasets: [{
                        label: 'Your Scores',
                        data: Object.values(competencies),
                        borderColor: '#007acc',
                        backgroundColor: 'rgba(0, 122, 204, 0.2)',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 100
                        }
                    }
                }
            });
            
            // Display competency cards
            const grid = document.getElementById('competencyGrid');
            grid.innerHTML = Object.entries(competencies).map(([name, score]) => `
                <div class="competency-card">
                    <div class="competency-name">${name}</div>
                    <div class="competency-bar">
                        <div class="competency-fill" style="width: ${score}%"></div>
                    </div>
                    <div class="competency-value">${score}/100</div>
                </div>
            `).join('');
        }

        // ================================================================
        // REPORTS
        // ================================================================
        async function loadReports() {
            const data = await apiCall('/student/reports/nep');
            const reports = data.data.reports;
            
            const list = document.getElementById('reportsList');
            list.innerHTML = reports.map(report => `
                <div style="padding: 15px; background: #333337; margin-bottom: 10px; border-radius: 6px;">
                    <h3>${report.reportId}</h3>
                    <p>${report.reportType} - ${new Date(report.generatedAt).toLocaleDateString()}</p>
                    <button class="btn btn-secondary" onclick="viewReport('${report.reportId}')">View</button>
                </div>
            `).join('');
        }

        // ================================================================
        // HELP TICKETS
        // ================================================================
        async function loadHelpTickets() {
            const data = await apiCall('/student/help-tickets');
            // Implement tickets display
        }

        async function createHelpTicket(event) {
            event.preventDefault();
            const subject = document.getElementById('ticketSubject').value;
            const description = document.getElementById('ticketDescription').value;
            
            await apiCall('/student/help-tickets', {
                method: 'POST',
                body: JSON.stringify({ subject, description })
            });
            
            alert('Ticket created successfully!');
            document.getElementById('helpTicketForm').reset();
        }

        // ================================================================
        // UTILITIES
        // ================================================================
        function showLoading() {
            document.getElementById('loadingOverlay').style.display = 'flex';
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').style.display = 'none';
        }

        // ================================================================
        // INIT
        // ================================================================
        async function init() {
            if (!authToken) {
                window.location.href = '/login.html';
                return;
            }
            
            await loadDashboard();
            hideLoading();
            
            // Update date
            document.getElementById('currentDate').textContent = new Date().toLocaleDateString();
        }

        // Start app
        init();
    </script>
</body>
</html>