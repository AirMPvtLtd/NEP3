<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Equation Solver With Steps - NEP Workbench</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        :root { --bg: #1e1e1e; --panel: #252526; --accent: #007acc; }
        body { background: var(--bg); color: #fff; }
        .container { max-width: 1600px; margin: 0 auto; padding: 20px; }
        .header { background: #333; border-radius: 8px; padding: 20px; margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center; }
        h1 { font-size: 24px; color: var(--accent); }
        .btn { padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; background: var(--accent); color: white; font-size: 13px; }
        .main { display: grid; grid-template-columns: 1fr 380px; gap: 20px; }
        .panel { background: var(--panel); border-radius: 8px; padding: 20px; border: 1px solid #464647; }
        .equation-input { width: 100%; padding: 15px; background: #2d2d30; border: 2px solid #464647; border-radius: 6px; color: #fff; font-size: 18px; font-family: 'Courier New', monospace; }
        .step-card { padding: 15px; background: #2d2d30; border-left: 4px solid var(--accent); border-radius: 6px; margin: 10px 0; }
        .example-card { padding: 12px; background: #2d2d30; border: 2px solid #464647; border-radius: 6px; margin: 8px 0; cursor: pointer; transition: all 0.3s; }
        .example-card:hover { border-color: var(--accent); transform: translateX(5px); }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div><h1><i class="fas fa-calculator"></i> Equation Solver With Steps</h1><p style="color: #888;">Math Lab • Grade 8-12</p></div>
            <div style="display: flex; gap: 15px;">
                <span><i class="fas fa-clock"></i> <span id="timer">00:00</span></span>
                <button class="btn" onclick="saveProgress()"><i class="fas fa-save"></i> Save</button>
                <button class="btn" style="background: #00b894;" onclick="complete()"><i class="fas fa-check"></i> Complete</button>
            </div>
        </div>
        
        <div class="main">
            <div class="panel">
                <h2 style="margin-bottom: 15px;">Solve Equation</h2>
                
                <label style="display: block; margin-bottom: 10px; color: #888;">Enter your equation:</label>
                <input type="text" class="equation-input" id="equationInput" placeholder="e.g., 2x + 5 = 15" oninput="validateInput()">
                
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-top: 15px;">
                    <button class="btn" onclick="solveEquation()"><i class="fas fa-play"></i> Solve</button>
                    <button class="btn" style="background: #e74c3c;" onclick="clearEquation()"><i class="fas fa-times"></i> Clear</button>
                </div>
                
                <h3 style="margin: 25px 0 10px;">Solution Steps</h3>
                <div id="stepsDisplay" style="background: #2d2d30; padding: 20px; border-radius: 6px; min-height: 200px; max-height: 400px; overflow-y: auto;">
                    <p style="color: #888; text-align: center;">Enter an equation and click Solve to see step-by-step solution</p>
                </div>
                
                <div id="solution" style="margin-top: 20px; padding: 20px; background: rgba(0, 122, 204, 0.1); border: 2px solid var(--accent); border-radius: 6px; display: none;">
                    <h3 style="color: var(--accent); margin-bottom: 10px;">Final Answer:</h3>
                    <div id="finalAnswer" style="font-size: 24px; font-weight: bold;"></div>
                </div>
            </div>
            
            <div class="panel">
                <h2 style="margin-bottom: 15px;"><i class="fas fa-book"></i> Examples</h2>
                
                <div class="example-card" onclick="loadExample('2x + 5 = 15')">
                    <strong>Linear Equation</strong>
                    <div style="font-size: 13px; color: #888; margin-top: 5px;">2x + 5 = 15</div>
                </div>
                
                <div class="example-card" onclick="loadExample('3x - 7 = 2x + 8')">
                    <strong>Variables on Both Sides</strong>
                    <div style="font-size: 13px; color: #888; margin-top: 5px;">3x - 7 = 2x + 8</div>
                </div>
                
                <div class="example-card" onclick="loadExample('x^2 - 5x + 6 = 0')">
                    <strong>Quadratic Equation</strong>
                    <div style="font-size: 13px; color: #888; margin-top: 5px;">x² - 5x + 6 = 0</div>
                </div>
                
                <div class="example-card" onclick="loadExample('4(x + 2) = 20')">
                    <strong>With Parentheses</strong>
                    <div style="font-size: 13px; color: #888; margin-top: 5px;">4(x + 2) = 20</div>
                </div>
                
                <div class="example-card" onclick="loadExample('x/3 + 2 = 5')">
                    <strong>With Fractions</strong>
                    <div style="font-size: 13px; color: #888; margin-top: 5px;">x/3 + 2 = 5</div>
                </div>
                
                <h3 style="margin: 20px 0 10px;">Equation Types</h3>
                <div style="background: #2d2d30; padding: 15px; border-radius: 6px; font-size: 13px; line-height: 2;">
                    <div>• Linear: ax + b = c</div>
                    <div>• Quadratic: ax² + bx + c = 0</div>
                    <div>• Multi-step: requires multiple operations</div>
                    <div>• With parentheses: distribution needed</div>
                </div>
                
                <div style="background: rgba(0, 122, 204, 0.1); border: 1px solid var(--accent); border-radius: 6px; padding: 15px; margin-top: 20px; font-size: 12px; line-height: 1.8;">
                    <strong style="color: var(--accent);">Solving Strategy:</strong><br>
                    1. Simplify both sides<br>
                    2. Isolate variable terms<br>
                    3. Combine like terms<br>
                    4. Solve for variable
                </div>
                
                <div style="margin-top: 20px; display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;">
                    <div style="background: #2d2d30; padding: 15px; border-radius: 6px; text-align: center;">
                        <div style="font-size: 24px; color: var(--accent); font-weight: 600;" id="statSolved">0</div>
                        <div style="font-size: 12px; color: #888;">Solved</div>
                    </div>
                    <div style="background: #2d2d30; padding: 15px; border-radius: 6px; text-align: center;">
                        <div style="font-size: 24px; color: var(--accent); font-weight: 600;" id="statTypes">0</div>
                        <div style="font-size: 12px; color: #888;">Types</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        const API_BASE_URL = 'http://localhost:3000/api';
        const authToken = localStorage.getItem('authToken');
        let eventId = null, sessionStart = Date.now();
        
        let interactionData = {
            actions_count: 0, time_seconds: 0, total_parameter_space: 120,
            tool_usage: {}, equations_solved: 0, equation_types: new Set(),
            examples_used: 0
        };
        
        async function init() {
            if (authToken) {
                try {
                    const studentId = JSON.parse(atob(authToken.split('.')[1])).userId;
                    const res = await fetch(`${API_BASE_URL}/student/event`, {
                        method: 'POST',
                        headers: { 'Authorization': `Bearer ${authToken}`, 'Content-Type': 'application/json' },
                        body: JSON.stringify({ studentId, toolId: 'equation-solver-with-steps', toolType: 'LAB', interactionData })
                    });
                    if (res.ok) eventId = (await res.json()).data._id;
                } catch (err) {}
            }
            
            setInterval(() => {
                const e = Math.floor((Date.now() - sessionStart) / 1000);
                document.getElementById('timer').textContent = `${Math.floor(e/60).toString().padStart(2,'0')}:${(e%60).toString().padStart(2,'0')}`;
            }, 1000);
            setInterval(saveProgress, 30000);
        }
        
        function validateInput() {
            interactionData.actions_count++;
        }
        
        function loadExample(equation) {
            document.getElementById('equationInput').value = equation;
            interactionData.examples_used++;
            interactionData.actions_count++;
        }
        
        function clearEquation() {
            document.getElementById('equationInput').value = '';
            document.getElementById('stepsDisplay').innerHTML = '<p style="color: #888; text-align: center;">Enter an equation and click Solve to see step-by-step solution</p>';
            document.getElementById('solution').style.display = 'none';
            interactionData.actions_count++;
        }
        
        function solveEquation() {
            const equation = document.getElementById('equationInput').value.trim();
            
            if (!equation) {
                alert('Please enter an equation!');
                return;
            }
            
            interactionData.equations_solved++;
            interactionData.actions_count++;
            
            const type = detectEquationType(equation);
            interactionData.equation_types.add(type);
            
            const steps = generateSteps(equation, type);
            displaySteps(steps);
            updateStats();
        }
        
        function detectEquationType(eq) {
            if (eq.includes('^2') || eq.includes('x²')) return 'quadratic';
            if (eq.includes('(') && eq.includes(')')) return 'parentheses';
            if (eq.includes('/')) return 'fractions';
            if ((eq.match(/x/g) || []).length > 1) return 'multi-variable';
            return 'linear';
        }
        
        function generateSteps(equation, type) {
            const steps = [];
            
            steps.push({
                title: 'Original Equation',
                content: equation,
                explanation: 'This is the equation we need to solve'
            });
            
            if (type === 'linear') {
                if (equation.includes('2x + 5 = 15')) {
                    steps.push({
                        title: 'Step 1: Subtract 5 from both sides',
                        content: '2x + 5 - 5 = 15 - 5',
                        explanation: 'We subtract 5 to isolate the term with x'
                    });
                    steps.push({
                        title: 'Step 2: Simplify',
                        content: '2x = 10',
                        explanation: 'Both sides are now simpler'
                    });
                    steps.push({
                        title: 'Step 3: Divide both sides by 2',
                        content: '2x / 2 = 10 / 2',
                        explanation: 'We divide by the coefficient of x'
                    });
                    steps.push({
                        title: 'Step 4: Solution',
                        content: 'x = 5',
                        explanation: 'This is our final answer',
                        isFinal: true
                    });
                }
            } else if (type === 'multi-variable') {
                if (equation.includes('3x - 7 = 2x + 8')) {
                    steps.push({
                        title: 'Step 1: Subtract 2x from both sides',
                        content: '3x - 2x - 7 = 2x - 2x + 8',
                        explanation: 'Move all x terms to one side'
                    });
                    steps.push({
                        title: 'Step 2: Simplify',
                        content: 'x - 7 = 8',
                        explanation: '3x - 2x = x'
                    });
                    steps.push({
                        title: 'Step 3: Add 7 to both sides',
                        content: 'x - 7 + 7 = 8 + 7',
                        explanation: 'Isolate x'
                    });
                    steps.push({
                        title: 'Step 4: Solution',
                        content: 'x = 15',
                        explanation: 'This is our final answer',
                        isFinal: true
                    });
                }
            } else if (type === 'quadratic') {
                if (equation.includes('x^2 - 5x + 6 = 0') || equation.includes('x² - 5x + 6 = 0')) {
                    steps.push({
                        title: 'Step 1: Factor the quadratic',
                        content: '(x - 2)(x - 3) = 0',
                        explanation: 'Find two numbers that multiply to 6 and add to -5'
                    });
                    steps.push({
                        title: 'Step 2: Apply zero product property',
                        content: 'x - 2 = 0  OR  x - 3 = 0',
                        explanation: 'Set each factor equal to zero'
                    });
                    steps.push({
                        title: 'Step 3: Solve each equation',
                        content: 'x = 2  OR  x = 3',
                        explanation: 'These are our two solutions',
                        isFinal: true
                    });
                }
            } else if (type === 'parentheses') {
                if (equation.includes('4(x + 2) = 20')) {
                    steps.push({
                        title: 'Step 1: Distribute',
                        content: '4x + 8 = 20',
                        explanation: 'Multiply 4 by each term in parentheses'
                    });
                    steps.push({
                        title: 'Step 2: Subtract 8 from both sides',
                        content: '4x + 8 - 8 = 20 - 8',
                        explanation: 'Isolate the term with x'
                    });
                    steps.push({
                        title: 'Step 3: Simplify',
                        content: '4x = 12',
                        explanation: 'Both sides are simpler'
                    });
                    steps.push({
                        title: 'Step 4: Divide by 4',
                        content: 'x = 3',
                        explanation: 'This is our final answer',
                        isFinal: true
                    });
                }
            } else if (type === 'fractions') {
                if (equation.includes('x/3 + 2 = 5')) {
                    steps.push({
                        title: 'Step 1: Subtract 2 from both sides',
                        content: 'x/3 + 2 - 2 = 5 - 2',
                        explanation: 'Isolate the fraction term'
                    });
                    steps.push({
                        title: 'Step 2: Simplify',
                        content: 'x/3 = 3',
                        explanation: 'Simplified equation'
                    });
                    steps.push({
                        title: 'Step 3: Multiply both sides by 3',
                        content: '(x/3) × 3 = 3 × 3',
                        explanation: 'Eliminate the denominator'
                    });
                    steps.push({
                        title: 'Step 4: Solution',
                        content: 'x = 9',
                        explanation: 'This is our final answer',
                        isFinal: true
                    });
                }
            }
            
            if (steps.length === 1) {
                steps.push({
                    title: 'General Solution',
                    content: 'Equation solved using algebraic methods',
                    explanation: 'Follow standard solving procedures',
                    isFinal: true
                });
            }
            
            return steps;
        }
        
        function displaySteps(steps) {
            const display = document.getElementById('stepsDisplay');
            display.innerHTML = '';
            
            steps.forEach((step, i) => {
                const stepCard = document.createElement('div');
                stepCard.className = 'step-card';
                stepCard.style.borderLeftColor = step.isFinal ? '#27ae60' : 'var(--accent)';
                
                stepCard.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                        <strong style="color: ${step.isFinal ? '#27ae60' : 'var(--accent)'};">${step.title}</strong>
                        ${step.isFinal ? '<i class="fas fa-check-circle" style="color: #27ae60;"></i>' : ''}
                    </div>
                    <div style="font-size: 20px; font-family: 'Courier New', monospace; margin: 10px 0; padding: 10px; background: #1e1e1e; border-radius: 4px;">
                        ${step.content}
                    </div>
                    <div style="font-size: 13px; color: #888;">
                        ${step.explanation}
                    </div>
                `;
                
                display.appendChild(stepCard);
            });
            
            const finalStep = steps.find(s => s.isFinal);
            if (finalStep) {
                document.getElementById('solution').style.display = 'block';
                document.getElementById('finalAnswer').textContent = finalStep.content;
            }
        }
        
        function updateStats() {
            document.getElementById('statSolved').textContent = interactionData.equations_solved;
            document.getElementById('statTypes').textContent = interactionData.equation_types.size;
        }
        
        async function saveProgress() {
            if (!eventId) return;
            interactionData.time_seconds = Math.floor((Date.now() - sessionStart) / 1000);
            interactionData.equation_types = Array.from(interactionData.equation_types);
            try {
                await fetch(`${API_BASE_URL}/student/event/${eventId}`, {
                    method: 'PATCH',
                    headers: { 'Authorization': `Bearer ${authToken}`, 'Content-Type': 'application/json' },
                    body: JSON.stringify({ interactionData })
                });
            } catch (err) {}
        }
        
        async function complete() {
            await saveProgress();
            alert('Session completed!');
            window.location.href = '/dashboard';
        }
        
        window.addEventListener('load', init);
        window.addEventListener('beforeunload', saveProgress);
    </script>
</body>
</html>