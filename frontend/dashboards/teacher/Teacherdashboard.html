<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teacher Dashboard - NEP Workbench</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
        }
        
        :root {
            --bg-dark: #1e1e1e;
            --panel-dark: #252526;
            --border-color: #464647;
            --accent-blue: #007acc;
            --accent-cyan: #00d4ff;
            --success-green: #27ae60;
            --warning-yellow: #f39c12;
            --danger-red: #e74c3c;
            --text-primary: #ffffff;
            --text-secondary: #888888;
        }
        
        body { 
            background: var(--bg-dark); 
            color: var(--text-primary); 
            overflow-x: hidden; 
        }
        
        /* DASHBOARD LAYOUT */
        .dashboard {
            display: grid;
            grid-template-rows: 60px 1fr;
            grid-template-columns: 250px 1fr;
            height: 100vh;
        }
        
        /* HEADER */
        .header {
            grid-column: 1 / -1;
            background: #333337;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            padding: 0 30px;
            gap: 20px;
            z-index: 100;
        }
        
        .logo {
            font-size: 1.4rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-cyan));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .header-actions {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-left: auto;
        }
        
        .notification-bell {
            position: relative;
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            transition: all 0.3s;
        }
        
        .notification-bell:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .notification-badge {
            position: absolute;
            top: 5px;
            right: 5px;
            background: var(--danger-red);
            color: white;
            font-size: 0.65rem;
            padding: 2px 5px;
            border-radius: 10px;
            font-weight: bold;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            padding: 8px 15px;
            border-radius: 8px;
            transition: background 0.3s;
        }
        
        .user-info:hover { 
            background: #3e3e42; 
        }
        
        .avatar {
            width: 38px;
            height: 38px;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-cyan));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1rem;
        }
        
        .user-details {
            display: flex;
            flex-direction: column;
        }
        
        .user-name {
            font-size: 0.9rem;
            font-weight: 600;
        }
        
        .user-role {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }
        
        /* SIDEBAR */
        .sidebar {
            background: var(--panel-dark);
            border-right: 1px solid var(--border-color);
            padding: 20px 0;
            overflow-y: auto;
        }
        
        .nav-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 14px 25px;
            cursor: pointer;
            transition: all 0.3s;
            color: var(--text-secondary);
            font-size: 0.95rem;
            position: relative;
        }
        
        .nav-item:hover {
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-primary);
        }
        
        .nav-item.active {
            background: rgba(0, 122, 204, 0.15);
            color: var(--accent-cyan);
            border-left: 3px solid var(--accent-cyan);
        }
        
        .nav-item i {
            width: 20px;
            text-align: center;
        }
        
        .badge-notification {
            position: absolute;
            right: 20px;
            background: var(--danger-red);
            color: white;
            font-size: 0.7rem;
            padding: 2px 7px;
            border-radius: 10px;
            font-weight: bold;
        }
        
        /* MAIN CONTENT */
        .main-content {
            background: var(--bg-dark);
            overflow-y: auto;
            padding: 30px;
        }
        
        .page {
            display: none;
        }
        
        .page.active {
            display: block;
            animation: fadeIn 0.3s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* HEADER SECTION */
        .page-header {
            margin-bottom: 25px;
        }
        
        .page-header h1 {
            font-size: 2rem;
            margin-bottom: 8px;
        }
        
        .page-header p {
            color: var(--text-secondary);
            font-size: 0.95rem;
        }
        
        /* STATISTICS CARDS */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: var(--panel-dark);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 25px;
            display: flex;
            align-items: center;
            gap: 20px;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(180deg, var(--accent-blue), var(--accent-cyan));
        }
        
        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 212, 255, 0.1);
        }
        
        .stat-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, rgba(0, 122, 204, 0.2), rgba(0, 212, 255, 0.2));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: var(--accent-cyan);
        }
        
        .stat-details {
            flex: 1;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: var(--text-secondary);
            font-size: 0.85rem;
            font-weight: 500;
        }
        
        .stat-change {
            font-size: 0.75rem;
            margin-top: 5px;
        }
        
        .stat-change.positive {
            color: var(--success-green);
        }
        
        .stat-change.negative {
            color: var(--danger-red);
        }
        
        /* PANELS */
        .panel {
            background: var(--panel-dark);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
        }
        
        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .panel-header h2 {
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .panel-actions {
            display: flex;
            gap: 10px;
        }
        
        /* CUSTOM CSS CHARTS */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
            gap: 25px;
            margin-bottom: 25px;
        }
        
        .chart-container {
            background: var(--panel-dark);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 25px;
            height: 350px;
        }
        
        .chart-container.full-width {
            grid-column: 1 / -1;
        }
        
        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .chart-header h3 {
            font-size: 1.1rem;
            font-weight: 600;
        }
        
        .chart-filters {
            display: flex;
            gap: 8px;
        }
        
        .filter-btn {
            padding: 6px 12px;
            background: transparent;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s;
        }
        
        .filter-btn:hover,
        .filter-btn.active {
            background: var(--accent-blue);
            color: white;
            border-color: var(--accent-blue);
        }
        
        /* SIMPLE BAR CHART */
        .simple-bar-chart {
            display: flex;
            align-items: flex-end;
            height: 260px;
            gap: 10px;
            margin-top: 20px;
            padding: 0 10px;
            position: relative;
        }

        .simple-bar-chart::before {
            content: '';
            position: absolute;
            left: 0;
            right: 0;
            bottom: 0;
            height: 1px;
            background: var(--border-color);
        }

        .simple-bar-chart::after {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 1px;
            background: var(--border-color);
        }

        .chart-bar {
            flex: 1;
            background: linear-gradient(to top, var(--accent-blue), var(--accent-cyan));
            border-radius: 4px 4px 0 0;
            position: relative;
            min-height: 10px;
            transition: all 0.3s ease;
        }

        .chart-bar:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }

        .bar-value {
            position: absolute;
            top: -25px;
            left: 0;
            right: 0;
            text-align: center;
            color: var(--accent-cyan);
            font-weight: 600;
            font-size: 0.9rem;
        }

        .bar-label {
            position: absolute;
            bottom: -25px;
            left: 0;
            right: 0;
            text-align: center;
            color: var(--text-secondary);
            font-size: 0.8rem;
        }

        .chart-grid-lines {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
        }

        .grid-line {
            position: absolute;
            left: 0;
            right: 0;
            border-top: 1px dashed rgba(255, 255, 255, 0.1);
        }

        .grid-label {
            position: absolute;
            left: -30px;
            transform: translateY(-50%);
            color: var(--text-secondary);
            font-size: 0.7rem;
        }

        /* DONUT CHART */
        .donut-chart-container {
            width: 250px;
            height: 250px;
            margin: 0 auto;
            position: relative;
        }

        .donut-chart {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            position: relative;
            background: conic-gradient(
                #27ae60 0% var(--donut-segment-1),
                #f39c12 var(--donut-segment-1) var(--donut-segment-2),
                var(--accent-cyan) var(--donut-segment-2) var(--donut-segment-3),
                #888888 var(--donut-segment-3) 100%
            );
        }

        .donut-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 130px;
            height: 130px;
            background: var(--panel-dark);
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .donut-total {
            font-size: 2rem;
            font-weight: 700;
            color: var(--accent-cyan);
        }

        .donut-label {
            color: var(--text-secondary);
            font-size: 0.8rem;
        }

        .donut-legend {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .donut-legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.8rem;
        }

        .donut-legend-color {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        /* RADAR CHART */
        .radar-chart {
            width: 250px;
            height: 250px;
            margin: 0 auto;
            position: relative;
        }

        .radar-grid {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: 50%;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transform: rotate(-90deg);
        }

        .radar-grid:nth-child(1) { transform: rotate(-90deg) scale(0.2); }
        .radar-grid:nth-child(2) { transform: rotate(-90deg) scale(0.4); }
        .radar-grid:nth-child(3) { transform: rotate(-90deg) scale(0.6); }
        .radar-grid:nth-child(4) { transform: rotate(-90deg) scale(0.8); }
        .radar-grid:nth-child(5) { transform: rotate(-90deg) scale(1); }

        .radar-axis {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 1px;
            height: 125px;
            background: rgba(255, 255, 255, 0.1);
            transform-origin: 0 0;
        }

        .radar-point {
            position: absolute;
            width: 8px;
            height: 8px;
            background: var(--accent-blue);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            z-index: 2;
        }

        .radar-polygon {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            fill: rgba(0, 122, 204, 0.2);
            stroke: var(--accent-blue);
            stroke-width: 2;
        }

        .radar-label {
            position: absolute;
            color: var(--text-secondary);
            font-size: 0.7rem;
            transform: translate(-50%, -50%);
        }

        /* HORIZONTAL BAR CHART */
        .horizontal-bar-chart {
            height: 260px;
            margin-top: 20px;
            position: relative;
            overflow-y: auto;
            padding-right: 10px;
        }

        .horizontal-bar {
            margin-bottom: 15px;
        }

        .bar-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 0.85rem;
        }

        .bar-name {
            color: var(--text-primary);
        }

        .bar-count {
            color: var(--accent-cyan);
            font-weight: 600;
        }

        .bar-track {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
        }

        .bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-blue), var(--accent-cyan));
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        /* TABLES */
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        thead {
            background: rgba(255, 255, 255, 0.02);
        }
        
        th {
            text-align: left;
            padding: 15px;
            font-weight: 600;
            color: var(--text-secondary);
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 2px solid var(--border-color);
        }
        
        td {
            padding: 15px;
            border-bottom: 1px solid var(--border-color);
        }
        
        tbody tr {
            transition: background 0.2s;
        }
        
        tbody tr:hover {
            background: rgba(255, 255, 255, 0.03);
        }
        
        /* BUTTONS */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-cyan));
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 212, 255, 0.3);
        }
        
        .btn-secondary {
            background: var(--panel-dark);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
        }
        
        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .btn-success {
            background: var(--success-green);
            color: white;
        }
        
        .btn-warning {
            background: var(--warning-yellow);
            color: white;
        }
        
        .btn-danger {
            background: var(--danger-red);
            color: white;
        }
        
        .btn-sm {
            padding: 6px 12px;
            font-size: 0.8rem;
        }
        
        /* BADGES */
        .badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            display: inline-block;
        }
        
        .badge-success {
            background: rgba(39, 174, 96, 0.2);
            color: var(--success-green);
        }
        
        .badge-warning {
            background: rgba(243, 156, 18, 0.2);
            color: var(--warning-yellow);
        }
        
        .badge-danger {
            background: rgba(231, 76, 60, 0.2);
            color: var(--danger-red);
        }
        
        .badge-info {
            background: rgba(0, 122, 204, 0.2);
            color: var(--accent-cyan);
        }
        
        /* PROGRESS BAR */
        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-blue), var(--accent-cyan));
            border-radius: 10px;
            transition: width 0.3s;
        }
        
        /* STUDENT CARDS */
        .student-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .student-card {
            background: var(--panel-dark);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s;
        }
        
        .student-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .student-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .student-avatar {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-cyan));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.2rem;
        }
        
        .student-info h3 {
            font-size: 1rem;
            margin-bottom: 3px;
        }
        
        .student-meta {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }
        
        .student-stats {
            margin-top: 15px;
        }
        
        .student-stat {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 0.85rem;
        }
        
        .student-stat label {
            color: var(--text-secondary);
        }
        
        .student-stat value {
            font-weight: 600;
        }
        
        /* ALERT CARDS */
        .alert-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .alert-card {
            background: var(--panel-dark);
            border-left: 4px solid var(--danger-red);
            border-radius: 8px;
            padding: 20px;
        }
        
        .alert-card.warning {
            border-left-color: var(--warning-yellow);
        }
        
        .alert-card.info {
            border-left-color: var(--accent-cyan);
        }
        
        .alert-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 10px;
        }
        
        .alert-icon {
            width: 40px;
            height: 40px;
            background: rgba(231, 76, 60, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--danger-red);
        }
        
        .alert-card.warning .alert-icon {
            background: rgba(243, 156, 18, 0.2);
            color: var(--warning-yellow);
        }
        
        /* MODAL */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .modal-content {
            background: var(--panel-dark);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            padding: 25px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h2 {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .modal-close {
            background: transparent;
            border: none;
            color: var(--text-secondary);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 5px;
            transition: color 0.3s;
        }
        
        .modal-close:hover {
            color: var(--text-primary);
        }
        
        .modal-body {
            padding: 25px;
        }
        
        /* SEARCH & FILTERS */
        .filters-bar {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .search-input {
            flex: 1;
            min-width: 250px;
            padding: 12px 15px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 0.9rem;
        }
        
        .search-input:focus {
            outline: none;
            border-color: var(--accent-blue);
        }
        
        /* DARK THEME DROPDOWN STYLES */
        select, .select-style {
            padding: 12px 15px;
            background: var(--panel-dark);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 0.9rem;
            cursor: pointer;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='white'%3e%3cpath d='M7 10l5 5 5-5z'/%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 15px center;
            background-size: 16px;
            padding-right: 40px;
        }
        
        select:hover, .select-style:hover {
            border-color: var(--accent-blue);
        }
        
        select:focus, .select-style:focus {
            outline: none;
            border-color: var(--accent-blue);
            box-shadow: 0 0 0 2px rgba(0, 122, 204, 0.2);
        }
        
        select option, .select-style option {
            background: var(--panel-dark);
            color: var(--text-primary);
            padding: 10px;
        }
        
        /* FORM CONTROLS */
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-secondary);
            font-weight: 500;
        }
        
        .form-control {
            width: 100%;
            padding: 12px 15px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 0.9rem;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--accent-blue);
        }
        
        /* SWITCH TOGGLE */
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }
        
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: var(--accent-blue);
        }
        
        input:checked + .slider:before {
            transform: translateX(26px);
        }
        
        /* PROFILE PAGE */
        .profile-header {
            display: flex;
            align-items: center;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .profile-avatar {
            width: 120px;
            height: 120px;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-cyan));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 2.5rem;
        }
        
        .profile-info h2 {
            font-size: 2rem;
            margin-bottom: 5px;
        }
        
        .profile-meta {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
        
        .profile-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
        }
        
        .profile-card {
            background: var(--panel-dark);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 25px;
        }
        
        .profile-card h3 {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            font-size: 1.1rem;
        }
        
        /* LOADING STATE */
        .loading {
            text-align: center;
            padding: 40px;
            color: var(--text-secondary);
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top-color: var(--accent-cyan);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* SCROLLBAR */
        ::-webkit-scrollbar {
            width: 10px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--bg-dark);
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 5px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        
        /* RESPONSIVE */
        @media (max-width: 1024px) {
            .dashboard {
                grid-template-columns: 200px 1fr;
            }
            
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            .simple-bar-chart {
                height: 200px;
            }
            
            .radar-chart {
                width: 200px;
                height: 200px;
            }
        }
        
        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                display: none;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .profile-header {
                flex-direction: column;
                text-align: center;
            }
            
            .simple-bar-chart {
                height: 180px;
            }
            
            .donut-chart-container {
                width: 200px;
                height: 200px;
            }
            
            .donut-center {
                width: 100px;
                height: 100px;
            }
        }
        /* ============================================ */
        /* NEP TEACHING STUDIO STYLES */
        /* ============================================ */

        .teaching-studio-layout {
            display: grid;
            grid-template-columns: 320px 1fr 280px;
            gap: 20px;
            height: calc(100vh - 150px);
            margin-top: 20px;
        }

        .studio-left-panel,
        .studio-center-panel,
        .studio-right-panel {
            display: flex;
            flex-direction: column;
        }

        .studio-left-panel .panel,
        .studio-center-panel .panel,
        .studio-right-panel .panel {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        /* LEFT PANEL - INPUT FORMS */
        .input-form-container {
            flex: 1;
            overflow-y: auto;
            padding-right: 10px;
        }

        .form-section {
            margin-bottom: 25px;
        }

        .form-section h4 {
            color: var(--accent-cyan);
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--border-color);
            font-size: 0.95rem;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-secondary);
            font-size: 0.85rem;
            font-weight: 500;
        }

        .form-actions {
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
            display: flex;
            gap: 10px;
        }

        /* RIGHT PANEL - TOOLS */
        .tools-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .tool-btn {
            background: var(--panel-dark);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 15px;
            text-align: left;
            cursor: pointer;
            transition: all 0.3s;
            color: var(--text-primary);
        }

        .tool-btn:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: var(--accent-blue);
        }

        .tool-btn.active {
            background: rgba(0, 122, 204, 0.15);
            border-color: var(--accent-cyan);
            border-left: 3px solid var(--accent-cyan);
        }

        .tool-btn i {
            font-size: 1.2rem;
            color: var(--accent-cyan);
            margin-bottom: 8px;
        }

        .tool-btn span {
            display: block;
            font-weight: 600;
            margin-bottom: 3px;
        }

        .tool-btn small {
            color: var(--text-secondary);
            font-size: 0.75rem;
        }

        /* WORKFLOW PROGRESS */
        .workflow-progress {
            margin-top: 25px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
        }

        .progress-steps {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .progress-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }

        .step-number {
            width: 30px;
            height: 30px;
            background: var(--bg-dark);
            border: 2px solid var(--border-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .progress-step.active .step-number {
            background: var(--accent-blue);
            border-color: var(--accent-cyan);
            color: white;
        }

        .step-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-align: center;
        }

        .progress-step.active .step-label {
            color: var(--accent-cyan);
        }

        .progress-line {
            flex: 1;
            height: 2px;
            background: var(--border-color);
            margin: 0 5px;
        }

        .progress-step.active ~ .progress-step .step-number {
            background: var(--panel-dark);
        }

        /* AI SUGGESTIONS */
        .suggestions-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .suggestion-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 8px;
            border: 1px solid transparent;
            transition: all 0.3s;
            cursor: pointer;
        }

        .suggestion-item:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: var(--border-color);
        }

        .suggestion-icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, rgba(0, 122, 204, 0.2), rgba(0, 212, 255, 0.2));
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--accent-cyan);
            flex-shrink: 0;
        }

        .suggestion-content strong {
            display: block;
            font-size: 0.9rem;
            margin-bottom: 3px;
        }

        .suggestion-content p {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin: 0;
        }

        /* HISTORY */
        .history-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .history-item {
            padding: 12px;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 8px;
            border: 1px solid transparent;
            cursor: pointer;
            transition: all 0.3s;
        }

        .history-item:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: var(--border-color);
        }

        .history-title {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 3px;
            color: var(--text-primary);
        }

        .history-meta {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        /* CENTER PANEL - WORKSPACE */
        .workspace-container {
            flex: 1;
            overflow-y: auto;
            background: var(--panel-dark);
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .empty-workspace {
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* CONTENT WORKSPACE STYLES */
        .content-preview {
            padding: 30px;
        }

        .lesson-header {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--border-color);
        }

        .lesson-title {
            font-size: 1.8rem;
            margin-bottom: 10px;
            color: var(--accent-cyan);
        }

        .lesson-meta {
            display: flex;
            gap: 15px;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .lesson-section {
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 1.2rem;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
            color: var(--accent-cyan);
        }

        /* NOTES CONTENT */
        .notes-content {
            line-height: 1.6;
        }

        .notes-content h3 {
            color: var(--text-primary);
            margin: 20px 0 10px 0;
            font-size: 1.1rem;
        }

        .notes-content p {
            margin-bottom: 15px;
            color: var(--text-secondary);
        }

        .notes-content ul, .notes-content ol {
            margin-left: 20px;
            margin-bottom: 15px;
            color: var(--text-secondary);
        }

        .notes-content li {
            margin-bottom: 8px;
        }

        /* QUESTIONS STYLES */
        .question-item {
            margin-bottom: 25px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .question-type {
            font-size: 0.85rem;
            padding: 4px 10px;
            background: rgba(0, 122, 204, 0.2);
            color: var(--accent-cyan);
            border-radius: 12px;
            font-weight: 600;
        }

        .question-difficulty {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .question-text {
            font-size: 1rem;
            margin-bottom: 15px;
            color: var(--text-primary);
            line-height: 1.5;
        }

        .question-options {
            margin-bottom: 15px;
        }

        .question-option {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
            padding: 8px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 6px;
        }

        .option-letter {
            width: 24px;
            height: 24px;
            background: var(--panel-dark);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .option-correct .option-letter {
            background: var(--success-green);
            color: white;
            border-color: var(--success-green);
        }

        .question-answer {
            padding: 12px;
            background: rgba(39, 174, 96, 0.1);
            border-left: 3px solid var(--success-green);
            border-radius: 4px;
            margin-top: 10px;
        }

        /* SIMULATOR PREVIEW */
        .simulator-preview {
            height: 400px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .simulator-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        /* RESPONSIVE DESIGN */
        @media (max-width: 1200px) {
            .teaching-studio-layout {
                grid-template-columns: 280px 1fr 250px;
            }
        }

        @media (max-width: 992px) {
            .teaching-studio-layout {
                grid-template-columns: 1fr;
                height: auto;
            }
            
            .studio-left-panel,
            .studio-right-panel {
                order: 2;
            }
            
            .studio-center-panel {
                order: 1;
                margin-bottom: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <!-- HEADER -->
        <div class="header">
            <div class="logo">
                <i class="fas fa-graduation-cap"></i>
                NEP Workbench
            </div>
            
            <div class="header-actions">
                <div class="notification-bell">
                    <i class="fas fa-bell" style="font-size: 1.2rem;"></i>
                    <span class="notification-badge" id="notificationCount" style="display: none;">0</span>
                </div>
                
                <div class="user-info" onclick="toggleUserMenu()">
                    <div class="avatar" id="userAvatar">T</div>
                    <div class="user-details">
                        <div class="user-name" id="userName">Teacher Name</div>
                        <div class="user-role">Teacher</div>
                    </div>
                    <i class="fas fa-chevron-down" style="font-size: 0.8rem;"></i>
                </div>
            </div>
        </div>
        
        <!-- SIDEBAR -->
        <div class="sidebar">
            <div class="nav-item active" onclick="showPage('overview')">
                <i class="fas fa-home"></i>
                <span>Overview</span>
            </div>
            <div class="nav-item" onclick="showPage('students')">
                <i class="fas fa-users"></i>
                <span>My Students</span>
            </div>
            <div class="nav-item" onclick="showPage('classes')">
                <i class="fas fa-chalkboard"></i>
                <span>Classes</span>
            </div>
            <div class="nav-item" onclick="showPage('analytics')">
                <i class="fas fa-chart-line"></i>
                <span>Analytics</span>
            </div>
            <div class="nav-item" onclick="showPage('reports')">
                <i class="fas fa-file-alt"></i>
                <span>Reports</span>
            </div>
            <div class="nav-item" onclick="showPage('profile')">
                <i class="fas fa-user"></i>
                <span>My Profile</span>
            </div>
            <div class="nav-item" onclick="showPage('teaching-studio')">
                <i class="fas fa-chalkboard-teacher"></i>
                <span>NEP Teaching Studio</span>
            </div>
 <!--            <div class="nav-item" onclick="showPage('profile')">
                <i class="fas fa-user"></i>
                <span>Smart Notes</span>
            </div>
            <div class="nav-item" onclick="showPage('profile')">
                <i class="fas fa-user"></i>
                <span>Industry Practice Lab</span>
            </div>
            <div class="nav-item" onclick="showPage('profile')">
                <i class="fas fa-user"></i>
                <span>Question Builder</span>
            </div>
            <div class="nav-item" onclick="showPage('profile')">
                <i class="fas fa-user"></i>
                <span>Concept Simulators</span>
            </div>
            <div class="nav-item" onclick="showPage('profile')">
                <i class="fas fa-user"></i>
                <span>Industry Specialization</span>
            </div> -->
<!--             <div class="nav-item" onclick="showPage('help')">
                <i class="fas fa-question-circle"></i>
                <span>Help Tickets</span>
            </div> -->

            <div class="nav-item" onclick="showPage('validations')">
                <i class="fas fa-check-circle"></i>
                <span>Class Performance</span>
                <span class="badge-notification" id="pendingCount" style="display:none;">0</span>
            </div>
            <div class="nav-item" onclick="showPage('help')">
                <i class="fas fa-question-circle"></i>
                <span>Help</span>
            </div>
            <div class="nav-item" style="margin-top: auto; border-top: 1px solid var(--border-color); padding-top: 20px;" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i>
                <span>Logout</span>
            </div>
        </div>
        
        <!-- MAIN CONTENT -->
        <div class="main-content">
            
            <!-- OVERVIEW PAGE -->
            <div class="page active" id="overview">
                <div class="page-header">
                    <h1>Welcome back, <span id="teacherNameDisplay">Teacher</span>! ðŸ‘‹</h1>
                    <p>Here's your classroom overview for today</p>
                </div>
                
                <!-- STATISTICS CARDS -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-details">
                            <div class="stat-value" id="totalStudents">0</div>
                            <div class="stat-label">Total Students</div>
                            <div class="stat-change positive">
                                <i class="fas fa-arrow-up"></i> Active
                            </div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="stat-details">
                            <div class="stat-value" id="avgPerformance">0%</div>
                            <div class="stat-label">Average Performance</div>
                            <div class="stat-change" id="performanceChange">
                                <i class="fas fa-minus"></i> No change
                            </div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-clipboard-check"></i>
                        </div>
                        <div class="stat-details">
                            <div class="stat-value" id="totalChallenges">0</div>
                            <div class="stat-label">Total Challenges</div>
                            <div class="stat-change positive">
                                <i class="fas fa-check"></i> Evaluated
                            </div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-details">
                            <div class="stat-value" id="pendingReviews">0</div>
                            <div class="stat-label">Pending Reviews</div>
                            <div class="stat-change warning">
                                <i class="fas fa-hourglass-half"></i> Awaiting
                            </div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-chalkboard-teacher"></i>
                        </div>
                        <div class="stat-details">
                            <div class="stat-value" id="totalClasses">0</div>
                            <div class="stat-label">Active Classes</div>
                            <div class="stat-change positive">
                                <i class="fas fa-check"></i> Running
                            </div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-life-ring"></i>
                        </div>
                        <div class="stat-details">
                            <div class="stat-value" id="openTickets">0</div>
                            <div class="stat-label">Open Tickets</div>
                            <div class="stat-change" id="ticketChange">
                                <i class="fas fa-minus"></i> Support
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- CHARTS SECTION -->
                <div class="charts-grid">
                    <!-- PERFORMANCE TREND CHART -->
                    <div class="chart-container full-width">
                        <div class="chart-header">
                            <h3><i class="fas fa-chart-line"></i> Student Performance Trend</h3>
                            <div class="chart-filters">
                                <button class="filter-btn active" onclick="changeChartPeriod(7)">7 Days</button>
                                <button class="filter-btn" onclick="changeChartPeriod(30)">30 Days</button>
                                <button class="filter-btn" onclick="changeChartPeriod(90)">3 Months</button>
                            </div>
                        </div>
                        <div class="simple-bar-chart" id="performanceTrendChart">
                            <!-- Performance bars will be inserted here -->
                        </div>
                    </div>
                    
                    <!-- COMPETENCY RADAR CHART -->
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3><i class="fas fa-brain"></i> NEP Competencies</h3>
                        </div>
                        <div class="radar-chart" id="competencyRadarChart">
                            <!-- Radar chart will be generated here -->
                        </div>
                    </div>
                    
                    <!-- CHALLENGE STATUS DONUT CHART -->
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3><i class="fas fa-tasks"></i> Challenge Status</h3>
                        </div>
                        <div class="donut-chart-container" id="challengeStatusChart">
                            <!-- Donut chart will be generated here -->
                        </div>
                    </div>
                    
                    <!-- PERFORMANCE DISTRIBUTION -->
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3><i class="fas fa-chart-bar"></i> Performance Distribution</h3>
                        </div>
                        <div class="simple-bar-chart" id="performanceDistributionChart">
                            <!-- Distribution bars will be inserted here -->
                        </div>
                    </div>
                    
                    <!-- SIMULATION USAGE -->
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3><i class="fas fa-flask"></i> Top Simulations</h3>
                        </div>
                        <div class="horizontal-bar-chart" id="simulationUsageChart">
                            <!-- Horizontal bars will be inserted here -->
                        </div>
                    </div>
                </div>
                
                <!-- STUDENTS NEEDING ATTENTION -->
                <div class="panel">
                    <div class="panel-header">
                        <h2><i class="fas fa-exclamation-triangle"></i> Students Needing Attention</h2>
                        <button class="btn btn-secondary btn-sm">
                            <i class="fas fa-filter"></i> Filter
                        </button>
                    </div>
                    
                    <div class="alert-grid" id="studentsNeedingAttention">
                        <div class="loading">
                            <div class="spinner"></div>
                            <p>Loading students...</p>
                        </div>
                    </div>
                </div>
                
                <!-- TOP PERFORMERS -->
                <div class="panel">
                    <div class="panel-header">
                        <h2><i class="fas fa-trophy"></i> Top Performers</h2>
                        <button class="btn btn-secondary btn-sm">
                            <i class="fas fa-crown"></i> View All
                        </button>
                    </div>
                    
                    <div class="student-grid" id="topPerformers">
                        <div class="loading">
                            <div class="spinner"></div>
                            <p>Loading students...</p>
                        </div>
                    </div>
                </div>
                
                <!-- RECENT CHALLENGES -->
                <div class="panel">
                    <div class="panel-header">
                        <h2><i class="fas fa-history"></i> Recent Challenges</h2>
                    </div>
                    
                    <table>
                        <thead>
                            <tr>
                                <th>Challenge ID</th>
                                <th>Student</th>
                                <th>Simulation</th>
                                <th>Difficulty</th>
                                <th>Status</th>
                                <th>Score</th>
                                <th>Date</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="recentChallenges">
                            <tr>
                                <td colspan="8" style="text-align: center; color: var(--text-secondary);">
                                    <div class="loading">
                                        <div class="spinner"></div>
                                        <p>Loading challenges...</p>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- STUDENTS PAGE -->
            <div class="page" id="students">
                <div class="page-header">
                    <h1>My Students</h1>
                    <p>Manage and track your students' progress</p>
                </div>
                
                <div class="filters-bar">
                    <input type="text" class="search-input" placeholder="Search students by name or ID..." id="studentSearch">
                    <select id="classFilter">
                        <option value="">All Classes</option>
                        <option value="6">Class 6</option>
                        <option value="7">Class 7</option>
                        <option value="8">Class 8</option>
                        <option value="9">Class 9</option>
                        <option value="10">Class 10</option>
                        <option value="11">Class 11</option>
                        <option value="12">Class 12</option>
                    </select>
                    <select id="sectionFilter">
                        <option value="">All Sections</option>
                        <option value="A">Section A</option>
                        <option value="B">Section B</option>
                        <option value="C">Section C</option>
                    </select>
                    <button class="btn btn-primary" onclick="openAddStudentModal()">
                        <i class="fas fa-plus"></i> Add Student
                    </button>
                </div>
                
                <div class="panel">
                    <table>
                        <thead>
                            <tr>
                                <th>Student ID</th>
                                <th>Name</th>
                                <th>Class</th>
                                <th>Section</th>
                                <th>Performance Index</th>
                                <th>Grade</th>
                                <th>Total Challenges</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="studentsList">
                            <tr>
                                <td colspan="8">
                                    <div class="loading">
                                        <div class="spinner"></div>
                                        <p>Loading students...</p>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- VALIDATIONS PAGE -->
            <div class="page" id="validations">
                <div class="page-header">
                    <h1>Validation Queue</h1>
                    <p>Review and validate AI-generated challenges</p>
                </div>
                
                <div class="panel">
                    <table>
                        <thead>
                            <tr>
                                <th>Challenge ID</th>
                                <th>Student</th>
                                <th>Simulation Type</th>
                                <th>Difficulty</th>
                                <th>Status</th>
                                <th>Submitted</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="validationsList">
                            <tr>
                                <td colspan="7">
                                    <div class="loading">
                                        <div class="spinner"></div>
                                        <p>Loading pending challenges...</p>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- CLASSES PAGE -->
            <div class="page" id="classes">
                <div class="page-header">
                    <h1>My Classes</h1>
                    <p>View and manage your class sections</p>
                </div>
                
                <div class="student-grid" id="classesList">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>Loading classes...</p>
                    </div>
                </div>
            </div>
            
            <!-- ANALYTICS PAGE -->
            <div class="page" id="analytics">
                <div class="page-header">
                    <h1>Analytics & Insights</h1>
                    <p>Detailed performance analytics and trends</p>
                </div>
                
                <div class="charts-grid">
                    <div class="chart-container full-width">
                        <div class="chart-header">
                            <h3><i class="fas fa-chart-area"></i> Weekly Engagement Trend</h3>
                        </div>
                        <div class="simple-bar-chart" id="engagementTrendChart">
                            <!-- Engagement bars will be inserted here -->
                        </div>
                    </div>
                    
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3><i class="fas fa-graduation-cap"></i> Subject-wise Performance</h3>
                        </div>
                        <div class="simple-bar-chart" id="subjectPerformanceChart">
                            <!-- Subject bars will be inserted here -->
                        </div>
                    </div>
                    
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3><i class="fas fa-tasks"></i> Challenge Difficulty vs Success</h3>
                        </div>
                        <div class="simple-bar-chart" id="difficultySuccessChart">
                            <!-- Difficulty bars will be inserted here -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- REPORTS PAGE -->
            <div class="page" id="reports">
                <div class="page-header">
                    <h1>Reports</h1>
                    <p>Generate and download performance reports</p>
                </div>
                
                <div class="panel">
                    <h3>Generate Class Report</h3>
                    <div class="filters-bar">
                        <select id="reportClass">
                            <option value="">Select Class</option>
                        </select>
                        <select id="reportSection">
                            <option value="">Select Section</option>
                        </select>
                        <button class="btn btn-primary" onclick="generateClassReport()">
                            <i class="fas fa-file-pdf"></i> Generate Report
                        </button>
                    </div>
                </div>
                
                <div class="panel">
                    <h3>Student Individual Report</h3>
                    <div class="filters-bar">
                        <input type="text" class="search-input" placeholder="Enter Student ID" id="reportStudentId">
                        <button class="btn btn-primary" onclick="generateStudentReport()">
                            <i class="fas fa-file-pdf"></i> Generate Report
                        </button>
                    </div>
                </div>
            </div>



            <!-- NEP TEACHING STUDIO PAGE -->
            <div class="page" id="teaching-studio">
                <div class="page-header">
                    <h1><i class="fas fa-chalkboard-teacher"></i> NEP Teaching Studio</h1>
                    <p>Create structured lessons with notes, questions, simulators in one guided flow</p>
                </div>
                
                <!-- TEACHING STUDIO LAYOUT -->
                <div class="teaching-studio-layout">
                    <!-- LEFT PANEL - DYNAMIC INPUT FORM -->
                    <div class="studio-left-panel">
                        <div class="panel">
                            <div class="panel-header">
                                <h2 id="input-panel-title">Configure Lesson</h2>
                                <div id="tool-status" class="badge badge-info">Notes-Builder</div>
                            </div>
                            
                            <div class="input-form-container" id="input-form-container">
                                <!-- Dynamic forms will load here based on selected tool -->
                                <div class="loading">
                                    <div class="spinner"></div>
                                    <p>Loading configuration...</p>
                                </div>
                            </div>
                            
                            <div class="form-actions">
                                <button class="btn btn-primary" id="generate-btn">
                                    <i class="fas fa-magic"></i> Generate Content
                                </button>
                                <button class="btn btn-secondary" id="clear-btn">
                                    <i class="fas fa-trash"></i> Clear
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- CENTER PANEL - MAIN WORKSPACE -->
                    <div class="studio-center-panel">
                        <div class="panel">
                            <div class="panel-header">
                                <h2><i class="fas fa-file-alt"></i> Generated Content</h2>
                                <div class="panel-actions">
                                    <button class="btn btn-secondary btn-sm" id="edit-toggle">
                                        <i class="fas fa-edit"></i> Edit Mode
                                    </button>
                                </div>
                            </div>
                            
                            <div class="workspace-container" id="workspace-container">
                                <!-- Empty State -->
                                <div class="empty-workspace" id="empty-workspace">
                                    <div style="text-align: center; padding: 60px 20px;">
                                        <i class="fas fa-chalkboard" style="font-size: 3rem; color: var(--text-secondary); margin-bottom: 20px;"></i>
                                        <h3 style="color: var(--text-secondary); margin-bottom: 10px;">No Content Generated Yet</h3>
                                        <p style="color: var(--text-secondary); max-width: 400px; margin: 0 auto;">
                                            Configure your settings on the left panel and click "Generate Content"
                                        </p>
                                    </div>
                                </div>
                                
                                <!-- Generated content will be inserted here -->
                                <div id="content-workspace" style="display: none;">
                                    <!-- Dynamic content loads here -->
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- RIGHT PANEL - TOOLS & GUIDANCE -->
                    <div class="studio-right-panel">
                        <!-- TOOLS SECTION -->
                        <div class="panel">
                            <div class="panel-header">
                                <h3><i class="fas fa-tools"></i> Tools</h3>
                            </div>
                            <div class="tools-list">
                                <button class="tool-btn active" data-tool="notes-builder" onclick="selectTool('notes-builder')">
                                    <i class="fas fa-file-alt"></i>
                                    <span>Notes-Builder</span>
                                    <small>Step 1: Create foundation</small>
                                </button>
                                
                                <button class="tool-btn" data-tool="question-builder" onclick="selectTool('question-builder')">
                                    <i class="fas fa-question-circle"></i>
                                    <span>Question-Builder</span>
                                    <small>Step 2: Create assessments</small>
                                </button>
                                
                                <button class="tool-btn" data-tool="simulator-builder" onclick="selectTool('simulator-builder')">
                                    <i class="fas fa-flask"></i>
                                    <span>Simulator-Builder</span>
                                    <small>Step 3: Create experiences</small>
                                </button>
                                
                                <button class="tool-btn" data-tool="export-pdf" onclick="selectTool('export-pdf')">
                                    <i class="fas fa-file-pdf"></i>
                                    <span>Export as PDF</span>
                                    <small>Step 4: Final document</small>
                                </button>
                            </div>
                            
                            <div class="workflow-progress">
                                <div class="progress-steps">
                                    <div class="progress-step active">
                                        <div class="step-number">1</div>
                                        <div class="step-label">Notes</div>
                                    </div>
                                    <div class="progress-line"></div>
                                    <div class="progress-step">
                                        <div class="step-number">2</div>
                                        <div class="step-label">Questions</div>
                                    </div>
                                    <div class="progress-line"></div>
                                    <div class="progress-step">
                                        <div class="step-number">3</div>
                                        <div class="step-label">Simulator</div>
                                    </div>
                                    <div class="progress-line"></div>
                                    <div class="progress-step">
                                        <div class="step-number">4</div>
                                        <div class="step-label">Export</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- AI SUGGESTIONS SECTION -->
                        <div class="panel">
                            <div class="panel-header">
                                <h3><i class="fas fa-lightbulb"></i> AI Enhancements</h3>
                            </div>
                            <div class="suggestions-container">
                                <div class="suggestion-item">
                                    <div class="suggestion-icon">
                                        <i class="fas fa-briefcase"></i>
                                    </div>
                                    <div class="suggestion-content">
                                        <strong>Case Study</strong>
                                        <p>Add real-world industry example</p>
                                    </div>
                                </div>
                                
                                <div class="suggestion-item">
                                    <div class="suggestion-icon">
                                        <i class="fas fa-exclamation-triangle"></i>
                                    </div>
                                    <div class="suggestion-content">
                                        <strong>Common Misconceptions</strong>
                                        <p>Address typical student mistakes</p>
                                    </div>
                                </div>
                                
                                <div class="suggestion-item">
                                    <div class="suggestion-icon">
                                        <i class="fas fa-chart-line"></i>
                                    </div>
                                    <div class="suggestion-content">
                                        <strong>Real-world Application</strong>
                                        <p>Show practical uses of this concept</p>
                                    </div>
                                </div>
                                
                                <button class="btn btn-primary" style="width: 100%; margin-top: 15px;" onclick="addAIEnhancements()">
                                    <i class="fas fa-plus"></i> Add AI Enhancements
                                </button>
                            </div>
                        </div>
                        
                        <!-- HISTORY SECTION -->
                        <div class="panel">
                            <div class="panel-header">
                                <h3><i class="fas fa-history"></i> Recent Lessons</h3>
                            </div>
                            <div class="history-list" id="history-list">
                                <div class="history-item" onclick="loadLesson('lesson-1')">
                                    <div class="history-title">Newton's Laws of Motion</div>
                                    <div class="history-meta">Physics â€¢ Class 10 â€¢ 2 hours ago</div>
                                </div>
                                
                                <div class="history-item" onclick="loadLesson('lesson-2')">
                                    <div class="history-title">Chemical Reactions</div>
                                    <div class="history-meta">Chemistry â€¢ Class 9 â€¢ Yesterday</div>
                                </div>
                                
                                <div class="history-item" onclick="loadLesson('lesson-3')">
                                    <div class="history-title">Algebra Basics</div>
                                    <div class="history-meta">Mathematics â€¢ Class 8 â€¢ 3 days ago</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- PROFILE PAGE -->
            <div class="page" id="profile">
                <div class="page-header">
                    <h1>My Profile</h1>
                    <p>Manage your account settings and preferences</p>
                </div>
                
                <div class="profile-header">
                    <div class="profile-avatar" id="profileAvatar">T</div>
                    <div class="profile-info">
                        <h2 id="profileName">Teacher Name</h2>
                        <div class="profile-meta">
                            <div><i class="fas fa-id-card"></i> Teacher ID: <span id="profileTeacherId">TCH-XXXXX</span></div>
                            <div><i class="fas fa-school"></i> School: <span id="profileSchool">School Name</span></div>
                            <div><i class="fas fa-envelope"></i> Email: <span id="profileEmail">teacher@email.com</span></div>
                            <div><i class="fas fa-phone"></i> Phone: <span id="profilePhone">+91 00000 00000</span></div>
                        </div>
                    </div>
                </div>
                
                <div class="profile-grid">
                    <!-- PERSONAL INFORMATION -->
                    <div class="profile-card">
                        <h3><i class="fas fa-user-edit"></i> Personal Information</h3>
                        <form id="profileForm">
                            <div class="form-group">
                                <label class="form-label">Full Name</label>
                                <input type="text" class="form-control" id="editName" placeholder="Enter your full name">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Phone Number</label>
                                <input type="tel" class="form-control" id="editPhone" placeholder="Enter phone number">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Subjects</label>
                                <select class="form-control" id="editSubjects" multiple style="height: 100px;">
                                    <option value="Physics">Physics</option>
                                    <option value="Chemistry">Chemistry</option>
                                    <option value="Mathematics">Mathematics</option>
                                    <option value="Biology">Biology</option>
                                    <option value="Computer Science">Computer Science</option>
                                    <option value="English">English</option>
                                    <option value="Hindi">Hindi</option>
                                    <option value="Social Studies">Social Studies</option>
                                </select>
                                <small style="color: #888; font-size: 0.8rem;">Hold Ctrl/Cmd to select multiple subjects</small>
                            </div>
                            <button type="submit" class="btn btn-primary" style="margin-top: 10px;">
                                <i class="fas fa-save"></i> Save Changes
                            </button>
                        </form>
                    </div>
                    
                    <!-- NOTIFICATION PREFERENCES -->
                    <div class="profile-card">
                        <h3><i class="fas fa-bell"></i> Notification Preferences</h3>
                        <form id="preferencesForm">
                            <div class="form-group" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                <div>
                                    <label class="form-label" style="margin-bottom: 0;">Email Notifications</label>
                                    <small style="display: block; color: #888; font-size: 0.8rem;">Receive updates via email</small>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" id="emailNotifications" checked>
                                    <span class="slider"></span>
                                </label>
                            </div>
                            
                            <div class="form-group" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                <div>
                                    <label class="form-label" style="margin-bottom: 0;">Challenge Notifications</label>
                                    <small style="display: block; color: #888; font-size: 0.8rem;">Get notified about new challenges</small>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" id="challengeNotifications" checked>
                                    <span class="slider"></span>
                                </label>
                            </div>
                            
                            <div class="form-group" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                <div>
                                    <label class="form-label" style="margin-bottom: 0;">Weekly Reports</label>
                                    <small style="display: block; color: #888; font-size: 0.8rem;">Receive weekly performance reports</small>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" id="weeklyReport" checked>
                                    <span class="slider"></span>
                                </label>
                            </div>
                            
                            <button type="button" class="btn btn-primary" onclick="savePreferences()" style="margin-top: 10px;">
                                <i class="fas fa-save"></i> Save Preferences
                            </button>
                        </form>
                    </div>
                    
                    <!-- ACCOUNT STATISTICS -->
                    <div class="profile-card">
                        <h3><i class="fas fa-chart-bar"></i> Account Statistics</h3>
                        <div id="profileStats">
                            <div class="student-stat">
                                <label>Total Students</label>
                                <value id="statTotalStudents">0</value>
                            </div>
                            <div class="student-stat">
                                <label>Total Classes</label>
                                <value id="statTotalClasses">0</value>
                            </div>
                            <div class="student-stat">
                                <label>Challenges Created</label>
                                <value id="statChallengesCreated">0</value>
                            </div>
                            <div class="student-stat">
                                <label>Challenges Evaluated</label>
                                <value id="statChallengesEvaluated">0</value>
                            </div>
                            <div class="student-stat">
                                <label>Account Status</label>
                                <value><span class="badge badge-success" id="statStatus">Active</span></value>
                            </div>
                            <div class="student-stat">
                                <label>Member Since</label>
                                <value id="statCreatedAt">-</value>
                            </div>
                        </div>
                    </div>
                    
                    <!-- PASSWORD CHANGE -->
                    <div class="profile-card">
                        <h3><i class="fas fa-key"></i> Change Password</h3>
                        <form id="passwordForm">
                            <div class="form-group">
                                <label class="form-label">Current Password</label>
                                <input type="password" class="form-control" id="currentPassword" placeholder="Enter current password">
                            </div>
                            <div class="form-group">
                                <label class="form-label">New Password</label>
                                <input type="password" class="form-control" id="newPassword" placeholder="Enter new password">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Confirm New Password</label>
                                <input type="password" class="form-control" id="confirmPassword" placeholder="Confirm new password">
                            </div>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-key"></i> Change Password
                            </button>
                        </form>
                    </div>
                </div>
            </div>



            
            <!-- HELP TICKETS PAGE -->
            <div class="page" id="help">
                <div class="page-header">
                    <h1>Help Tickets</h1>
                    <p>Manage student help requests</p>
                </div>
                
                <div class="panel">
                    <table>
                        <thead>
                            <tr>
                                <th>Ticket ID</th>
                                <th>Student</th>
                                <th>Subject</th>
                                <th>Status</th>
                                <th>Created</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="ticketsList">
                            <tr>
                                <td colspan="6">
                                    <div class="loading">
                                        <div class="spinner"></div>
                                        <p>Loading tickets...</p>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
        </div>
    </div>
    
    <!-- MODALS -->
    <div id="studentDetailsModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-user-graduate"></i> Student Details</h2>
                <button class="modal-close" onclick="closeModal('studentDetailsModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body" id="studentDetailsBody">
                <!-- Content loaded dynamically -->
            </div>
        </div>
    </div>
    
    <div id="addStudentModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-user-plus"></i> Add New Student</h2>
                <button class="modal-close" onclick="closeModal('addStudentModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="addStudentForm">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                        <div class="form-group">
                            <label class="form-label">Full Name</label>
                            <input type="text" class="form-control" placeholder="Student Name" id="studentName" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Email</label>
                            <input type="email" class="form-control" placeholder="student@email.com" id="studentEmail" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Password</label>
                            <input type="password" class="form-control" placeholder="Password" id="studentPassword" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Confirm Password</label>
                            <input type="password" class="form-control" placeholder="Confirm Password" id="studentConfirmPassword" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Class</label>
                            <select id="studentClass" class="form-control" required>
                                <option value="6">Class 6</option>
                                <option value="7">Class 7</option>
                                <option value="8">Class 8</option>
                                <option value="9">Class 9</option>
                                <option value="10" selected>Class 10</option>
                                <option value="11">Class 11</option>
                                <option value="12">Class 12</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Section</label>
                            <select id="studentSection" class="form-control" required>
                                <option value="A" selected>Section A</option>
                                <option value="B">Section B</option>
                                <option value="C">Section C</option>
                                <option value="D">Section D</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Roll Number</label>
                            <input type="number" class="form-control" placeholder="Roll Number" id="studentRollNumber" required>
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px; display: flex; gap: 10px; justify-content: flex-end;">
                        <button type="button" class="btn btn-secondary" onclick="closeModal('addStudentModal')">
                            Cancel
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-plus"></i> Add Student
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <script>
        // TeacherDashboard.js with CSS Charts
        const API_BASE_URL = 'http://localhost:3000/api';

        document.addEventListener('DOMContentLoaded', () => {
            checkAuth();
            initializeDashboard();
        });

        function checkAuth() {
            const token = localStorage.getItem('authToken');
            const userType = localStorage.getItem('userType');
            
            if (!token || userType !== 'teacher') {
                window.location.href = '../login.html';
                return;
            }
        }

        async function initializeDashboard() {
            try {
                await loadTeacherProfile();
                await loadDashboardData();
                initializeCharts();
                initializeFilterListeners();
                
                setInterval(() => {
                    loadDashboardData();
                }, 300000);
            } catch (error) {
                console.error('Dashboard initialization error:', error);
                showError('Failed to load dashboard');
            }
        }

        async function apiCall(endpoint, options = {}) {
            const token = localStorage.getItem('authToken');
            
            const defaultOptions = {
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                }
            };
            
            const response = await fetch(`${API_BASE_URL}${endpoint}`, {
                ...defaultOptions,
                ...options,
                headers: { ...defaultOptions.headers, ...options.headers }
            });
            
            if (response.status === 401) {
                localStorage.clear();
                window.location.href = '../login.html';
                return;
            }
            
            const data = await response.json();
            
            if (!data.success) {
                throw new Error(data.message || 'API request failed');
            }
            
            return data.data;
        }

        async function loadTeacherProfile() {
            try {
                const data = await apiCall('/teacher/profile');
                const teacher = data.teacher;
                
                document.getElementById('userName').textContent = teacher.name;
                document.getElementById('teacherNameDisplay').textContent = teacher.name;
                document.getElementById('userAvatar').textContent = teacher.name.charAt(0).toUpperCase();
                
                document.getElementById('profileName').textContent = teacher.name;
                document.getElementById('profileAvatar').textContent = teacher.name.charAt(0).toUpperCase();
                document.getElementById('profileTeacherId').textContent = teacher.teacherId;
                document.getElementById('profileEmail').textContent = teacher.email;
                document.getElementById('profilePhone').textContent = teacher.phone;
                document.getElementById('profileSchool').textContent = data.school?.schoolName || 'Unknown School';
                
                document.getElementById('editName').value = teacher.name;
                document.getElementById('editPhone').value = teacher.phone;
                
                const subjectSelect = document.getElementById('editSubjects');
                Array.from(subjectSelect.options).forEach(option => {
                    if (teacher.subjects && teacher.subjects.includes(option.value)) {
                        option.selected = true;
                    }
                });
                
                document.getElementById('emailNotifications').checked = teacher.preferences?.emailNotifications || true;
                document.getElementById('challengeNotifications').checked = teacher.preferences?.challengeNotifications || true;
                document.getElementById('weeklyReport').checked = teacher.preferences?.weeklyReport || true;
                
                if (teacher.stats) {
                    document.getElementById('statTotalStudents').textContent = teacher.stats.totalStudents || 0;
                    document.getElementById('statTotalClasses').textContent = teacher.stats.totalClasses || 0;
                    document.getElementById('statChallengesCreated').textContent = teacher.stats.totalChallengesCreated || 0;
                    document.getElementById('statChallengesEvaluated').textContent = teacher.stats.totalChallengesEvaluated || 0;
                }
                
                document.getElementById('statStatus').textContent = teacher.status || 'Active';
                document.getElementById('statCreatedAt').textContent = formatDate(teacher.createdAt, true);
                
                window.teacherData = teacher;
            } catch (error) {
                console.error('Load profile error:', error);
            }
        }

        async function updateProfile(profileData) {
            try {
                await apiCall('/teacher/profile', {
                    method: 'PUT',
                    body: JSON.stringify(profileData)
                });
                
                await loadTeacherProfile();
                return true;
            } catch (error) {
                console.error('Update profile error:', error);
                throw error;
            }
        }

        async function loadDashboardData() {
            try {
                const data = await apiCall('/teacher/dashboard');
                
                document.getElementById('totalStudents').textContent = data.statistics.totalStudents || 0;
                document.getElementById('totalChallenges').textContent = data.statistics.totalChallenges || 0;
                document.getElementById('pendingReviews').textContent = data.statistics.pendingReviews || 0;
                document.getElementById('totalClasses').textContent = data.statistics.totalClasses || 0;
                document.getElementById('openTickets').textContent = data.statistics.openTickets || 0;
                
                if (data.statistics.pendingReviews > 0) {
                    document.getElementById('pendingCount').textContent = data.statistics.pendingReviews;
                    document.getElementById('pendingCount').style.display = 'inline-block';
                    document.getElementById('notificationCount').textContent = data.statistics.pendingReviews;
                    document.getElementById('notificationCount').style.display = 'inline-block';
                }

                await displayRecentChallenges();
                
                if (data.statistics.totalStudents > 0) {
                    const avgPerf = await calculateAveragePerformance();
                    document.getElementById('avgPerformance').textContent = avgPerf.toFixed(1) + '%';
                }
                
                displayRecentChallenges(data.recentChallenges);
                displayStudentsNeedingAttention(data.studentsNeedingAttention);
                displayTopPerformers(data.topPerformers);
                
                updateCharts(data);
                
            } catch (error) {
                console.error('Load dashboard error:', error);
                showError('Failed to load dashboard data');
            }
        }

        async function calculateAveragePerformance() {
            try {
                const data = await apiCall('/teacher/analytics/overview');
                return data.overview.averagePerformance || 0;
            } catch (error) {
                return 0;
            }
        }

        async function displayRecentChallenges() {
            const tbody = document.getElementById('recentChallenges');
            
            try {
                // Show loading state
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; color: var(--text-secondary);">
                            <div class="loading">
                                <div class="spinner"></div>
                                <p>Loading recent challenges...</p>
                            </div>
                        </td>
                    </tr>
                `;
                
                // Fetch recent challenges from API
                const data = await apiCall('/challenges/recent');
                const challenges = data.challenges || [];
                
                if (challenges.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="8" style="text-align: center; color: #888;">No recent challenges found</td></tr>';
                    return;
                }
                
                // Render challenges table
                tbody.innerHTML = challenges.map(challenge => `
                    <tr>
                        <td>${challenge.challengeId || 'N/A'}</td>
                        <td>${challenge.student?.name || challenge.studentId || 'Unknown Student'}</td>
                        <td>
                            <span class="badge badge-info">
                                ${challenge.simulationType || 'General'}
                            </span>
                        </td>
                        <td>
                            <span class="badge ${getDifficultyBadgeClass(challenge.difficulty)}">
                                ${challenge.difficulty || 'medium'}
                            </span>
                        </td>
                        <td>
                            <span class="badge ${getStatusBadgeClass(challenge.status)}">
                                ${challenge.status || 'generated'}
                            </span>
                        </td>
                        <td>
                            ${challenge.results?.totalScore ? 
                                challenge.results.totalScore.toFixed(1) + '%' : 
                                (challenge.score ? challenge.score.toFixed(1) + '%' : '-')}
                        </td>
                        <td>${formatDate(challenge.submittedAt || challenge.createdAt)}</td>
                        <td>
                            <button class="btn btn-secondary btn-sm" onclick="viewChallengeDetails('${challenge.challengeId}')">
                                <i class="fas fa-eye"></i> View
                            </button>
                            ${challenge.status === 'submitted' ? `
                                <button class="btn btn-primary btn-sm" onclick="validateChallenge('${challenge.challengeId}')">
                                    <i class="fas fa-check"></i> Review
                                </button>
                            ` : ''}
                        </td>
                    </tr>
                `).join('');
                
            } catch (error) {
                console.error('Error loading recent challenges:', error);
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; color: #e74c3c;">
                            <i class="fas fa-exclamation-triangle"></i> Failed to load recent challenges
                        </td>
                    </tr>
                `;
            }
        }

        async function viewChallengeDetails(challengeId) {
            try {
                const data = await apiCall(`/challenges/${challengeId}`);
                showChallengeModal(data.challenge);
            } catch (error) {
                console.error('View challenge error:', error);
                showError('Failed to load challenge details');
            }
        }

        function showChallengeModal(challenge) {
            // Create modal if it doesn't exist
            if (!document.getElementById('challengeDetailsModal')) {
                const modalHtml = `
                    <div id="challengeDetailsModal" class="modal" style="display: none;">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h2><i class="fas fa-tasks"></i> Challenge Details</h2>
                                <button class="modal-close" onclick="closeModal('challengeDetailsModal')">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <div class="modal-body" id="challengeDetailsBody">
                                <!-- Content loaded dynamically -->
                            </div>
                        </div>
                    </div>
                `;
                document.body.insertAdjacentHTML('beforeend', modalHtml);
            }
            
            const modal = document.getElementById('challengeDetailsModal');
            const body = document.getElementById('challengeDetailsBody');
            
            body.innerHTML = `
                <h3>Challenge: ${challenge.challengeId}</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div>
                        <p><strong>Student:</strong> ${challenge.student?.name || challenge.studentId}</p>
                        <p><strong>Simulation:</strong> ${challenge.simulationType}</p>
                        <p><strong>Difficulty:</strong> 
                            <span class="badge ${getDifficultyBadgeClass(challenge.difficulty)}">
                                ${challenge.difficulty}
                            </span>
                        </p>
                    </div>
                    <div>
                        <p><strong>Status:</strong> 
                            <span class="badge ${getStatusBadgeClass(challenge.status)}">
                                ${challenge.status}
                            </span>
                        </p>
                        <p><strong>Score:</strong> ${challenge.results?.totalScore ? challenge.results.totalScore.toFixed(1) + '%' : 'N/A'}</p>
                        <p><strong>Submitted:</strong> ${formatDate(challenge.submittedAt)}</p>
                    </div>
                </div>
                
                ${challenge.results ? `
                    <h4>Results</h4>
                    <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px;">
                            <div style="text-align: center;">
                                <div style="font-size: 1.5rem; font-weight: bold; color: var(--accent-cyan);">
                                    ${challenge.results.totalScore ? challenge.results.totalScore.toFixed(1) : 0}%
                                </div>
                                <div style="font-size: 0.8rem; color: var(--text-secondary);">Total Score</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 1.5rem; font-weight: bold; color: var(--success-green);">
                                    ${challenge.results.correctAnswers || 0}/${challenge.results.totalQuestions || 0}
                                </div>
                                <div style="font-size: 0.8rem; color: var(--text-secondary);">Correct Answers</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 1.5rem; font-weight: bold; color: var(--warning-yellow);">
                                    ${challenge.results.timeTaken ? Math.round(challenge.results.timeTaken / 60) : 0}m
                                </div>
                                <div style="font-size: 0.8rem; color: var(--text-secondary);">Time Taken</div>
                            </div>
                        </div>
                    </div>
                ` : ''}
                
                ${challenge.feedback ? `
                    <h4>Teacher Feedback</h4>
                    <div style="background: rgba(0,122,204,0.1); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        <p style="font-style: italic;">"${challenge.feedback.comments}"</p>
                        <p><strong>Rating:</strong> ${challenge.feedback.rating}/5</p>
                    </div>
                ` : ''}
                
                <div style="margin-top: 20px; display: flex; gap: 10px; justify-content: flex-end;">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('challengeDetailsModal')">
                        Close
                    </button>
                    ${challenge.status === 'submitted' ? `
                        <button type="button" class="btn btn-primary" onclick="validateChallenge('${challenge.challengeId}')">
                            <i class="fas fa-check-circle"></i> Review Challenge
                        </button>
                    ` : ''}
                </div>
            `;
            
            modal.style.display = 'flex';
        }

        async function validateChallenge(challengeId) {
            if (confirm('Review and validate this challenge?')) {
                try {
                    // In a real implementation, this would open a validation interface
                    // For now, just mark as evaluated
                    await apiCall(`/challenges/${challengeId}/validate`, {
                        method: 'POST',
                        body: JSON.stringify({
                            status: 'evaluated',
                            feedback: {
                                rating: 4,
                                comments: 'Well done! Good understanding of concepts.'
                            }
                        })
                    });
                    
                    showSuccess('Challenge validated successfully!');
                    closeModal('challengeDetailsModal');
                    await displayRecentChallenges(); // Refresh the list
                    await loadDashboardData(); // Refresh dashboard stats
                } catch (error) {
                    console.error('Validate challenge error:', error);
                    showError('Failed to validate challenge');
                }
            }
        }

        // CSS CHART FUNCTIONS
        function initializeCharts() {
            createPerformanceTrendChart();
            createCompetencyRadarChart();
            createChallengeStatusDonutChart();
            createPerformanceDistributionChart();
            createSimulationUsageChart();
        }

        function updateCharts(data) {
            updatePerformanceTrendChart(data.recentActivity);
            updateCompetencyRadarChart(data.competencies);
            updateChallengeStatusDonutChart(data.challengesByStatus);
            updatePerformanceDistributionChart(data.students || []);
            updateSimulationUsageChart();
        }

        function createPerformanceTrendChart() {
            const container = document.getElementById('performanceTrendChart');
            
            // Sample data for initial display
            const sampleData = [
                { day: 'Mon', value: 65 },
                { day: 'Tue', value: 72 },
                { day: 'Wed', value: 68 },
                { day: 'Thu', value: 75 },
                { day: 'Fri', value: 80 },
                { day: 'Sat', value: 78 },
                { day: 'Sun', value: 82 }
            ];
            
            renderPerformanceTrendChart(sampleData);
        }

        function renderPerformanceTrendChart(data) {
            const container = document.getElementById('performanceTrendChart');
            
            // Find max value for scaling
            const maxValue = Math.max(...data.map(d => d.value));
            
            // Clear existing content
            container.innerHTML = '';
            
            // Create grid lines
            const gridLines = document.createElement('div');
            gridLines.className = 'chart-grid-lines';
            
            // Add grid lines (0%, 25%, 50%, 75%, 100%)
            for (let i = 0; i <= 4; i++) {
                const gridLine = document.createElement('div');
                gridLine.className = 'grid-line';
                gridLine.style.top = `${i * 25}%`;
                gridLines.appendChild(gridLine);
                
                const gridLabel = document.createElement('div');
                gridLabel.className = 'grid-label';
                gridLabel.textContent = `${(4 - i) * 25}%`;
                gridLabel.style.top = `${i * 25}%`;
                gridLines.appendChild(gridLabel);
            }
            
            container.appendChild(gridLines);
            
            // Create bars
            data.forEach((item, index) => {
                const bar = document.createElement('div');
                bar.className = 'chart-bar';
                bar.style.height = `${(item.value / maxValue) * 100}%`;
                bar.style.background = `linear-gradient(to top, var(--accent-blue), var(--accent-cyan))`;
                
                const barValue = document.createElement('div');
                barValue.className = 'bar-value';
                barValue.textContent = `${item.value}%`;
                bar.appendChild(barValue);
                
                const barLabel = document.createElement('div');
                barLabel.className = 'bar-label';
                barLabel.textContent = item.day;
                bar.appendChild(barLabel);
                
                container.appendChild(bar);
            });
        }

        function updatePerformanceTrendChart(activityData) {
            if (!activityData || activityData.length === 0) return;
            
            // Format activity data for chart
            const formattedData = activityData.map(item => ({
                day: item._id,
                value: item.count || 0
            }));
            
            renderPerformanceTrendChart(formattedData);
        }

        function createCompetencyRadarChart() {
            const container = document.getElementById('competencyRadarChart');
            
            // Sample competencies data
            const sampleCompetencies = {
                'Critical Thinking': 75,
                'Problem Solving': 68,
                'Creativity': 82,
                'Collaboration': 70,
                'Communication': 65,
                'Digital Literacy': 85
            };
            
            renderCompetencyRadarChart(sampleCompetencies);
        }

        function renderCompetencyRadarChart(competencies) {
            const container = document.getElementById('competencyRadarChart');
            container.innerHTML = '';
            
            const labels = Object.keys(competencies);
            const values = Object.values(competencies);
            const numAxes = labels.length;
            const maxRadius = 100;
            
            // Create radar grid circles
            for (let i = 0; i < 5; i++) {
                const grid = document.createElement('div');
                grid.className = 'radar-grid';
                container.appendChild(grid);
            }
            
            // Create axes
            for (let i = 0; i < numAxes; i++) {
                const angle = (i * 360) / numAxes;
                const axis = document.createElement('div');
                axis.className = 'radar-axis';
                axis.style.transform = `rotate(${angle}deg)`;
                container.appendChild(axis);
            }
            
            // Calculate points and create polygon
            const points = [];
            const centerX = 125;
            const centerY = 125;
            
            for (let i = 0; i < numAxes; i++) {
                const angle = (i * 360) / numAxes - 90;
                const radians = (angle * Math.PI) / 180;
                const score = values[i];
                const radius = (score / 100) * maxRadius;
                
                const x = centerX + radius * Math.cos(radians);
                const y = centerY + radius * Math.sin(radians);
                points.push(`${x},${y}`);
                
                // Create point
                const point = document.createElement('div');
                point.className = 'radar-point';
                point.style.left = `${x}px`;
                point.style.top = `${y}px`;
                container.appendChild(point);
                
                // Create label
                const labelRadius = maxRadius + 30;
                const labelX = centerX + labelRadius * Math.cos(radians);
                const labelY = centerY + labelRadius * Math.sin(radians);
                
                const label = document.createElement('div');
                label.className = 'radar-label';
                label.textContent = labels[i];
                label.style.left = `${labelX}px`;
                label.style.top = `${labelY}px`;
                container.appendChild(label);
            }
            
            // Create SVG polygon
            const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
            svg.setAttribute('width', '250');
            svg.setAttribute('height', '250');
            svg.setAttribute('class', 'radar-polygon');
            
            const polygon = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');
            polygon.setAttribute('points', points.join(' '));
            svg.appendChild(polygon);
            
            container.appendChild(svg);
        }

        function updateCompetencyRadarChart(competencies) {
            if (!competencies || Object.keys(competencies).length === 0) return;
            
            // Format competency data
            const formattedCompetencies = {};
            Object.entries(competencies).forEach(([key, value]) => {
                formattedCompetencies[key.replace(/-/g, ' ')] = value.average || 0;
            });
            
            renderCompetencyRadarChart(formattedCompetencies);
        }

        function createChallengeStatusDonutChart() {
            const container = document.getElementById('challengeStatusChart');
            
            // Sample data
            const sampleData = {
                evaluated: 45,
                submitted: 30,
                generated: 15,
                inProgress: 10
            };
            
            renderDonutChart(sampleData);
        }

        function renderDonutChart(statusData) {
            const container = document.getElementById('challengeStatusChart');
            
            const total = Object.values(statusData).reduce((sum, val) => sum + val, 0);
            const percentages = {
                evaluated: (statusData.evaluated / total) * 100,
                submitted: (statusData.submitted / total) * 100,
                generated: (statusData.generated / total) * 100,
                inProgress: (statusData.inProgress / total) * 100
            };
            
            // Calculate cumulative percentages
            const cumulative = {
                segment1: percentages.evaluated,
                segment2: percentages.evaluated + percentages.submitted,
                segment3: percentages.evaluated + percentages.submitted + percentages.generated
            };
            
            container.innerHTML = `
                <div class="donut-chart" style="
                    --donut-segment-1: ${cumulative.segment1}%;
                    --donut-segment-2: ${cumulative.segment2}%;
                    --donut-segment-3: ${cumulative.segment3}%;
                "></div>
                <div class="donut-center">
                    <div class="donut-total">${total}</div>
                    <div class="donut-label">Challenges</div>
                </div>
                <div class="donut-legend">
                    <div class="donut-legend-item">
                        <div class="donut-legend-color" style="background: #27ae60;"></div>
                        <span>Evaluated (${statusData.evaluated})</span>
                    </div>
                    <div class="donut-legend-item">
                        <div class="donut-legend-color" style="background: #f39c12;"></div>
                        <span>Submitted (${statusData.submitted})</span>
                    </div>
                    <div class="donut-legend-item">
                        <div class="donut-legend-color" style="background: var(--accent-cyan);"></div>
                        <span>Generated (${statusData.generated})</span>
                    </div>
                    <div class="donut-legend-item">
                        <div class="donut-legend-color" style="background: #888888;"></div>
                        <span>In Progress (${statusData.inProgress})</span>
                    </div>
                </div>
            `;
        }

        function updateChallengeStatusDonutChart(statusData) {
            if (!statusData || Object.keys(statusData).length === 0) return;
            
            renderDonutChart(statusData);
        }

        function createPerformanceDistributionChart() {
            const container = document.getElementById('performanceDistributionChart');
            
            // Sample data
            const sampleData = [
                { range: '90-100', label: 'Excellent', value: 5, color: '#27ae60' },
                { range: '70-89', label: 'Good', value: 12, color: '#2ecc71' },
                { range: '50-69', label: 'Average', value: 18, color: '#f39c12' },
                { range: '0-49', label: 'Needs Help', value: 8, color: '#e74c3c' }
            ];
            
            renderDistributionChart(sampleData);
        }

        function renderDistributionChart(distributionData) {
            const container = document.getElementById('performanceDistributionChart');
            
            // Find max value for scaling
            const maxValue = Math.max(...distributionData.map(d => d.value));
            
            // Clear existing content
            container.innerHTML = '';
            
            // Create grid lines
            const gridLines = document.createElement('div');
            gridLines.className = 'chart-grid-lines';
            
            for (let i = 0; i <= 4; i++) {
                const gridLine = document.createElement('div');
                gridLine.className = 'grid-line';
                gridLine.style.top = `${i * 25}%`;
                gridLines.appendChild(gridLine);
                
                const gridLabel = document.createElement('div');
                gridLabel.className = 'grid-label';
                gridLabel.textContent = `${(4 - i) * 25}`;
                gridLabel.style.top = `${i * 25}%`;
                gridLines.appendChild(gridLabel);
            }
            
            container.appendChild(gridLines);
            
            // Create bars
            distributionData.forEach((item, index) => {
                const bar = document.createElement('div');
                bar.className = 'chart-bar';
                bar.style.height = `${(item.value / maxValue) * 100}%`;
                bar.style.background = `linear-gradient(to top, ${item.color}, ${adjustColor(item.color, 30)})`;
                
                const barValue = document.createElement('div');
                barValue.className = 'bar-value';
                barValue.textContent = item.value;
                bar.appendChild(barValue);
                
                const barLabel = document.createElement('div');
                barLabel.className = 'bar-label';
                barLabel.innerHTML = `${item.range}<br>${item.label}`;
                bar.appendChild(barLabel);
                
                container.appendChild(bar);
            });
        }

        function updatePerformanceDistributionChart(students) {
            if (!students || students.length === 0) return;
            
            // Calculate distribution from student performance
            const distribution = {
                excellent: students.filter(s => s.performanceIndex >= 90).length,
                good: students.filter(s => s.performanceIndex >= 70 && s.performanceIndex < 90).length,
                average: students.filter(s => s.performanceIndex >= 50 && s.performanceIndex < 70).length,
                needsHelp: students.filter(s => s.performanceIndex < 50).length
            };
            
            const distributionData = [
                { range: '90-100', label: 'Excellent', value: distribution.excellent, color: '#27ae60' },
                { range: '70-89', label: 'Good', value: distribution.good, color: '#2ecc71' },
                { range: '50-69', label: 'Average', value: distribution.average, color: '#f39c12' },
                { range: '0-49', label: 'Needs Help', value: distribution.needsHelp, color: '#e74c3c' }
            ];
            
            renderDistributionChart(distributionData);
        }

        function createSimulationUsageChart() {
            const container = document.getElementById('simulationUsageChart');
            
            // Sample data
            const sampleData = [
                { name: 'Force Visualizer', count: 45 },
                { name: 'Circuit Builder', count: 38 },
                { name: 'Chemical Reactions', count: 32 },
                { name: 'Math Grapher', count: 28 },
                { name: 'Cell Explorer', count: 25 },
                { name: 'Wave Simulator', count: 22 }
            ];
            
            renderSimulationUsageChart(sampleData);
        }

        function renderSimulationUsageChart(simulationData) {
            const container = document.getElementById('simulationUsageChart');
            
            // Find max value for scaling
            const maxCount = Math.max(...simulationData.map(d => d.count));
            
            // Clear existing content
            container.innerHTML = '';
            
            simulationData.forEach((item, index) => {
                const barContainer = document.createElement('div');
                barContainer.className = 'horizontal-bar';
                
                const barInfo = document.createElement('div');
                barInfo.className = 'bar-info';
                barInfo.innerHTML = `
                    <div class="bar-name">${item.name}</div>
                    <div class="bar-count">${item.count}</div>
                `;
                
                const barTrack = document.createElement('div');
                barTrack.className = 'bar-track';
                
                const barFill = document.createElement('div');
                barFill.className = 'bar-fill';
                barFill.style.width = `${(item.count / maxCount) * 100}%`;
                
                barTrack.appendChild(barFill);
                barContainer.appendChild(barInfo);
                barContainer.appendChild(barTrack);
                container.appendChild(barContainer);
            });
        }

        function updateSimulationUsageChart() {
            // This would be updated with real data from API
            // For now, using sample data
            const sampleData = [
                { name: 'Force Visualizer', count: Math.floor(Math.random() * 50) + 20 },
                { name: 'Circuit Builder', count: Math.floor(Math.random() * 45) + 15 },
                { name: 'Chemical Reactions', count: Math.floor(Math.random() * 40) + 10 },
                { name: 'Math Grapher', count: Math.floor(Math.random() * 35) + 8 },
                { name: 'Cell Explorer', count: Math.floor(Math.random() * 30) + 5 },
                { name: 'Wave Simulator', count: Math.floor(Math.random() * 25) + 3 }
            ];
            
            renderSimulationUsageChart(sampleData);
        }

        function changeChartPeriod(days) {
            // Update filter buttons
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
                if (parseInt(btn.textContent) === days) {
                    btn.classList.add('active');
                }
            });
            
            // In a real implementation, this would fetch new data
            // For now, we'll update with sample data
            const sampleData = {
                7: [
                    { day: 'Mon', value: 65 },
                    { day: 'Tue', value: 72 },
                    { day: 'Wed', value: 68 },
                    { day: 'Thu', value: 75 },
                    { day: 'Fri', value: 80 },
                    { day: 'Sat', value: 78 },
                    { day: 'Sun', value: 82 }
                ],
                30: [
                    { day: 'Week 1', value: 65 },
                    { day: 'Week 2', value: 72 },
                    { day: 'Week 3', value: 68 },
                    { day: 'Week 4', value: 75 }
                ],
                90: [
                    { day: 'Month 1', value: 65 },
                    { day: 'Month 2', value: 72 },
                    { day: 'Month 3', value: 68 }
                ]
            };
            
            renderPerformanceTrendChart(sampleData[days] || sampleData[7]);
        }

        // Helper function to adjust color brightness
        function adjustColor(color, amount) {
            const hex = color.replace('#', '');
            let r = parseInt(hex.substring(0, 2), 16);
            let g = parseInt(hex.substring(2, 4), 16);
            let b = parseInt(hex.substring(4, 6), 16);
            
            r = Math.min(255, Math.max(0, r + amount));
            g = Math.min(255, Math.max(0, g + amount));
            b = Math.min(255, Math.max(0, b + amount));
            
            return `#${r.toString(16).padStart(2, '0')}${g.toString(16).padStart(2, '0')}${b.toString(16).padStart(2, '0')}`;
        }

        function displayRecentChallenges(challenges) {
            const tbody = document.getElementById('recentChallenges');
            
            if (!challenges || challenges.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" style="text-align: center; color: #888;">No recent challenges</td></tr>';
                return;
            }
            
            tbody.innerHTML = challenges.map(challenge => `
                <tr>
                    <td>${challenge.challengeId}</td>
                    <td>${challenge.studentId}</td>
                    <td>
                        <span class="badge badge-info">${challenge.simulationType}</span>
                    </td>
                    <td>
                        <span class="badge ${getDifficultyBadgeClass(challenge.difficulty)}">
                            ${challenge.difficulty}
                        </span>
                    </td>
                    <td>
                        <span class="badge ${getStatusBadgeClass(challenge.status)}">
                            ${challenge.status}
                        </span>
                    </td>
                    <td>${challenge.results?.totalScore ? challenge.results.totalScore.toFixed(1) : '-'}</td>
                    <td>${formatDate(challenge.generatedAt)}</td>
                    <td>
                        <button class="btn btn-secondary btn-sm" onclick="viewChallengeDetails('${challenge.challengeId}')">
                            <i class="fas fa-eye"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function displayStudentsNeedingAttention(students) {
            const container = document.getElementById('studentsNeedingAttention');
            
            if (!students || students.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #888;">No students need attention at this time</p>';
                return;
            }
            
            container.innerHTML = students.map(student => `
                <div class="alert-card">
                    <div class="alert-header">
                        <div class="alert-icon">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div>
                            <h4>${student.name}</h4>
                            <p style="font-size: 0.85rem; color: #888; margin-top: 3px;">
                                ${student.studentId} | Class ${student.class}-${student.section}
                            </p>
                        </div>
                    </div>
                    <div style="margin-top: 15px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span style="color: #888;">Performance Index:</span>
                            <strong style="color: #e74c3c;">${student.performanceIndex.toFixed(1)}%</strong>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${student.performanceIndex}%; background: #e74c3c;"></div>
                        </div>
                        <button class="btn btn-secondary btn-sm" style="margin-top: 12px; width: 100%;" 
                                onclick="viewStudentDetails('${student.studentId}')">
                            <i class="fas fa-eye"></i> View Details
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function displayTopPerformers(students) {
            const container = document.getElementById('topPerformers');
            
            if (!students || students.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #888;">No performance data available</p>';
                return;
            }
            
            container.innerHTML = students.map((student, index) => `
                <div class="student-card">
                    <div class="student-header">
                        <div class="student-avatar">${student.name.charAt(0).toUpperCase()}</div>
                        <div class="student-info">
                            <h3>${student.name}</h3>
                            <div class="student-meta">
                                ${student.studentId} | Class ${student.class}-${student.section}
                            </div>
                        </div>
                        ${index === 0 ? '<i class="fas fa-crown" style="color: #f39c12; font-size: 1.2rem;"></i>' : ''}
                    </div>
                    <div class="student-stats">
                        <div class="student-stat">
                            <label>Performance Index:</label>
                            <value style="color: #27ae60;">${student.performanceIndex.toFixed(1)}%</value>
                        </div>
                        <div class="progress-bar" style="margin-bottom: 10px;">
                            <div class="progress-fill" style="width: ${student.performanceIndex}%;"></div>
                        </div>
                        <div class="student-stat">
                            <label>Grade:</label>
                            <value>${student.grade || 'N/A'}</value>
                        </div>
                        <button class="btn btn-primary btn-sm" style="margin-top: 12px; width: 100%;" 
                                onclick="viewStudentDetails('${student.studentId}')">
                            <i class="fas fa-eye"></i> View Profile
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function getDifficultyBadgeClass(difficulty) {
            const classes = {
                'easy': 'badge-success',
                'medium': 'badge-warning',
                'hard': 'badge-danger'
            };
            return classes[difficulty?.toLowerCase()] || 'badge-info';
        }

        function getStatusBadgeClass(status) {
            const classes = {
                'evaluated': 'badge-success',
                'submitted': 'badge-warning',
                'generated': 'badge-info',
                'inProgress': 'badge-info'
            };
            return classes[status] || 'badge-info';
        }

        function formatDate(dateString, dateOnly = false) {
            if (!dateString) return 'N/A';
            const date = new Date(dateString);
            if (dateOnly) {
                return date.toLocaleDateString();
            }
            return date.toLocaleDateString() + ' ' + date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        }

        function showError(message) {
            alert('Error: ' + message);
        }

        function showSuccess(message) {
            alert('Success: ' + message);
        }

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                localStorage.clear();
                window.location.href = '/login.html';
            }
        }

        // PROFILE PAGE FUNCTIONS
        document.getElementById('profileForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const profileData = {
                name: document.getElementById('editName').value,
                phone: document.getElementById('editPhone').value,
                subjects: Array.from(document.getElementById('editSubjects').selectedOptions).map(opt => opt.value)
            };
            
            try {
                await updateProfile(profileData);
                showSuccess('Profile updated successfully!');
            } catch (error) {
                showError('Failed to update profile: ' + error.message);
            }
        });

        async function savePreferences() {
            const preferences = {
                emailNotifications: document.getElementById('emailNotifications').checked,
                challengeNotifications: document.getElementById('challengeNotifications').checked,
                weeklyReport: document.getElementById('weeklyReport').checked
            };
            
            try {
                await updateProfile({ preferences });
                showSuccess('Preferences saved successfully!');
            } catch (error) {
                showError('Failed to save preferences: ' + error.message);
            }
        }

        document.getElementById('passwordForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (newPassword !== confirmPassword) {
                showError('New passwords do not match!');
                return;
            }
            
            if (newPassword.length < 6) {
                showError('Password must be at least 6 characters long');
                return;
            }
            
            try {
                await apiCall('/teacher/change-password', {
                    method: 'PUT',
                    body: JSON.stringify({
                        currentPassword,
                        newPassword
                    })
                });
                
                showSuccess('Password changed successfully!');
                document.getElementById('passwordForm').reset();
            } catch (error) {
                showError('Failed to change password: ' + error.message);
            }
        });

        function initializeFilterListeners() {
            document.getElementById('studentSearch')?.addEventListener('input', (e) => {
                loadStudents({ search: e.target.value });
            });
            
            document.getElementById('classFilter')?.addEventListener('change', (e) => {
                loadStudents({ class: e.target.value });
            });
            
            document.getElementById('sectionFilter')?.addEventListener('change', (e) => {
                loadStudents({ section: e.target.value });
            });
        }

        async function loadStudents(filters = {}) {
            try {
                const queryParams = new URLSearchParams();
                
                if (filters.search) queryParams.append('search', filters.search);
                if (filters.class) queryParams.append('class', filters.class);
                if (filters.section) queryParams.append('section', filters.section);
                
                const endpoint = `/teacher/students?${queryParams.toString()}`;
                const data = await apiCall(endpoint);
                
                displayStudentsList(data.students);
            } catch (error) {
                console.error('Load students error:', error);
                showError('Failed to load students');
            }
        }

        function displayStudentsList(students) {
            const tbody = document.getElementById('studentsList');
            
            if (!students || students.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" style="text-align: center; color: #888;">No students found</td></tr>';
                return;
            }
            
            tbody.innerHTML = students.map(student => `
                <tr>
                    <td>${student.studentId}</td>
                    <td>${student.name}</td>
                    <td>${student.class}</td>
                    <td>${student.section}</td>
                    <td>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span>${student.performanceIndex.toFixed(1)}%</span>
                            <div class="progress-bar" style="width: 100px;">
                                <div class="progress-fill" style="width: ${student.performanceIndex}%;"></div>
                            </div>
                        </div>
                    </td>
                    <td>
                        <span class="badge ${getGradeBadgeClass(student.grade)}">
                            ${student.grade || 'N/A'}
                        </span>
                    </td>
                    <td>${student.stats?.totalChallengesCompleted || 0}</td>
                    <td>
                        <button class="btn btn-secondary btn-sm" onclick="viewStudentDetails('${student.studentId}')">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn btn-warning btn-sm" onclick="editStudent('${student.studentId}')">
                            <i class="fas fa-edit"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function getGradeBadgeClass(grade) {
            if (!grade) return 'badge-info';
            if (grade.startsWith('A')) return 'badge-success';
            if (grade.startsWith('B')) return 'badge-info';
            if (grade.startsWith('C')) return 'badge-warning';
            return 'badge-danger';
        }

        function showPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // Remove active from all nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Show selected page
            document.getElementById(pageId).classList.add('active');
            
            // Add active to clicked nav item
            event.target.closest('.nav-item').classList.add('active');
            
            // Load page-specific data
            switch(pageId) {
                case 'students':
                    loadStudents();
                    break;
                case 'validations':
                    loadPendingValidations();
                    break;
                case 'classes':
                    loadClasses();
                    break;
                case 'profile':
                    break;
                case 'teaching-studio':
                    // Initialize teaching studio if needed
                    if (typeof selectTool === 'function') {
                        selectTool('notes-builder');
                    }
                    break;
                case 'help':
                    loadHelpTickets();
                    break;
            }
        }

        async function viewStudentDetails(studentId) {
            try {
                const data = await apiCall(`/teacher/students/${studentId}`);
                showStudentModal(data.student, data.recentChallenges);
            } catch (error) {
                console.error('View student error:', error);
                showError('Failed to load student details');
            }
        }

        function showStudentModal(student, challenges) {
            const modal = document.getElementById('studentDetailsModal');
            const body = document.getElementById('studentDetailsBody');
            
            body.innerHTML = `
                <h3>${student.name}</h3>
                <p><strong>Student ID:</strong> ${student.studentId}</p>
                <p><strong>Class:</strong> ${student.class}-${student.section}</p>
                <p><strong>Performance Index:</strong> ${student.performanceIndex.toFixed(1)}%</p>
                <p><strong>Grade:</strong> ${student.grade || 'N/A'}</p>
                
                <h4 style="margin-top: 20px;">Recent Challenges</h4>
                <div style="max-height: 300px; overflow-y: auto;">
                    ${challenges.map(ch => `
                        <div style="padding: 10px; background: rgba(255,255,255,0.03); margin-bottom: 10px; border-radius: 6px;">
                            <strong>${ch.challengeId}</strong> - ${ch.simulationType}<br>
                            <small>Score: ${ch.results?.totalScore || 'N/A'} | Status: ${ch.status}</small>
                        </div>
                    `).join('')}
                </div>
            `;
            
            modal.style.display = 'flex';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function toggleUserMenu() {
            // User menu toggle function
            alert('User menu would open here');
        }

        function openAddStudentModal() {
            const modal = document.getElementById('addStudentModal');
            document.getElementById('addStudentForm').reset();
            document.getElementById('studentClass').value = '10';
            document.getElementById('studentSection').value = 'A';
            modal.style.display = 'flex';
        }

        document.getElementById('addStudentForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const studentData = {
                name: document.getElementById('studentName').value,
                email: document.getElementById('studentEmail').value,
                password: document.getElementById('studentPassword').value,
                class: parseInt(document.getElementById('studentClass').value),
                section: document.getElementById('studentSection').value,
                rollNumber: parseInt(document.getElementById('studentRollNumber').value)
            };
            
            if (studentData.password !== document.getElementById('studentConfirmPassword').value) {
                showError('Passwords do not match!');
                return;
            }
            
            try {
                await apiCall('/teacher/students', {
                    method: 'POST',
                    body: JSON.stringify(studentData)
                });
                
                showSuccess('Student added successfully!');
                closeModal('addStudentModal');
                await loadStudents();
                await loadDashboardData();
                
            } catch (error) {
                console.error('Add student error:', error);
                showError('Failed to add student: ' + (error.message || 'Unknown error'));
            }
        });

        async function loadPendingValidations() {
            try {
                const data = await apiCall('/teacher/challenges/pending-review');
                displayValidationsList(data.challenges);
            } catch (error) {
                console.error('Load validations error:', error);
            }
        }

        function displayValidationsList(challenges) {
            const tbody = document.getElementById('validationsList');
            
            if (!challenges || challenges.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; color: #888;">No pending validations</td></tr>';
                return;
            }
            
            tbody.innerHTML = challenges.map(challenge => `
                <tr>
                    <td>${challenge.challengeId}</td>
                    <td>${challenge.student?.name || challenge.studentId}</td>
                    <td>${challenge.simulationType}</td>
                    <td>
                        <span class="badge ${getDifficultyBadgeClass(challenge.difficulty)}">
                            ${challenge.difficulty}
                        </span>
                    </td>
                    <td>
                        <span class="badge badge-warning">${challenge.status}</span>
                    </td>
                    <td>${formatDate(challenge.submittedAt)}</td>
                    <td>
                        <button class="btn btn-primary btn-sm" onclick="validateChallenge('${challenge.challengeId}')">
                            <i class="fas fa-check"></i> Review
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        async function loadClasses() {
            try {
                const data = await apiCall('/teacher/classes');
                displayClassesList(data.classes);
            } catch (error) {
                console.error('Load classes error:', error);
            }
        }

        function displayClassesList(classes) {
            const container = document.getElementById('classesList');
            
            if (!classes || classes.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #888;">No classes assigned</p>';
                return;
            }
            
            container.innerHTML = classes.map(cls => `
                <div class="student-card">
                    <div class="student-header">
                        <div class="student-avatar">
                            <i class="fas fa-chalkboard"></i>
                        </div>
                        <div class="student-info">
                            <h3>Class ${cls.class}-${cls.section}</h3>
                            <div class="student-meta">${cls.subject}</div>
                        </div>
                    </div>
                    <div class="student-stats">
                        <div class="student-stat">
                            <label>Total Students:</label>
                            <value>${cls.studentCount || 0}</value>
                        </div>
                        <div class="student-stat">
                            <label>Class Section ID:</label>
                            <value style="font-size: 0.75rem;">${cls.classSectionId}</value>
                        </div>
                        <button class="btn btn-primary btn-sm" style="margin-top: 12px; width: 100%;" 
                                onclick="viewClassDetails('${cls.classSectionId}')">
                            <i class="fas fa-eye"></i> View Details
                        </button>
                    </div>
                </div>
            `).join('');
        }

        async function loadHelpTickets() {
            try {
                const data = await apiCall('/teacher/help-tickets');
                displayTicketsList(data.tickets);
            } catch (error) {
                console.error('Load tickets error:', error);
            }
        }

        function displayTicketsList(tickets) {
            const tbody = document.getElementById('ticketsList');
            
            if (!tickets || tickets.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: #888;">No help tickets</td></tr>';
                return;
            }
            
            tbody.innerHTML = tickets.map(ticket => `
                <tr>
                    <td>${ticket.ticketId}</td>
                    <td>${ticket.studentId}</td>
                    <td>${ticket.subject || 'General Help'}</td>
                    <td>
                        <span class="badge ${ticket.status === 'open' ? 'badge-warning' : 'badge-success'}">
                            ${ticket.status}
                        </span>
                    </td>
                    <td>${formatDate(ticket.createdAt)}</td>
                    <td>
                        <button class="btn btn-secondary btn-sm" onclick="viewTicket('${ticket.ticketId}')">
                            <i class="fas fa-eye"></i>
                        </button>
                        ${ticket.status === 'open' ? `
                            <button class="btn btn-success btn-sm" onclick="resolveTicket('${ticket.ticketId}')">
                                <i class="fas fa-check"></i>
                            </button>
                        ` : ''}
                    </td>
                </tr>
            `).join('');
        }

        // Initialize analytics charts on page load
        document.addEventListener('DOMContentLoaded', function() {
            initializeFilterListeners();
            
            // Initialize analytics page charts
            document.querySelector('.nav-item[onclick="showPage(\'analytics\')"]').addEventListener('click', function() {
                setTimeout(() => {
                    createEngagementTrendChart();
                    createSubjectPerformanceChart();
                    createDifficultySuccessChart();
                }, 100);
            });
        });

        function createEngagementTrendChart() {
            const container = document.getElementById('engagementTrendChart');
            
            // Sample data for engagement
            const engagementData = [
                { week: 'Week 1', value: 65 },
                { week: 'Week 2', value: 72 },
                { week: 'Week 3', value: 80 },
                { week: 'Week 4', value: 75 },
                { week: 'Week 5', value: 85 },
                { week: 'Week 6', value: 78 },
                { week: 'Week 7', value: 90 }
            ];
            
            renderEngagementChart(engagementData);
        }

        function renderEngagementChart(data) {
            const container = document.getElementById('engagementTrendChart');
            
            const maxValue = Math.max(...data.map(d => d.value));
            
            container.innerHTML = '';
            
            const gridLines = document.createElement('div');
            gridLines.className = 'chart-grid-lines';
            
            for (let i = 0; i <= 4; i++) {
                const gridLine = document.createElement('div');
                gridLine.className = 'grid-line';
                gridLine.style.top = `${i * 25}%`;
                gridLines.appendChild(gridLine);
                
                const gridLabel = document.createElement('div');
                gridLabel.className = 'grid-label';
                gridLabel.textContent = `${(4 - i) * 25}%`;
                gridLabel.style.top = `${i * 25}%`;
                gridLines.appendChild(gridLabel);
            }
            
            container.appendChild(gridLines);
            
            data.forEach((item, index) => {
                const bar = document.createElement('div');
                bar.className = 'chart-bar';
                bar.style.height = `${(item.value / maxValue) * 100}%`;
                
                const barValue = document.createElement('div');
                barValue.className = 'bar-value';
                barValue.textContent = `${item.value}%`;
                bar.appendChild(barValue);
                
                const barLabel = document.createElement('div');
                barLabel.className = 'bar-label';
                barLabel.textContent = item.week;
                bar.appendChild(barLabel);
                
                container.appendChild(bar);
            });
        }

        function createSubjectPerformanceChart() {
            const container = document.getElementById('subjectPerformanceChart');
            
            // Sample data for subjects
            const subjectData = [
                { subject: 'Physics', value: 78, color: '#007acc' },
                { subject: 'Math', value: 85, color: '#28a745' },
                { subject: 'Chemistry', value: 72, color: '#ff6b6b' },
                { subject: 'Biology', value: 68, color: '#20c997' },
                { subject: 'Computer', value: 90, color: '#6f42c1' }
            ];
            
            renderSubjectChart(subjectData);
        }

        function renderSubjectChart(data) {
            const container = document.getElementById('subjectPerformanceChart');
            
            const maxValue = Math.max(...data.map(d => d.value));
            
            container.innerHTML = '';
            
            const gridLines = document.createElement('div');
            gridLines.className = 'chart-grid-lines';
            
            for (let i = 0; i <= 4; i++) {
                const gridLine = document.createElement('div');
                gridLine.className = 'grid-line';
                gridLine.style.top = `${i * 25}%`;
                gridLines.appendChild(gridLine);
                
                const gridLabel = document.createElement('div');
                gridLabel.className = 'grid-label';
                gridLabel.textContent = `${(4 - i) * 25}%`;
                gridLabel.style.top = `${i * 25}%`;
                gridLines.appendChild(gridLabel);
            }
            
            container.appendChild(gridLines);
            
            data.forEach((item, index) => {
                const bar = document.createElement('div');
                bar.className = 'chart-bar';
                bar.style.height = `${(item.value / maxValue) * 100}%`;
                bar.style.background = `linear-gradient(to top, ${item.color}, ${adjustColor(item.color, 30)})`;
                
                const barValue = document.createElement('div');
                barValue.className = 'bar-value';
                barValue.textContent = `${item.value}%`;
                bar.appendChild(barValue);
                
                const barLabel = document.createElement('div');
                barLabel.className = 'bar-label';
                barLabel.textContent = item.subject;
                bar.appendChild(barLabel);
                
                container.appendChild(bar);
            });
        }

        function createDifficultySuccessChart() {
            const container = document.getElementById('difficultySuccessChart');
            
            // Sample data for difficulty vs success
            const difficultyData = [
                { difficulty: 'Easy', success: 92, color: '#28a745' },
                { difficulty: 'Medium', success: 78, color: '#f39c12' },
                { difficulty: 'Hard', success: 45, color: '#e74c3c' },
                { difficulty: 'Advanced', success: 32, color: '#9b59b6' }
            ];
            
            renderDifficultyChart(difficultyData);
        }

        function renderDifficultyChart(data) {
            const container = document.getElementById('difficultySuccessChart');
            
            const maxValue = Math.max(...data.map(d => d.success));
            
            container.innerHTML = '';
            
            const gridLines = document.createElement('div');
            gridLines.className = 'chart-grid-lines';
            
            for (let i = 0; i <= 4; i++) {
                const gridLine = document.createElement('div');
                gridLine.className = 'grid-line';
                gridLine.style.top = `${i * 25}%`;
                gridLines.appendChild(gridLine);
                
                const gridLabel = document.createElement('div');
                gridLabel.className = 'grid-label';
                gridLabel.textContent = `${(4 - i) * 25}%`;
                gridLabel.style.top = `${i * 25}%`;
                gridLines.appendChild(gridLabel);
            }
            
            container.appendChild(gridLines);
            
            data.forEach((item, index) => {
                const bar = document.createElement('div');
                bar.className = 'chart-bar';
                bar.style.height = `${(item.success / maxValue) * 100}%`;
                bar.style.background = `linear-gradient(to top, ${item.color}, ${adjustColor(item.color, 30)})`;
                
                const barValue = document.createElement('div');
                barValue.className = 'bar-value';
                barValue.textContent = `${item.success}%`;
                bar.appendChild(barValue);
                
                const barLabel = document.createElement('div');
                barLabel.className = 'bar-label';
                barLabel.textContent = item.difficulty;
                bar.appendChild(barLabel);
                
                container.appendChild(bar);
            });
        }
        // ============================================ //
        // NEP TEACHING STUDIO JAVASCRIPT //
        // ============================================ //

        let currentLesson = {
            id: null,
            notes: null,
            questions: [],
            simulator: null,
            exportConfig: null
        };

        let currentTool = 'notes-builder';

        document.addEventListener('DOMContentLoaded', function() {
            // Initialize teaching studio
            selectTool('notes-builder');
            
            // Set up event listeners
            document.getElementById('generate-btn').addEventListener('click', generateContent);
            document.getElementById('clear-btn').addEventListener('click', clearWorkspace);
            document.getElementById('edit-toggle').addEventListener('click', toggleEditMode);
            
            // Load any saved lesson state
            loadLessonState();
        });

        function selectTool(tool) {
            currentTool = tool;
            
            // Update UI
            document.querySelectorAll('.tool-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`.tool-btn[data-tool="${tool}"]`).classList.add('active');
            
            // Update workflow progress
            updateWorkflowProgress(tool);
            
            // Load appropriate form
            loadToolForm(tool);
            
            // Update workspace
            updateWorkspace(tool);
        }

        function loadToolForm(tool) {
            const formContainer = document.getElementById('input-form-container');
            const titleElement = document.getElementById('input-panel-title');
            
            switch(tool) {
                case 'notes-builder':
                    titleElement.textContent = 'Create Teaching Notes';
                    formContainer.innerHTML = getNotesBuilderForm();
                    break;
                    
                case 'question-builder':
                    titleElement.textContent = 'Create Assessment Questions';
                    formContainer.innerHTML = getQuestionBuilderForm();
                    break;
                    
                case 'simulator-builder':
                    titleElement.textContent = 'Create Learning Simulator';
                    formContainer.innerHTML = getSimulatorBuilderForm();
                    break;
                    
                case 'export-pdf':
                    titleElement.textContent = 'Export Lesson as PDF';
                    formContainer.innerHTML = getExportPDFForm();
                    break;
            }
        }

        function getNotesBuilderForm() {
            return `
                <div class="form-section">
                    <h4>Basic Information</h4>
                    <div class="form-group">
                        <label class="form-label">Subject</label>
                        <select class="form-control" id="notes-subject">
                            <option value="">Select Subject</option>
                            <option value="physics">Physics</option>
                            <option value="chemistry">Chemistry</option>
                            <option value="mathematics">Mathematics</option>
                            <option value="biology">Biology</option>
                            <option value="computer">Computer Science</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Class / Grade</label>
                        <select class="form-control" id="notes-class">
                            <option value="6">Class 6</option>
                            <option value="7">Class 7</option>
                            <option value="8">Class 8</option>
                            <option value="9">Class 9</option>
                            <option value="10" selected>Class 10</option>
                            <option value="11">Class 11</option>
                            <option value="12">Class 12</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Topic / Chapter</label>
                        <input type="text" class="form-control" id="notes-topic" placeholder="e.g., Newton's Laws of Motion">
                    </div>
                </div>
                
                <div class="form-section">
                    <h4>Notes Configuration</h4>
                    <div class="form-group">
                        <label class="form-label">Notes Format</label>
                        <select class="form-control" id="notes-format">
                            <option value="detailed">Detailed Notes</option>
                            <option value="summary">Summary Points</option>
                            <option value="vocational">Vocational Exposure</option>
                            <option value="mindmap">Mind Map</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Learning Objectives (Optional)</label>
                        <textarea class="form-control" id="learning-objectives" rows="3" 
                                  placeholder="What students should learn from this lesson..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" style="display: flex; align-items: center; gap: 8px;">
                            <input type="checkbox" id="include-diagrams" checked>
                            <span>Include Diagrams & Visuals</span>
                        </label>
                    </div>
                </div>
                
                <div class="form-section">
                    <h4>Additional Options</h4>
                    <div class="form-group">
                        <label class="form-label" style="display: flex; align-items: center; gap: 8px;">
                            <input type="checkbox" id="include-examples" checked>
                            <span>Include Real-world Examples</span>
                        </label>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" style="display: flex; align-items: center; gap: 8px;">
                            <input type="checkbox" id="include-misconceptions">
                            <span>Address Common Misconceptions</span>
                        </label>
                    </div>
                </div>
            `;
        }

        function getQuestionBuilderForm() {
            return `
                <div class="form-section">
                    <h4>Question Generation</h4>
                    <div class="form-group">
                        <label class="form-label">Question Types</label>
                        <select class="form-control" id="question-types" multiple style="height: 180px;">
                            <option value="all" selected>All Types (Auto-generate all)</option>
                            <option value="mcq">Multiple Choice Question (MCQ)</option>
                            <option value="truefalse">True/False</option>
                            <option value="fillblank">Fill in the Blanks</option>
                            <option value="match">Match the Following</option>
                            <option value="short">Short Answer</option>
                            <option value="long">Long Answer</option>
                            <option value="diagram">Diagram Labeling</option>
                            <option value="sequence">Sequence / Ordering</option>
                            <option value="casestudy">Case Study</option>
                            <option value="numerical">Numerical Problem</option>
                            <option value="essay">Essay</option>
                            <option value="problemsolving">Problem-Solving Scenario</option>
                            <option value="code">Code Writing / Debugging</option>
                            <option value="experiment">Experimental Design</option>
                            <option value="data">Data Interpretation</option>
                            <option value="definition">Terminology Definition</option>
                            <option value="comparative">Comparative Analysis</option>
                            <option value="critical">Critical Thinking</option>
                            <option value="reflection">Reflection Question</option>
                            <option value="crosscurricular">Cross-curricular Question</option>
                        </select>
                        <small style="color: var(--text-secondary); font-size: 0.8rem;">
                            Hold Ctrl/Cmd to select multiple types, or select "All Types" for auto-generation
                        </small>
                    </div>
                </div>
                
                <div class="form-section">
                    <h4>Question Settings</h4>
                    <div class="form-group">
                        <label class="form-label">Difficulty Level</label>
                        <select class="form-control" id="question-difficulty">
                            <option value="mixed">Mixed (Auto-adjust)</option>
                            <option value="easy">Easy</option>
                            <option value="medium" selected>Medium</option>
                            <option value="hard">Hard</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Bloom's Taxonomy Level</label>
                        <select class="form-control" id="blooms-level">
                            <option value="mixed">Mixed Levels</option>
                            <option value="remember">Remember</option>
                            <option value="understand" selected>Understand</option>
                            <option value="apply">Apply</option>
                            <option value="analyze">Analyze</option>
                            <option value="evaluate">Evaluate</option>
                            <option value="create">Create</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Total Questions</label>
                        <input type="range" class="form-control" id="total-questions" min="5" max="50" value="15">
                        <div style="display: flex; justify-content: space-between; margin-top: 5px;">
                            <small>5</small>
                            <small id="questions-value">15 questions</small>
                            <small>50</small>
                        </div>
                    </div>
                </div>
                
                <div class="form-section">
                    <h4>Additional Options</h4>
                    <div class="form-group">
                        <label class="form-label" style="display: flex; align-items: center; gap: 8px;">
                            <input type="checkbox" id="include-answers" checked>
                            <span>Include Answer Key</span>
                        </label>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" style="display: flex; align-items: center; gap: 8px;">
                            <input type="checkbox" id="include-hints">
                            <span>Include Hints for Students</span>
                        </label>
                    </div>
                </div>
            `;
        }

        function getSimulatorBuilderForm() {
            return `
                <div class="form-section">
                    <h4>Simulation Type</h4>
                    <div class="form-group">
                        <select class="form-control" id="simulation-type">
                            <option value="interactive">Interactive Diagram</option>
                            <option value="virtuallab">Virtual Lab</option>
                            <option value="stepprocess">Step-by-Step Process</option>
                            <option value="realscenario">Real-world Scenario</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Concept to Simulate</label>
                        <input type="text" class="form-control" id="simulation-concept" 
                               placeholder="e.g., Force, Velocity, Chemical Reaction">
                    </div>
                </div>
                
                <div class="form-section">
                    <h4>Visual Configuration</h4>
                    <div class="form-group">
                        <label class="form-label">Visual Style</label>
                        <select class="form-control" id="visual-style">
                            <option value="minimal">Minimal</option>
                            <option value="detailed" selected>Detailed</option>
                            <option value="animated">Animated</option>
                            <option value="diagrammatic">Diagrammatic</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Interaction Type</label>
                        <select class="form-control" id="interaction-type">
                            <option value="dragdrop">Drag & Drop</option>
                            <option value="clickreveal">Click to Reveal</option>
                            <option value="sliders" selected>Adjust Sliders</option>
                            <option value="stepnav">Step Navigation</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-section">
                    <h4>Parameters & Duration</h4>
                    <div class="form-group">
                        <label class="form-label">Variables / Parameters</label>
                        <input type="text" class="form-control" id="simulation-variables" 
                               placeholder="e.g., mass, velocity, time (comma separated)">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Duration (minutes)</label>
                        <input type="range" class="form-control" id="simulation-duration" min="5" max="30" value="15">
                        <div style="display: flex; justify-content: space-between; margin-top: 5px;">
                            <small>5 min</small>
                            <small id="duration-value">15 minutes</small>
                            <small>30 min</small>
                        </div>
                    </div>
                </div>
                
                <div class="form-section">
                    <h4>Learning Objectives</h4>
                    <div class="form-group">
                        <label class="form-label" style="display: flex; align-items: center; gap: 8px;">
                            <input type="checkbox" id="sim-show-objectives" checked>
                            <span>Show Learning Objectives</span>
                        </label>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" style="display: flex; align-items: center; gap: 8px;">
                            <input type="checkbox" id="sim-include-guide">
                            <span>Include Teacher's Guide</span>
                        </label>
                    </div>
                </div>
            `;
        }

        function getExportPDFForm() {
            return `
                <div class="form-section">
                    <h4>Document Configuration</h4>
                    <div class="form-group">
                        <label class="form-label">Document Title</label>
                        <input type="text" class="form-control" id="pdf-title" 
                               placeholder="e.g., Class 10 Physics - Newton's Laws">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Sections to Include</label>
                        <div style="display: flex; flex-direction: column; gap: 8px;">
                            <label style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" id="include-notes" checked>
                                <span>Notes Content</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" id="include-questions" checked>
                                <span>Questions & Answers</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" id="include-simulator" checked>
                                <span>Simulation Instructions</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" id="include-objectives" checked>
                                <span>Learning Objectives</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" id="include-guide" checked>
                                <span>Teacher's Guide</span>
                            </label>
                        </div>
                    </div>
                </div>
                
                <div class="form-section">
                    <h4>Formatting Options</h4>
                    <div class="form-group">
                        <label class="form-label">Page Layout</label>
                        <select class="form-control" id="page-layout">
                            <option value="portrait" selected>Portrait</option>
                            <option value="landscape">Landscape</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Font Size</label>
                        <select class="form-control" id="font-size">
                            <option value="small">Small</option>
                            <option value="medium" selected>Medium</option>
                            <option value="large">Large</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Include in Header</label>
                        <input type="text" class="form-control" id="header-text" 
                               placeholder="e.g., NEP Teaching Studio - Class 10 Physics">
                    </div>
                </div>
                
                <div class="form-section">
                    <h4>Final Options</h4>
                    <div class="form-group">
                        <label class="form-label" style="display: flex; align-items: center; gap: 8px;">
                            <input type="checkbox" id="include-answerkey" checked>
                            <span>Include Answer Key (Separate Section)</span>
                        </label>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" style="display: flex; align-items: center; gap: 8px;">
                            <input type="checkbox" id="include-watermark">
                            <span>Add "NEP Teaching Studio" Watermark</span>
                        </label>
                    </div>
                </div>
            `;
        }

        function updateWorkflowProgress(tool) {
            document.querySelectorAll('.progress-step').forEach(step => {
                step.classList.remove('active');
            });
            
            const stepMap = {
                'notes-builder': 0,
                'question-builder': 1,
                'simulator-builder': 2,
                'export-pdf': 3
            };
            
            const currentStep = stepMap[tool];
            document.querySelectorAll('.progress-step')[currentStep].classList.add('active');
            
            // Activate previous steps
            for (let i = 0; i < currentStep; i++) {
                document.querySelectorAll('.progress-step')[i].classList.add('active');
            }
        }

        function updateWorkspace(tool) {
            const emptyWorkspace = document.getElementById('empty-workspace');
            const contentWorkspace = document.getElementById('content-workspace');
            
            // Check if we have content for this tool
            if (currentLesson[tool] || (tool === 'export-pdf' && hasContentToExport())) {
                emptyWorkspace.style.display = 'none';
                contentWorkspace.style.display = 'block';
                contentWorkspace.innerHTML = getWorkspaceContent(tool);
            } else {
                emptyWorkspace.style.display = 'block';
                contentWorkspace.style.display = 'none';
            }
        }

        function hasContentToExport() {
            return currentLesson.notes || currentLesson.questions.length > 0 || currentLesson.simulator;
        }

        function getWorkspaceContent(tool) {
            switch(tool) {
                case 'notes-builder':
                    return getNotesWorkspaceContent();
                case 'question-builder':
                    return getQuestionsWorkspaceContent();
                case 'simulator-builder':
                    return getSimulatorWorkspaceContent();
                case 'export-pdf':
                    return getExportWorkspaceContent();
                default:
                    return '<div class="empty-workspace">No content available</div>';
            }
        }

        function getNotesWorkspaceContent() {
            if (!currentLesson.notes) return getEmptyWorkspaceMessage();
            
            return `
                <div class="content-preview">
                    <div class="lesson-header">
                        <h1 class="lesson-title">${currentLesson.notes.topic || 'Teaching Notes'}</h1>
                        <div class="lesson-meta">
                            <span><i class="fas fa-book"></i> ${currentLesson.notes.subject || 'Subject'}</span>
                            <span><i class="fas fa-users"></i> Class ${currentLesson.notes.class}</span>
                            <span><i class="fas fa-file-alt"></i> ${currentLesson.notes.format || 'Detailed Notes'}</span>
                        </div>
                    </div>
                    
                    <div class="lesson-section">
                        <h2 class="section-title">Learning Objectives</h2>
                        <div class="notes-content">
                            ${currentLesson.notes.objectives ? 
                                `<p>${currentLesson.notes.objectives}</p>` : 
                                '<p class="text-secondary"><i>No learning objectives specified</i></p>'}
                        </div>
                    </div>
                    
                    <div class="lesson-section">
                        <h2 class="section-title">Content</h2>
                        <div class="notes-content">
                            <h3>Introduction</h3>
                            <p>${currentLesson.notes.content?.introduction || 'Content will be generated based on the topic and format selected.'}</p>
                            
                            <h3>Key Concepts</h3>
                            <ul>
                                <li>First Law of Motion (Inertia)</li>
                                <li>Second Law of Motion (F=ma)</li>
                                <li>Third Law of Motion (Action-Reaction)</li>
                                <li>Applications in daily life</li>
                            </ul>
                            
                            <h3>Examples</h3>
                            <p>${currentLesson.notes.content?.examples || 'Real-world examples will be included based on the topic.'}</p>
                            
                            ${currentLesson.notes.includeDiagrams ? `
                                <h3>Diagrams & Visuals</h3>
                                <div style="background: rgba(255,255,255,0.03); padding: 20px; border-radius: 8px; margin: 20px 0;">
                                    <p><i>Diagrams and visuals would be generated here based on the topic</i></p>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                    
                    ${currentLesson.notes.includeExamples ? `
                        <div class="lesson-section">
                            <h2 class="section-title">Real-world Applications</h2>
                            <div class="notes-content">
                                <p>Practical applications and industry relevance of the concepts.</p>
                            </div>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        function getQuestionsWorkspaceContent() {
            if (currentLesson.questions.length === 0) return getEmptyWorkspaceMessage();
            
            return `
                <div class="content-preview">
                    <div class="lesson-header">
                        <h1 class="lesson-title">Assessment Questions</h1>
                        <div class="lesson-meta">
                            <span><i class="fas fa-question-circle"></i> ${currentLesson.questions.length} Questions</span>
                            <span><i class="fas fa-layer-group"></i> ${currentLesson.questionsConfig?.difficulty || 'Mixed'} Difficulty</span>
                            <span><i class="fas fa-graduation-cap"></i> ${currentLesson.questionsConfig?.bloomsLevel || 'Mixed'} Level</span>
                        </div>
                    </div>
                    
                    <div class="lesson-section">
                        <h2 class="section-title">Generated Questions</h2>
                        
                        ${currentLesson.questions.map((question, index) => `
                            <div class="question-item">
                                <div class="question-header">
                                    <div class="question-type">${question.type || 'MCQ'}</div>
                                    <div class="question-difficulty">${question.difficulty || 'Medium'}</div>
                                </div>
                                
                                <div class="question-text">
                                    <strong>Q${index + 1}:</strong> ${question.text || 'Sample question text will appear here'}
                                </div>
                                
                                ${question.options ? `
                                    <div class="question-options">
                                        ${question.options.map((option, optIndex) => `
                                            <div class="question-option ${option.correct ? 'option-correct' : ''}">
                                                <div class="option-letter">${String.fromCharCode(65 + optIndex)}</div>
                                                <div class="option-text">${option.text}</div>
                                            </div>
                                        `).join('')}
                                    </div>
                                ` : ''}
                                
                                ${question.answer ? `
                                    <div class="question-answer">
                                        <strong>Answer:</strong> ${question.answer}
                                    </div>
                                ` : ''}
                            </div>
                        `).join('')}
                    </div>
                    
                    ${currentLesson.questionsConfig?.includeAnswers ? `
                        <div class="lesson-section">
                            <h2 class="section-title">Answer Key</h2>
                            <div style="background: rgba(39, 174, 96, 0.05); padding: 20px; border-radius: 8px;">
                                <p><i>Complete answer key would be generated here</i></p>
                            </div>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        function getSimulatorWorkspaceContent() {
            if (!currentLesson.simulator) return getEmptyWorkspaceMessage();
            
            return `
                <div class="content-preview">
                    <div class="lesson-header">
                        <h1 class="lesson-title">Learning Simulator</h1>
                        <div class="lesson-meta">
                            <span><i class="fas fa-flask"></i> ${currentLesson.simulator.type || 'Interactive Diagram'}</span>
                            <span><i class="fas fa-clock"></i> ${currentLesson.simulator.duration || 15} minutes</span>
                            <span><i class="fas fa-mouse-pointer"></i> ${currentLesson.simulator.interaction || 'Sliders'}</span>
                        </div>
                    </div>
                    
                    <div class="lesson-section">
                        <h2 class="section-title">Simulator Preview</h2>
                        
                        <div class="simulator-preview">
                            <div style="text-align: center;">
                                <i class="fas fa-flask" style="font-size: 4rem; color: var(--accent-cyan); margin-bottom: 20px;"></i>
                                <h3 style="margin-bottom: 10px;">${currentLesson.simulator.concept || 'Concept'} Simulator</h3>
                                <p style="color: var(--text-secondary); max-width: 500px;">
                                    Interactive simulation would be loaded here based on the selected parameters.
                                    Students can adjust variables and see real-time effects.
                                </p>
                            </div>
                        </div>
                        
                        <div class="simulator-controls">
                            <button class="btn btn-primary">
                                <i class="fas fa-play"></i> Start Simulation
                            </button>
                            <button class="btn btn-secondary">
                                <i class="fas fa-redo"></i> Reset
                            </button>
                            <button class="btn btn-secondary">
                                <i class="fas fa-question-circle"></i> Show Instructions
                            </button>
                        </div>
                    </div>
                    
                    <div class="lesson-section">
                        <h2 class="section-title">Learning Objectives</h2>
                        <ul>
                            <li>Understand the relationship between variables</li>
                            <li>Observe cause and effect in real-time</li>
                            <li>Apply theoretical knowledge to practical scenarios</li>
                            <li>Develop problem-solving skills through interaction</li>
                        </ul>
                    </div>
                    
                    ${currentLesson.simulator.includeGuide ? `
                        <div class="lesson-section">
                            <h2 class="section-title">Teacher's Guide</h2>
                            <div style="background: rgba(0, 122, 204, 0.05); padding: 20px; border-radius: 8px;">
                                <p><strong>Setup Instructions:</strong> Ensure students have access to the simulation interface.</p>
                                <p><strong>Discussion Points:</strong> Key concepts to discuss after the simulation.</p>
                                <p><strong>Assessment:</strong> How to evaluate student understanding.</p>
                            </div>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        function getExportWorkspaceContent() {
            return `
                <div class="content-preview">
                    <div class="lesson-header">
                        <h1 class="lesson-title">NEP Lesson Document</h1>
                        <div class="lesson-meta">
                            <span><i class="fas fa-file-pdf"></i> PDF Export Preview</span>
                            <span><i class="fas fa-calendar"></i> Generated: ${new Date().toLocaleDateString()}</span>
                        </div>
                    </div>
                    
                    <div style="background: rgba(255, 255, 255, 0.02); border: 1px solid var(--border-color); border-radius: 8px; padding: 30px; margin-top: 20px;">
                        <div style="text-align: center; margin-bottom: 30px;">
                            <h2 style="color: var(--accent-cyan);">${currentLesson.exportConfig?.title || 'Class 10 Physics - Newton\'s Laws'}</h2>
                            <p style="color: var(--text-secondary);">NEP Teaching Studio Generated Lesson Document</p>
                        </div>
                        
                        <div style="margin-bottom: 25px;">
                            <h3 style="color: var(--text-primary); margin-bottom: 15px; border-bottom: 1px solid var(--border-color); padding-bottom: 8px;">
                                <i class="fas fa-check-circle" style="color: #27ae60;"></i> Document Summary
                            </h3>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                                <div style="background: rgba(255,255,255,0.03); padding: 15px; border-radius: 6px;">
                                    <div style="font-size: 0.9rem; color: var(--text-secondary);">Subject</div>
                                    <div style="font-weight: 600;">${currentLesson.notes?.subject || 'Physics'}</div>
                                </div>
                                <div style="background: rgba(255,255,255,0.03); padding: 15px; border-radius: 6px;">
                                    <div style="font-size: 0.9rem; color: var(--text-secondary);">Class</div>
                                    <div style="font-weight: 600;">Class ${currentLesson.notes?.class || '10'}</div>
                                </div>
                                <div style="background: rgba(255,255,255,0.03); padding: 15px; border-radius: 6px;">
                                    <div style="font-size: 0.9rem; color: var(--text-secondary);">Total Pages</div>
                                    <div style="font-weight: 600;">8-12 pages (estimated)</div>
                                </div>
                                <div style="background: rgba(255,255,255,0.03); padding: 15px; border-radius: 6px;">
                                    <div style="font-size: 0.9rem; color: var(--text-secondary);">File Size</div>
                                    <div style="font-weight: 600;">~2-3 MB</div>
                                </div>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 25px;">
                            <h3 style="color: var(--text-primary); margin-bottom: 15px; border-bottom: 1px solid var(--border-color); padding-bottom: 8px;">
                                <i class="fas fa-list-check"></i> Included Sections
                            </h3>
                            <div style="display: flex; flex-direction: column; gap: 10px;">
                                ${currentLesson.exportConfig?.includeNotes ? `
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <i class="fas fa-check" style="color: #27ae60;"></i>
                                        <span>Teaching Notes (${currentLesson.notes?.format || 'Detailed Format'})</span>
                                    </div>
                                ` : ''}
                                
                                ${currentLesson.exportConfig?.includeQuestions ? `
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <i class="fas fa-check" style="color: #27ae60;"></i>
                                        <span>Assessment Questions (${currentLesson.questions.length} questions)</span>
                                    </div>
                                ` : ''}
                                
                                ${currentLesson.exportConfig?.includeSimulator ? `
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <i class="fas fa-check" style="color: #27ae60;"></i>
                                        <span>Simulation Instructions (${currentLesson.simulator?.type || 'Interactive'})</span>
                                    </div>
                                ` : ''}
                                
                                ${currentLesson.exportConfig?.includeObjectives ? `
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <i class="fas fa-check" style="color: #27ae60;"></i>
                                        <span>Learning Objectives</span>
                                    </div>
                                ` : ''}
                                
                                ${currentLesson.exportConfig?.includeGuide ? `
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <i class="fas fa-check" style="color: #27ae60;"></i>
                                        <span>Teacher's Guide</span>
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                        
                        <div style="background: rgba(0, 122, 204, 0.1); border-left: 3px solid var(--accent-blue); padding: 20px; border-radius: 4px; margin-top: 30px;">
                            <p style="margin: 0; color: var(--text-primary);">
                                <i class="fas fa-info-circle" style="color: var(--accent-cyan);"></i>
                                This PDF will be generated with professional formatting, proper headers, and pagination suitable for classroom use and school records.
                            </p>
                        </div>
                    </div>
                </div>
            `;
        }

        function getEmptyWorkspaceMessage() {
            return `
                <div class="empty-workspace">
                    <div style="text-align: center; padding: 60px 20px;">
                        <i class="fas fa-chalkboard" style="font-size: 3rem; color: var(--text-secondary); margin-bottom: 20px;"></i>
                        <h3 style="color: var(--text-secondary); margin-bottom: 10px;">No Content Generated Yet</h3>
                        <p style="color: var(--text-secondary); max-width: 400px; margin: 0 auto;">
                            Configure your settings on the left panel and click "Generate Content"
                        </p>
                    </div>
                </div>
            `;
        }

        async function generateContent() {
            const generateBtn = document.getElementById('generate-btn');
            const originalText = generateBtn.innerHTML;
            
            try {
                // Show loading state
                generateBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Generating...';
                generateBtn.disabled = true;
                
                // Collect form data based on current tool
                const formData = collectFormData();
                
                // Simulate API call (in real implementation, this would be an actual API call)
                await simulateAPICall(formData);
                
                // Store generated content
                currentLesson[currentTool] = formData;
                
                // Update workspace
                updateWorkspace(currentTool);
                
                // Show success message
                showNotification('Content generated successfully!', 'success');
                
                // If this is notes, auto-advance to question builder
                if (currentTool === 'notes-builder') {
                    setTimeout(() => {
                        selectTool('question-builder');
                        showNotification('Now you can create questions based on these notes', 'info');
                    }, 1000);
                }
                
            } catch (error) {
                console.error('Generate content error:', error);
                showNotification('Failed to generate content. Please try again.', 'error');
            } finally {
                generateBtn.innerHTML = originalText;
                generateBtn.disabled = false;
            }
        }

        function collectFormData() {
            switch(currentTool) {
                case 'notes-builder':
                    return {
                        subject: document.getElementById('notes-subject')?.value,
                        class: document.getElementById('notes-class')?.value,
                        topic: document.getElementById('notes-topic')?.value,
                        format: document.getElementById('notes-format')?.value,
                        objectives: document.getElementById('learning-objectives')?.value,
                        includeDiagrams: document.getElementById('include-diagrams')?.checked,
                        includeExamples: document.getElementById('include-examples')?.checked,
                        includeMisconceptions: document.getElementById('include-misconceptions')?.checked,
                        timestamp: new Date().toISOString()
                    };
                    
                case 'question-builder':
                    const questionTypesSelect = document.getElementById('question-types');
                    const selectedTypes = Array.from(questionTypesSelect.selectedOptions).map(opt => opt.value);
                    
                    return {
                        types: selectedTypes,
                        difficulty: document.getElementById('question-difficulty')?.value,
                        bloomsLevel: document.getElementById('blooms-level')?.value,
                        totalQuestions: document.getElementById('total-questions')?.value,
                        includeAnswers: document.getElementById('include-answers')?.checked,
                        includeHints: document.getElementById('include-hints')?.checked,
                        timestamp: new Date().toISOString()
                    };
                    
                case 'simulator-builder':
                    return {
                        type: document.getElementById('simulation-type')?.value,
                        concept: document.getElementById('simulation-concept')?.value,
                        visualStyle: document.getElementById('visual-style')?.value,
                        interaction: document.getElementById('interaction-type')?.value,
                        variables: document.getElementById('simulation-variables')?.value,
                        duration: document.getElementById('simulation-duration')?.value,
                        showObjectives: document.getElementById('sim-show-objectives')?.checked,
                        includeGuide: document.getElementById('sim-include-guide')?.checked,
                        timestamp: new Date().toISOString()
                    };
                    
                case 'export-pdf':
                    return {
                        title: document.getElementById('pdf-title')?.value,
                        includeNotes: document.getElementById('include-notes')?.checked,
                        includeQuestions: document.getElementById('include-questions')?.checked,
                        includeSimulator: document.getElementById('include-simulator')?.checked,
                        includeObjectives: document.getElementById('include-objectives')?.checked,
                        includeGuide: document.getElementById('include-guide')?.checked,
                        pageLayout: document.getElementById('page-layout')?.value,
                        fontSize: document.getElementById('font-size')?.value,
                        headerText: document.getElementById('header-text')?.value,
                        includeAnswerKey: document.getElementById('include-answerkey')?.checked,
                        includeWatermark: document.getElementById('include-watermark')?.checked,
                        timestamp: new Date().toISOString()
                    };
                    
                default:
                    return {};
            }
        }

        function simulateAPICall(formData) {
            // Simulate API delay
            return new Promise(resolve => setTimeout(resolve, 1500));
        }

        function clearWorkspace() {
            if (confirm('Are you sure you want to clear all generated content? This cannot be undone.')) {
                currentLesson = {
                    id: null,
                    notes: null,
                    questions: [],
                    simulator: null,
                    exportConfig: null
                };
                
                // Reset to notes builder
                selectTool('notes-builder');
                
                // Clear forms
                document.getElementById('input-form-container').innerHTML = getNotesBuilderForm();
                
                showNotification('Workspace cleared', 'info');
            }
        }

        function toggleEditMode() {
            const editBtn = document.getElementById('edit-toggle');
            const isEditing = editBtn.innerHTML.includes('Edit Mode');
            
            if (isEditing) {
                editBtn.innerHTML = '<i class="fas fa-save"></i> Save Changes';
                // Enable editing in workspace
                enableEditing();
                showNotification('Edit mode enabled. Make your changes and save.', 'info');
            } else {
                editBtn.innerHTML = '<i class="fas fa-edit"></i> Edit Mode';
                // Save changes and disable editing
                disableEditing();
                showNotification('Changes saved successfully.', 'success');
            }
        }

        function enableEditing() {
            // Implementation for enabling editing mode
            console.log('Edit mode enabled');
        }

        function disableEditing() {
            // Implementation for saving changes and disabling edit mode
            console.log('Edit mode disabled');
        }

        function addAIEnhancements() {
            showNotification('AI enhancements added to your lesson', 'success');
            
            // In real implementation, this would call AI service
            // and update the current lesson with enhancements
        }

        function loadLesson(lessonId) {
            // In real implementation, this would load from database
            console.log('Loading lesson:', lessonId);
            showNotification('Lesson loaded successfully', 'success');
        }

        function loadLessonState() {
            // Load saved lesson state from localStorage
            const savedLesson = localStorage.getItem('nep_teaching_studio_lesson');
            if (savedLesson) {
                try {
                    currentLesson = JSON.parse(savedLesson);
                } catch (e) {
                    console.error('Error loading saved lesson:', e);
                }
            }
        }

        function saveLessonState() {
            // Save current lesson state to localStorage
            localStorage.setItem('nep_teaching_studio_lesson', JSON.stringify(currentLesson));
        }

        function showNotification(message, type = 'info') {
            // Create notification element
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                <span>${message}</span>
            `;
            
            // Add to page
            document.body.appendChild(notification);
            
            // Remove after delay
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Add notification styles
        const notificationStyles = `
            <style>
                .notification {
                    position: fixed;
                    top: 80px;
                    right: 20px;
                    background: var(--panel-dark);
                    border: 1px solid var(--border-color);
                    border-left: 4px solid var(--accent-blue);
                    padding: 15px 20px;
                    border-radius: 8px;
                    display: flex;
                    align-items: center;
                    gap: 12px;
                    z-index: 10000;
                    animation: slideInRight 0.3s ease;
                    max-width: 350px;
                }
                
                .notification.success {
                    border-left-color: var(--success-green);
                }
                
                .notification.error {
                    border-left-color: var(--danger-red);
                }
                
                .notification.info {
                    border-left-color: var(--accent-cyan);
                }
                
                .notification i {
                    font-size: 1.2rem;
                }
                
                .notification.success i {
                    color: var(--success-green);
                }
                
                .notification.error i {
                    color: var(--danger-red);
                }
                
                .notification.info i {
                    color: var(--accent-cyan);
                }
                
                @keyframes slideInRight {
                    from {
                        transform: translateX(100%);
                        opacity: 0;
                    }
                    to {
                        transform: translateX(0);
                        opacity: 1;
                    }
                }
            </style>
        `;

        // Inject notification styles
        document.head.insertAdjacentHTML('beforeend', notificationStyles);
    </script>
</body>
</html>